/**
 * streamroot-hlsjs-p2p-wrapper
 * v4.3.48
 * 2017-10-03
 * streamroot-p2p@4.12.0
 *  - streamroot-qos-analytics@2.0.15
 * www.streamroot.io
 * Copyright Â© 2017
 */

!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.HlsjsP2PWrapper=t():e.HlsjsP2PWrapper=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(7)},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t){n(this,e),this.level=t.level,this.urlId=t.urlId,this.bitrate=t.bitrate}return r(e,[{key:"viewToString",value:function(){return"L"+this.level+"U"+this.urlId}},{key:"isEqual",value:function(e){return!!e&&(e.level===this.level&&e.urlId===this.urlId)}},{key:"type",get:function(){return"video"}}]),e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),u=r(s),l=function(){function e(t){i(this,e),this.sn=t.sn,this.trackView=new u.default(t.trackView),this.time=t.time}return o(e,null,[{key:"fromArrayBuffer",value:function(t){var n=new Uint32Array(t),r=a(n,3),i=r[0],o=r[1],s=r[2];return new e({trackView:new u.default({level:i,urlId:o}),sn:s})}}]),o(e,[{key:"isEqual",value:function(e){if(!e)return!1;var t=e.sn,n=e.trackView;return this.sn===t&&this.trackView.isEqual(n)}},{key:"isInTrack",value:function(e){return this.trackView.isEqual(e)}},{key:"viewToString",value:function(){return this.trackView.viewToString()+"S"+this.sn}},{key:"toArrayBuffer",value:function(){var e=this.trackView,t=e.level,n=e.urlId;return new Uint32Array([t,n,this.sn]).buffer}},{key:"getId",value:function(){return this.sn}}]),e}();t.default=l,e.exports=t.default},function(e,t){"use strict";function n(e,t){if("undefined"==typeof e[t])throw new Error(u+": "+t)}function r(e,t,r,i){if(i){var a=i(e,t,r);if(a.override)return a.value}return n(t,r),t[r]}function i(e,t,r,i,a){if(a){var o=a(e,t,r,i);if(o.override)return}n(r,i),r[i]=e}function a(e,t,n,i){Object.defineProperty(e,n,{get:function(){return r(e,t,n,i)},configurable:!0})}function o(e,t,n,a,o){Object.defineProperty(e,n,{get:function(){return r(e,t,n,o)},set:function(r){return i(r,e,t,n,a)},configurable:!0})}function s(e,t,r){e[r]=function(){return n(t,r),t[r].apply(t,arguments)}}var u="Requiring undefined property on source object";e.exports={mirrorFunc:s,mirrorRwProp:o,mirrorReadOnlyProp:a}},function(e,t,n){"use strict";function r(e,t){function n(n){Object.defineProperty(e,n,{get:function(){return t[n]},set:void 0})}var r=!0,i=!1,a=void 0;try{for(var o,s=Object.getOwnPropertyNames(t)[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;["prototype","name","length","caller","arguments","isSupported"].indexOf(u)===-1&&n(u)}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}}function i(e,t,n){var r=n||{},i=t,o=new a.BaseXHR({setRequestHeader:function(e,t){r[e]=t},withCredentials:!1,open:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if("GET"!==e)throw new Error("xhrSetup is calling open with a method other than GET, which is not supported at the moment. Please contact Streamroot support");if(n!==!0)throw new Error("xhrSetup is trying to open a synchronous request, which is not supported at the moment. Please contact Streamroot support");i=t}});try{e&&e(o,t)}catch(e){throw new Error("xhrSetup is trying to acces a forbidden property/method of XHR mock. Please contact Streamroot support. Internal mock error: "+e.message)}return{headers:r,withCredentials:o.withCredentials,url:i}}Object.defineProperty(t,"__esModule",{value:!0}),t.extractInfoFromXhrSetup=t.inheritStaticPropertiesReadOnly=void 0;var a=n(17);t.inheritStaticPropertiesReadOnly=r,t.extractInfoFromXhrSetup=i},function(e,t,n){"use strict";var r=n(3),i=function(e){var t={},n=e||{};return r.mirrorRwProp(t,n,"responseType"),r.mirrorRwProp(t,n,"timeout"),r.mirrorRwProp(t,n,"withCredentials"),r.mirrorReadOnlyProp(t,n,"readyState"),r.mirrorReadOnlyProp(t,n,"response"),r.mirrorReadOnlyProp(t,n,"responseText"),r.mirrorReadOnlyProp(t,n,"responseURL"),r.mirrorReadOnlyProp(t,n,"responseXML"),r.mirrorReadOnlyProp(t,n,"status"),r.mirrorReadOnlyProp(t,n,"statusText"),r.mirrorReadOnlyProp(t,n,"upload"),r.mirrorFunc(t,n,"abort"),r.mirrorFunc(t,n,"open"),r.mirrorFunc(t,n,"send"),r.mirrorFunc(t,n,"setRequestHeader"),r.mirrorFunc(t,n,"getResponseHeader"),r.mirrorFunc(t,n,"overrideMimeType"),r.mirrorFunc(t,n,"getAllResponseHeaders"),r.mirrorFunc(t,n,"addRemoveEventListener"),r.mirrorFunc(t,n,"removeRemoveEventListener"),r.mirrorRwProp(t,n,"onload"),r.mirrorRwProp(t,n,"onloadstart"),r.mirrorRwProp(t,n,"onloadend"),r.mirrorRwProp(t,n,"onabort"),r.mirrorRwProp(t,n,"onerror"),r.mirrorRwProp(t,n,"onprogress"),r.mirrorRwProp(t,n,"ontimeout"),r.mirrorRwProp(t,n,"onreadystatechange"),t};e.exports=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(13),u=r(s),l=n(9),c=r(l),d=n(2),f=r(d),h=n(12),_=r(h),p=function(){function e(t,n,r){var o=this;if(i(this,e),!t||"object"!==("undefined"==typeof t?"undefined":a(t)))throw new Error("p2pConfig must be a valid config object");n.url?this._createPeerAgent(t,n,r):n.on(n.constructor.Events.MANIFEST_LOADING,function(){o._createPeerAgent(t,n,r)}),n.on(n.constructor.Events.ERROR,this._onMediaEngineError.bind(this))}return o(e,[{key:"onDispose",value:function(){this.peerAgentModule.dispose(),delete this.peerAgentModule}},{key:"_createPeerAgent",value:function(e,t,n){this.hls=t;var r=n.StreamTypes.HLS,i="v3";t.config.fLoader=(0,_.default)(this);var a=new u.default(t,this.onDispose.bind(this)),o=new c.default(t);this.peerAgentModule=new n(a,t.url,o,e,f.default,r,i),this._setMediaElement(t),this._overrideABRController(t)}},{key:"_setMediaElement",value:function(e){var t=this;e.media?this.peerAgentModule.setMediaElement(e.media):e.on(e.constructor.Events.MEDIA_ATTACHING,function(){t.peerAgentModule.setMediaElement(e.media)})}},{key:"_onMediaEngineError",value:function(e,t){t.fatal&&this.peerAgentModule&&this.peerAgentModule.onPlaybackError&&this.peerAgentModule.onPlaybackError(t.type+" - "+t.details)}},{key:"_overrideABRController",value:function(e){var t=void 0,n=void 0;if(e.abrController._findBestLevel)n=e.abrController._findBestLevel,t=!0;else{if(!e.abrController.findBestLevel)return;n=e.abrController.findBestLevel,t=!1}var r=this,i=function(){var t=n.apply(e.abrController,arguments),i=e.currentLevel;return r.peerAgentModule&&r.peerAgentModule.nextSegmentPrebuffered&&r.peerAgentModule.nextSegmentPrebuffered.video&&t<i&&(t=i),t};t?e.abrController._findBestLevel=i:e.abrController.findBestLevel=i}}],[{key:"version",get:function(){return"4.3.48"}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),s=r(o),u=n(16),l=r(u),c=n(14),d=r(c),f=function(){function e(t,n){if(i(this,e),n){var r=new s.default(t,n,l.default),a=d.default.get(r);Object.defineProperty(this,"peerAgent",{get:function(){return r.peerAgentModule?a:null}})}}return a(e,[{key:"version",get:function(){return e.version}}],[{key:"version",get:function(){return s.default.version}}]),e}();t.default=f,e.exports=t.default},function(e,t){"use strict";var n="onTrackChange",r="onEmergencyFragLoadAborted",i=[n,r],a=function(e){return i.indexOf(e)>-1};e.exports={TRACK_CHANGE_EVENT:n,EMERGENCY_FRAG_LOAD_ABORT:r,isSupported:a}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),s=r(o),u=n(1),l=r(u),c=function(){function e(t){i(this,e),this.hls=t}return a(e,[{key:"getSegmentTime",value:function(e){if(void 0===e.time)throw new Error("getSegmentTime: segmentView.time is undefined");return e.time}},{key:"getSegmentList",value:function(e,t,n){var r=this.hls.levels[e.level];if(!r)throw new Error("getSegmentList: level doesn't exist");if(!r.details)return[];for(var i=[],a=r.details.fragments,o=0;o<a.length;o++){var u=a[o];t<=u.start&&u.start<=t+n&&i.push(new s.default({sn:u.sn,trackView:e,time:u.start}))}return i}},{key:"getTrackList",value:function(){if(!this.hls.levels)return[];for(var e=[],t=0;t<this.hls.levels.length;t++)for(var n=this.hls.levels[t],r=0;r<n.url.length;r++)e.push(new l.default({level:t,urlId:r,bitrate:n.bitrate}));return e}},{key:"getSegmentDuration",value:function(e){var t=this.hls.levels[e.trackView.level],n=!0,r=!1,i=void 0;try{for(var a,o=t.details.fragments[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;return s.duration}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}throw new Error("All segments should have a duration")}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),s=r(o),u=n(1),l=r(u),c=n(4),d=function(e){return function(){function t(e){i(this,t),e&&(this.xhrSetup=e.xhrSetup),this.reset()}return a(t,[{key:"destroy",value:function(){this.abort()}},{key:"abort",value:function(){this.peerAgentLoader&&(this.stats.aborted=!0,this.peerAgentLoader.abort()),this.reset()}},{key:"reset",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];clearTimeout(this.requestTimeout),this.requestTimeout=null,e&&(clearTimeout(this.retryTimeout),this.retryTimeout=null),this.peerAgentLoader=null}},{key:"load",value:function(e,t,n,r,i,a,o,s,u,l){if(!u)throw new Error("P2P loader expects progress-callback to be passed for ABR stats (use only as `fLoader` in config)");if(!l)throw new Error("P2P loader can only be used for media fragments (use only as `fLoader` in config)");this.frag=l,this.url=e,this.responseType=t,this.onSuccess=n,this.onProgress=u,this.onTimeout=i,this.onError=r,this.stats={trequest:performance.now(),retry:0},this.timeout=a,this.maxRetry=o,this.retryDelay=s,this.loadInternal()}},{key:"loadSuccess",value:function(e,t){if(!this.stats.aborted){var n={currentTarget:{response:e}};if(t.p2pDuration+t.cdnDuration>0&&t.p2pDownloaded>0){var r=performance.now(),i=t.p2pDuration+t.cdnDuration,a=Math.min(i/2,10);this.stats.trequest=r-i,this.stats.tfirst=this.stats.trequest+a}this.stats.tload=performance.now(),this.stats.loaded=e.byteLength,this.onSuccess(n,this.stats),this.reset()}}},{key:"loadError",value:function(e){if(!this.stats.aborted){var t=e.status;if(this.stats.retry<this.maxRetry)this.retryTimeout=setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++,this.reset(!1);else{var n={target:{status:t}};this.onError(n),this.reset()}}}},{key:"loadInternal",value:function(){if(this.peerAgentLoader)throw new Error("P2P loader was not reset correctly, internal state indicates unfinalized request");var t=this.url,n=this.xhrSetup,r=(0,c.extractInfoFromXhrSetup)(n,t),i=r.headers,a=r.withCredentials;isNaN(this.frag.byteRangeStartOffset)||isNaN(this.frag.byteRangeEndOffset)||(i.Range="bytes="+this.frag.byteRangeStartOffset+"-"+(this.frag.byteRangeEndOffset-1));var o=e.hls.levels[this.frag.level],u=o.urlId,d=o.bitrate,f=new l.default({urlId:u,bitrate:d,level:this.frag.level}),h=new s.default({sn:this.frag.sn,trackView:f,time:this.frag.start}),_={url:t,headers:i,withCredentials:a},p={onSuccess:this.loadSuccess.bind(this),onError:this.loadError.bind(this),onProgress:this.loadProgress.bind(this)};this.stats.tfirst=null,this.stats.loaded=0,this.requestTimeout=setTimeout(this.loadTimeout.bind(this),this.timeout),this.peerAgentLoader=e.peerAgentModule.getSegment(_,p,h)}},{key:"loadProgress",value:function(e){var t=0;e.cdnDownloaded&&(t+=e.cdnDownloaded),e.p2pDownloaded&&(t+=e.p2pDownloaded),this.stats.loaded=t,null===this.stats.tfirst&&(this.stats.tfirst=Math.max(performance.now(),this.stats.trequest)),this.onProgress(e,this.stats)}},{key:"loadTimeout",value:function(){this.onTimeout(null,this.stats)}}]),t}()};t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),s=r(o),u=n(1),l=r(u),c=n(4),d=function(e){return function(){function t(e){i(this,t),e&&(this.xhrSetup=e.xhrSetup),this.reset()}return a(t,[{key:"destroy",value:function(){this.abort()}},{key:"abort",value:function(){this.peerAgentLoader&&(this.stats.aborted=!0,this.peerAgentLoader.abort()),this.reset()}},{key:"reset",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];clearTimeout(this.requestTimeout),this.requestTimeout=null,e&&(clearTimeout(this.retryTimeout),this.retryTimeout=null),this.peerAgentLoader=null}},{key:"load",value:function(e,t,n){if(!n.onProgress)throw new Error("P2P loader expects progress-callback to be passed for ABR stats (use only as `fLoader` in config)");this.stats={trequest:performance.now(),retry:0},this.context=e,this.callbacks=n,this.config=t,this.retryDelay=t.retryDelay,this.loadInternal()}},{key:"loadSuccess",value:function(e,t){if(!this.stats.aborted){var n={data:e};if(t.p2pDuration+t.cdnDuration>0&&t.p2pDownloaded>0){var r=performance.now(),i=t.p2pDuration+t.cdnDuration,a=Math.min(i/2,10);this.stats.trequest=r-i,this.stats.tfirst=this.stats.trequest+a}this.stats.tload=performance.now(),this.stats.loaded=e.byteLength,this.stats.total=this.stats.loaded,this.callbacks.onSuccess(n,this.stats,this.context),this.reset()}}},{key:"loadError",value:function(e){if(!this.stats.aborted){var t=e.status;if(this.stats.retry<this.config.maxRetry)this.retryTimeout=setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++,this.reset(!1);else{var n={code:t,text:e.message};this.callbacks.onError(n,this.context),this.reset()}}}},{key:"loadInternal",value:function(){if(this.peerAgentLoader)throw new Error("P2P loader was not reset correctly, internal state indicates unfinalized request");var t=this.xhrSetup,n=(0,c.extractInfoFromXhrSetup)(t,this.context.url),r=n.headers,i=n.withCredentials,a=n.url;isNaN(this.context.rangeStart)||isNaN(this.context.rangeEnd)||(r.Range="bytes="+this.context.rangeStart+"-"+(this.context.rangeEnd-1));var o=null;if("main"===this.context.frag.type){var u=e.hls.levels[this.context.frag.level],d=u.urlId,f=u.bitrate,h=new l.default({urlId:d,bitrate:f,level:this.context.frag.level});o=new s.default({sn:this.context.frag.sn,trackView:h,time:this.context.frag.start})}var _={url:a,headers:r,withCredentials:i},p={onSuccess:this.loadSuccess.bind(this),onError:this.loadError.bind(this),onProgress:this.loadProgress.bind(this)};this.stats.tfirst=null,this.stats.loaded=0,this.requestTimeout=setTimeout(this.loadTimeout.bind(this),this.config.timeout),this.peerAgentLoader=e.peerAgentModule.getSegment(_,p,o)}},{key:"loadProgress",value:function(e){var t=0;e.cdnDownloaded&&(t+=e.cdnDownloaded),e.p2pDownloaded&&(t+=e.p2pDownloaded),this.stats.loaded=t,e.lengthComputable&&(this.stats.total=e.total),null===this.stats.tfirst&&(this.stats.tfirst=Math.max(performance.now(),this.stats.trequest)),this.callbacks.onProgress(this.stats,this.context)}},{key:"loadTimeout",value:function(){this.callbacks.onTimeout(this.stats,this.context)}}]),t}()};t.default=d,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=r(i),o=n(11),s=r(o),u=function(e){var t=e.hls.constructor.version;if(void 0===t)return(0,a.default)(e);var n=t.split("."),r=n[1],i=n[2];return Number(r)>=7||6===Number(r)&&Number(i)>=2?(0,s.default)(e):(0,a.default)(e)};t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(15),l=r(u),c=n(1),d=r(c),f=n(8),h=r(f),_=function(e){function t(e,n){i(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));r.hls=e,r.onDispose=n;var o=e.constructor.Events.LEVEL_SWITCH||e.constructor.Events.LEVEL_SWITCHING;if(void 0===o)throw new Error("Can't find neither LEVEL_SWITCH nor LEVEL_SWITCHING hls.js event.");r.hls.on(o,function(e,t){var n=r.hls.levels[t.level],i=n.urlId,a=n.bitrate;r.emit(h.default.TRACK_CHANGE_EVENT,{video:new d.default({urlId:i,bitrate:a,level:t.level})})});var s=e.constructor.Events.FRAG_LOAD_EMERGENCY_ABORTED;if(void 0===s)throw new Error("Can not find FRAG_LOAD_EMERGENCY_ABORTED hls.js event.");r.hls.on(s,function(){r.emit(h.default.EMERGENCY_FRAG_LOAD_ABORT)});var u=e.constructor.Events.DESTROYING;if(void 0===u)throw new Error("Can not find DESTROYING event hls.js event.");return r.hls.on(u,function(){r.onDispose()}),r}return o(t,e),s(t,[{key:"isLive",value:function(){if(!this.hls.levels)throw new Error("Called isLive before the master playlist was parsed");var e=!0,t=!1,n=void 0;try{for(var r,i=this.hls.levels[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a=r.value;if(a.details)return!!a.details.live}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}throw new Error("Called isLive before any levelplaylist was parsed")}},{key:"getBufferLevelMax",value:function(){var e=void 0,t=void 0;if(this.hls.config.liveSyncDuration?(e="liveSyncDuration",t=this.hls.config.liveSyncDuration):(e="maxBufferLength",t=this.hls.config.maxBufferLength),t<0)throw Error("Invalid configuration: hlsjsConfig."+e+" must be greater than p2pConfig.liveMinBufferMargin");return t}},{key:"setBufferMarginLive",value:function(e){this.hls.config.maxBufferSize=0,this.hls.config.maxBufferLength=e}},{key:"addEventListener",value:function(e,t){h.default.isSupported(e)&&this.on(e,t)}},{key:"removeEventListener",value:function(e,t){h.default.isSupported(e)&&this.removeListener(e,t)}}]),t}(l.default);t.default=_,e.exports=t.default},function(e,t){"use strict";function n(e){var t={get stats(){return e.peerAgentModule.stats},get version(){return e.peerAgentModule.version},get isP2PEnabled(){return e.peerAgentModule.isP2PEnabled},get p2pDownloadOn(){return e.peerAgentModule.p2pDownloadOn},set p2pDownloadOn(t){e.peerAgentModule.p2pDownloadOn=t},get p2pUploadOn(){return e.peerAgentModule.p2pUploadOn},set p2pUploadOn(t){e.peerAgentModule.p2pUploadOn=t}};return t}Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:n},e.exports=t.default},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function i(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,i,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(n=this._events[e],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),l=n.slice(),i=l.length,u=0;u<i;u++)l[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var i;if(!r(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,i,o,s;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(r(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t){!function(n,r){"object"==typeof t&&"object"==typeof e?e.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof t?t.Downloader=r():(n.Streamroot=n.Streamroot||{},n.Streamroot.Downloader=r())}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=198)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(265),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={ChunkManager:{CHUNK_DOWNLOADED:"chunkDownloaded"},Config:{CONFIG_UPDATED:"configUpdated"},Distributor:{ANSWERED:"distributorAnswered",TIMED_OUT:"distributorTimedOut"},Metrics:{TRACK_SWITCH:"metricsTrackSwitch"},Media:{ENDED:"mediaEnded"},Scheduler:{REACHED_LIVE_EDGE_STATE_CHANGED:"schedulerReachedLiveEdgeStateChanged"},SRModuleInterface:{ABR_FEEDBACK:"srModuleInterfaceAbrFeedback",UNCOMPLETE_SEGMENT_REQUESTED:"srmoduleinterfaceUncompleteSegmentRequested",SEGMENT_TRANSFERED_TO_MEDIA_ENGINE:"segmentTransferedToMediaEngine"},PeerPool:{PEER_OPEN:"peerpoolPeerOpen",PEER_DESTROYED:"peerpoolPeerDestroyed",PEER_STATS_UPDATE:"peerPoolStat",START_ASKING_PEERS:"startAskingPeers",STOP_ASKING_PEERS:"stopAskingPeers"},BufferManager:{LOW_BUFFER:"buffermanagerLowBuffer",HIGH_BUFFER:"buffermanagerHighBuffer",STATE_CHANGED:"buffermanagerStateChanged"},PeerConnection:{DISCONNECTED:"peerConnectionDisconnected",MESSAGE_RECEIVED:"peerConnectionMessageReceived",BINARY_DATA_RECEIVED:"peerConnectionBinaryDataReceived"},Peer:{PEER_DISCONNECTED:"PeerDisconnected"},UploadQueue:{CHUNK_REQUESTED:"chunkRequested"},P2PCache:{REMOVE_SEGMENT_FROM_CACHE:"removeSegmentFromCache",ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE:"attemptedGCTrackEdgeFromCache"},BufferedAmountObserver:{BUFFER_CHECK:"bufferCheck"},Tracker:{PERM_TRACKER_DISCONNECTION_REQUEST:"permTrackerDisconnectionRequest",TEMP_TRACKER_DISCONNECTION_REQUEST:"tempTrackerDisconnectionRequest",TRACKER_RECONNECTION_REQUEST:"trackerReconnectionRequest",READY:"trackerReady",FAILED:"trackerFailed",BLOCKED:"trackerBlocked"},TrafficAnalytics:{STOP_SENDING_USAGE:"stopSendingUsage",RESTART_SENDING_USAGE:"restartSendingUsage"},Signaling:{PERM_SIGNALING_DISCONNECTION_REQUEST:"permSignalingDisconnectionRequest",TEMP_SIGNALING_DISCONNECTION_REQUEST:"tempSignalingDisconnectionRequest",SIGNALING_RECONNECTION_REQUEST:"signalingReconnectionRequest"},SegmentFiller:{SUCCESS:"segmentFillerSuccess",FALLBACK:"segmentFillerFallback"}},e.exports=t.default},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){"use strict";e.exports=n(180)},function(e,t,n){"use strict";function r(e,t){return new o(e,t,a.TIMER_TYPE.INTERVAL)}function i(e,t){return new o(e,t,a.TIMER_TYPE.TIMEOUT)}Object.defineProperty(t,"__esModule",{value:!0}),t.createInterval=r,t.createTimeout=i;var a=n(114),o=void 0;o=n(258)},function(e,t,n){e.exports={default:n(291),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(269),a=r(i),o=n(263),s=r(o),u=n(26),l=r(u);t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,l.default)(t)));e.prototype=(0,s.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(a.default?(0,a.default)(e,t):e.__proto__=t)}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(26),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},function(e,t,n){var r=n(12),i=n(3),a=n(22),o=n(24),s=function(e,t,n){var u,l,c,d=e&s.F,f=e&s.G,h=e&s.S,_=e&s.P,p=e&s.B,v=e&s.W,E=f?i:i[t]||(i[t]={}),m=E.prototype,S=f?r:h?r[t]:(r[t]||{}).prototype;f&&(n=t);for(u in n)(l=!d&&S&&void 0!==S[u])&&u in E||(c=l?S[u]:n[u],E[u]=f&&"function"!=typeof S[u]?n[u]:p&&l?a(c,r):v&&S[u]==c?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(c):_&&"function"==typeof c?a(Function.call,c):c,_&&((E.virtual||(E.virtual={}))[u]=c,e&s.R&&m&&!m[u]&&o(m,u,c)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t,n){e.exports={default:n(276),__esModule:!0}},function(e,t,n){var r=n(86)("wks"),i=n(63),a=n(12).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,n){e.exports={default:n(284),__esModule:!0}},function(e,t,n){e.exports={default:n(279),__esModule:!0}},function(e,t,n){e.exports=!n(23)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(20),i=n(123),a=n(88),o=Object.defineProperty;t.f=n(16)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");
return"value"in n&&(e[t]=n.value),e}},function(e,t,n){"use strict";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(){this._events=new r,this._eventsCount=0}var o=Object.prototype.hasOwnProperty,s="~";Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(s=!1)),a.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e,t){var n=s?s+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},a.prototype.emit=function(e,t,n,r,i,a){var o=s?s+e:e;if(!this._events[o])return!1;var u,l,c=this._events[o],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,i),!0;case 6:return c.fn.call(c.context,t,n,r,i,a),!0}for(l=1,u=new Array(d-1);l<d;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var f,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),d){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,n);break;case 4:c[l].fn.call(c[l].context,t,n,r);break;default:if(!u)for(f=1,u=new Array(d-1);f<d;f++)u[f-1]=arguments[f];c[l].fn.apply(c[l].context,u)}}return!0},a.prototype.on=function(e,t,n){var r=new i(t,n||this),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.once=function(e,t,n){var r=new i(t,n||this,!0),a=s?s+e:e;return this._events[a]?this._events[a].fn?this._events[a]=[this._events[a],r]:this._events[a].push(r):(this._events[a]=r,this._eventsCount++),this},a.prototype.removeListener=function(e,t,n,i){var a=s?s+e:e;if(!this._events[a])return this;if(!t)return 0==--this._eventsCount?this._events=new r:delete this._events[a],this;var o=this._events[a];if(o.fn)o.fn!==t||i&&!o.once||n&&o.context!==n||(0==--this._eventsCount?this._events=new r:delete this._events[a]);else{for(var u=0,l=[],c=o.length;u<c;u++)(o[u].fn!==t||i&&!o[u].once||n&&o[u].context!==n)&&l.push(o[u]);l.length?this._events[a]=1===l.length?l[0]:l:0==--this._eventsCount?this._events=new r:delete this._events[a]}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&(0==--this._eventsCount?this._events=new r:delete this._events[t])):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prototype.setMaxListeners=function(){return this},a.prefixed=s,a.EventEmitter=a,e.exports=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){return"number"==typeof e&&!isNaN(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isNumeric=t.Delta=void 0;var a=n(0),o=r(a),s=n(1),u=r(s),l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;(0,o.default)(this,e),this._lastValue=t}return(0,u.default)(e,[{key:"calcDelta",value:function(e){var t=e-this._lastValue;return this._lastValue=e,t}},{key:"override",value:function(e){this._lastValue=e}},{key:"lastValue",get:function(){return this._lastValue}}]),e}();t.Delta=l,t.isNumeric=i},function(e,t,n){var r=n(13);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t,n){var r=n(80),i=n(45);e.exports=function(e){return r(i(e))}},function(e,t,n){var r=n(76);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){var r=n(17),i=n(48);e.exports=n(16)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){"use strict";function r(e,t){return parseFloat(e.toFixed(t))}function i(e,t){for(var n=[],r=t>=e?1:-1,i=Math.min(e*r,t*r),a=Math.max(e*r,t*r),o=i;o<=a;o++)n.push(o*r);return n}function a(e,t,n){return Math.min(Math.max(e,t),n)}Object.defineProperty(t,"__esModule",{value:!0}),t.toDecimal=r,t.range=i,t.clamp=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(272),a=r(i),o=n(271),s=r(o),u="function"==typeof s.default&&"symbol"==typeof a.default?function(e){return typeof e}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":typeof e};t.default="function"==typeof s.default&&"symbol"===u(a.default)?function(e){return void 0===e?"undefined":u(e)}:function(e){return e&&"function"==typeof s.default&&e.constructor===s.default&&e!==s.default.prototype?"symbol":void 0===e?"undefined":u(e)}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t,n){var r=n(133),i=n(79);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t,n){var r=n(9),i=n(3),a=n(23);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){"use strict";var r=n(321)(!0);n(81)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=r(i),o=n(15),s=r(o),u=n(0),l=r(u),c=n(1),d=r(c),f=n(4),h=r(f),_=function(){function e(){(0,l.default)(this,e),this._timers=new s.default}return(0,d.default)(e,[{key:"register",value:function(e){var t=e.name;return!this._timers.has(t)&&(this._timers.set(t,e),!0)}},{key:"registerAs",value:function(e,t){return!this._timers.has(e)&&(t.name=e,this._timers.set(e,t),!0)}},{key:"clear",value:function(e){return!!e&&this.clearNamedTimer(e.name)}},{key:"clearNamedTimer",value:function(e){var t=this._timers.get(e);return!!t&&(t.clear(),this._timers.delete(t.name))}},{key:"clearAll",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this._timers.values());!(e=(r=i.next()).done);e=!0){var o=r.value;this.clear(o)||h.default.notify("Cannot remove timer","Timer "+o.id+" was not found in timers map.")}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){e.exports={default:n(275),__esModule:!0}},function(e,t,n){e.exports={default:n(282),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(32),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i.default)(e)}},function(e,t){e.exports={}},function(e,t,n){var r=n(45);e.exports=function(e){return Object(r(e))}},function(e,t,n){n(327);for(var r=n(12),i=n(24),a=n(35),o=n(11)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var l=s[u],c=r[l],d=c&&c.prototype;d&&!d[o]&&i(d,o,l),a[l]=a.Array}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.assertStreamType=t.StreamTypes=void 0;var i=n(270),a=r(i),o=n(56),s=r(o),u={HLS:"hls",DASH:"dash",SMOOTH:"smooth"};(0,s.default)(u);var l=function(e){if(-1===(0,a.default)(u).indexOf(e))throw new TypeError("'"+e+"' is not a valid value for stream type.")};t.StreamTypes=u,t.assertStreamType=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u="Unvalid weight parameter for EMWA: must be an number in ]0,1[",l=function(){function e(t,n){if((0,a.default)(this,e),n<=0||n>=1)throw new Error(u);this._emwaValue=t,this._weight=n}return(0,s.default)(e,[{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null!==t?t:this._weight;this._emwaValue=(1-n)*this._emwaValue+n*e}},{key:"value",get:function(){return this._emwaValue}}],[{key:"Errors",value:function(){return{UNVALID_WEIGHT:u}}},{key:"fromHalfLife",value:function(t,n,r){return new e(t,this.halfLifeToEMAWeight(n,r))}},{key:"halfLifeToEMAWeight",value:function(e,t){var n=e/t;return 1-1/Math.pow(2,1/n)}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(){var e=window&&window.navigator?window.navigator.userAgent:"";return(new o.default).setUA(e).getResult()}function i(){var e=r();return"mobile"===e.device.type||"tablet"===e.device.type||"console"===e.device.type||"Android"===e.os.name||"iOS"===e.os.name}Object.defineProperty(t,"__esModule",{value:!0});var a=n(356),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={getUAObject:r,isMobile:i},e.exports=t.default},function(e,t,n){e.exports={default:n(278),__esModule:!0}},function(e,t,n){e.exports={default:n(294),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(6),a=r(i),o=n(266),s=r(o);t.default=function e(t,n,r){null===t&&(t=Function.prototype);var i=(0,s.default)(t,n);if(void 0===i){var o=(0,a.default)(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(r):void 0}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(63)("meta"),i=n(13),a=n(27),o=n(17).f,s=0,u=Object.isExtensible||function(){return!0},l=!n(23)(function(){return u(Object.preventExtensions({}))}),c=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},d=function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!u(e))return"F";if(!t)return"E";c(e)}return e[r].i},f=function(e,t){if(!a(e,r)){if(!u(e))return!0;if(!t)return!1;c(e)}return e[r].w},h=function(e){return l&&_.NEED&&u(e)&&!a(e,r)&&c(e),e},_=e.exports={KEY:r,NEED:!1,fastKey:d,getWeak:f,onFreeze:h}},function(e,t){t.f={}.propertyIsEnumerable},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(17).f,i=n(27),a=n(11)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n=e.prototype,r=!0,i=!1,o=void 0;try{for(var s,u=(0,h.default)(a(n));!(r=(s=u.next()).done);r=!0){var l=s.value;if((0,d.default)(t[l])!==(0,d.default)(n[l])){var c=t.constructor.name;throw new Error("The method "+l+" of "+e.name+" is not defined in "+c)}}}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}}function a(e){var t=(0,l.default)(e).filter(function(e){return"constructor"!==e}),n=Object.prototype;if((0,s.default)(e)===n)return t;var r=(0,s.default)(e);return t.concat(a(r))}Object.defineProperty(t,"__esModule",{value:!0}),t._getEveryPropertyNames=t.checkInterface=void 0;var o=n(6),s=r(o),u=n(116),l=r(u),c=n(26),d=r(c),f=n(10),h=r(f);t.checkInterface=i,t._getEveryPropertyNames=a},function(e,t,n){"use strict";e.exports=n(182)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(43),h=r(f),_=n(7),p=r(_),v=n(102),E=r(v),m=n(220),S=r(m),g=function(e){function t(e,n,r){(0,s.default)(this,t);var i=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,r));return i._initStats(),i}return(0,p.default)(t,e),(0,l.default)(t,[{key:"_initStats",value:function(){this._stats={cdnDownloaded:0,cdnDuration:0,p2pDownloaded:0,p2pDuration:0}}},{key:"_getSegmentImplementation",value:function(){var e=this,t={result:function(t,n){return t?void e._onHttpError(t):void e._onHttpSuccess(n)},progress:this._handlers.onProgress},n=this._getRange(),r=new S.default(this._sharedState,this._request,this._stats,t,n);this._httpRequest=r.send()}},{key:"_getRange",value:function(){}},{key:"_onHttpError",value:function(e){this._onRequestError(e)}},{key:"_onHttpSuccess",value:function(e){this._onRequestSuccess(e)}},{key:"_abort",value:function(){(0,h.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"_abort",this).call(this),this._httpRequest.abort()}}]),t}(E.default);t.default=g,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return(0,T.default)(e,t)}function a(e){(0,S.default)(e);for(var t=(0,E.default)(e),n=0;n<t.length;n++){var r=t[n],i=e[r];null===i||"object"!==(void 0===i?"undefined":(0,p.default)(i))||(0,h.default)(i)||a(i)}}function o(e,t){for(var n={},r=(0,d.default)(e),i=0;i<r.length;i++){var a=r[i];t!==a&&(n[a]=e[a])}return n}function s(e){return JSON.parse((0,l.default)(e))}Object.defineProperty(t,"__esModule",{value:!0});var u=n(41),l=r(u),c=n(42),d=r(c),f=n(267),h=r(f),_=n(26),p=r(_),v=n(116),E=r(v),m=n(56),S=r(m),g=n(14),T=r(g);t.default={merge:i,deepFreeze:a,omit:o,deepCopy:s},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={SAFE:"safe",UNSAFE:"unsafe"};t.default=r,e.exports=t.default},function(e,t,n){e.exports={default:n(288),__esModule:!0}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var i=n(261),a=r(i),o=n(10),s=r(o);t.default=function(){function e(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,u=(0,s.default)(e);!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,a.default)(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},function(e,t,n){var r=n(44),i=n(11)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,n){var r=n(22),i=n(126),a=n(124),o=n(20),s=n(62),u=n(91),l={},c={},t=e.exports=function(e,t,n,d,f){var h,_,p,v,E=f?function(){return e}:u(e),m=r(n,d,t?2:1),S=0;if("function"!=typeof E)throw TypeError(e+" is not iterable!");if(a(E)){for(h=s(e.length);h>S;S++)if((v=t?m(o(_=e[S])[0],_[1]):m(e[S]))===l||v===c)return v}else for(p=E.call(e);!(_=p.next()).done;)if((v=i(p,m,_.value,t))===l||v===c)return v};t.BREAK=l,t.RETURN=c},function(e,t){e.exports=!0},function(e,t,n){var r=n(20),i=n(129),a=n(79),o=n(85)("IE_PROTO"),s=function(){},u=function(){var e,t=n(78)("iframe"),r=a.length;for(t.style.display="none",n(122).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(87),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(139),l=r(u),c=n(18),d=r(c),f=n(200),h=r(f),_=n(238),p=r(_),v=n(235),E=r(v),m=n(234),S=r(m),g=n(233),T=r(g),y=n(237),C=r(y),D=n(236),A=r(D),w=n(232),R=r(w),P=n(107),b=r(P),k=n(94),I=r(k),O=n(193),N=r(O),L=n(245),M=r(L),U=n(54),B=r(U),x=n(212),F=r(x),H=n(2),G=r(H),j=n(254),V=r(j),W=n(256),K=n(249),q=n(260),Y={WS:"ws",WSS:"wss",HTTPS:"https",HTTP:"http"},Q=function(){function e(t,n,r,i,o,s,u){(0,a.default)(this,e),this.lastStatPayloadTimestamp=Date.now(),this.p2pDownloadBlocker=new V.default,this.p2pUploadBlocker=new V.default;var c=B.default.deepCopy(I.default);this.p2pConfig=t,(0,W.overloadP2PConfig)(c,t,r),this.conf=c;var f=(0,K.formatContentId)({contentId:t.contentId,contentUrl:n});this.eventBus=new d.default,this.workerHelper=new M.default,this.moduleState=new N.default(this,i,u),this.moduleState.content=f,this.isP2PDownloadOn=!0,this.isP2PUploadOn=!0,this.peerToken=l.default.v4(),this.status=new h.default,this.statsProvider=new b.default,this.peerStats=new C.default(this.statsProvider),this.transferStats=new p.default,this.efficiencyStats=new E.default,this.controlStats=new S.default,this.mediaStats=new A.default(i,o,s),this.abrStats=new R.default(this.eventBus),this.bufferStats=new T.default(this.eventBus),this._backendManager=new F.default(this.conf,this.eventBus)}return(0,s.default)(e,[{key:"injectConfigFromDistributor",value:function(e){e.configuration&&((0,W.overloadConfigFromDistributor)(this.conf,e.configuration,e.isClustered),this.eventBus.emit(G.default.Config.CONFIG_UPDATED));var t=this.conf.BACKEND_USE_SSL?Y.HTTPS:Y.HTTP,n=this.conf.BACKEND_USE_SSL?Y.WSS:Y.WS;this.conf.TRACKER_URL=(0,q.formatUrl)(t+"://"+e.trackerDns),this.conf.ANALYTICS.KLARA_URL=(0,q.formatUrl)(t+"://"+e.klaraDns),this.conf.SIGNALING_URL=(0,q.formatUrl)(n+"://"+e.signalingDns),this.status.setBearerToken(e.token),this._decideIfQOSTester(),this.conf.ENCODE_SDP||(this.conf.P2P_PROTOCOL_VERSION+="-uncompressed"),null!=e.contentActivated&&(this.conf.CONTENT_ACTIVATED=e.contentActivated),null!=e.rampUpActivated&&(this.conf.RAMP_UP_ACTIVATED=e.rampUpActivated)}},{key:"setBackendFallbackUrls",value:function(){var e=this.conf.FALLBACK_URLS;this.conf.ANALYTICS.KLARA_URL=(0,q.formatUrl)(e.KLARA_URL),this._decideIfQOSTester()}},{key:"_decideIfQOSTester",value:function(){var e=this.moduleState.isLive()?this.conf.LIVE.QOS_REF_PERCENTAGE:this.conf.QOS_REF_PERCENTAGE;e===parseFloat(e,3)&&100*Math.random()<e&&(this.conf.QOS_P2P_DISABLED=!0);var t=100*Math.random();this.conf.ANALYTICS.ENABLE_STATS_SENDER=t<=this.conf.ANALYTICS.STATS_SENDER_PERCENTAGE,this.conf.ANALYTICS.ENABLE_CONTROL_SENDER=t<=this.conf.ANALYTICS.CONTROL_SENDER_PERCENTAGE}},{key:"dispose",value:function(){this.moduleState.dispose(),this.workerHelper.dispose(),this._backendManager.dispose(),this.mediaStats.dispose()}},{key:"isP2PDownloadBlocked",get:function(){return this.p2pDownloadBlocker.blocked}},{key:"isP2PUploadBlocked",get:function(){return this.p2pUploadBlocker.blocked}}]),e}();t.default=Q,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getSegmentTime",value:function(e){return 0}},{key:"getSegmentList",value:function(e,t,n){return[]}},{key:"getTrackList",value:function(){return[]}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"isEqual",value:function(e){return!1}},{key:"viewToString",value:function(){return""}},{key:"toArrayBuffer",value:function(){return new ArrayBuffer(0)}},{key:"isInTrack",value:function(e){return!1}},{key:"getId",value:function(){return 0}}],[{key:"fromArrayBuffer",value:function(t){return new e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(172),d=r(c),f=n(257),h=r(f),_=function(){function e(t,n){(0,s.default)(this,e),this._sharedState=t,this._namespace=n}return(0,l.default)(e,[{key:"send",value:function(e,t){var n=this._sharedState,r=n.conf,i=n.moduleState,o=n.peerToken,s=r.ANALYTICS.KLARA_URL;e.customer=r.ID_CLIENT,e.content=i.content,e.peerAgentVersion="4.12.0",e.token=o,e.platform=h.default.get();var u=(0,a.default)(e),l=""+s+this._namespace;t&&(l+="/"+t),d.default.send(l,u,this._sharedState)}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u="Method not implemented",l=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getUpdatedRange",value:function(e){throw new Error(u)}},{key:"getFullSegment",value:function(e,t,n){throw new Error(u)}},{key:"isComplete",value:function(){throw new Error(u)}},{key:"isLocked",value:function(){throw new Error(u)}},{key:"p2pSpeed",get:function(){throw new Error(u)}},{key:"p2pAmount",get:function(){throw new Error(u)}},{key:"byteLength",get:function(){throw new Error(u)}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=(0,T.default)(e.split(":"));!(n=(a=o.next()).done);n=!0){var s=a.value;t.push((0,S.default)(s,16))}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return C.default.fromByteArray(new Uint8Array(t))}function a(e){var t=C.default.toByteArray(e),n="",r=!0,i=!1,a=void 0;try{for(var o,s=(0,T.default)(t);!(r=(o=s.next()).done);r=!0){var u=o.value,l=u.toString(16).toUpperCase();l.length<2&&2!==("0"+l).length&&A.default.notify("Decoded illegal DTLS byte 0"+l+" from "+e),2!==l.length&&(l="0"+l[0]),n+=0===n.length?l:":"+l}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function o(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=(0,T.default)(e.split("."));!(r=(o=s.next()).done);r=!0){var u=o.value;n.push((0,S.default)(u,10))}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n.push(Math.floor(t/256)),n.push(t%256),C.default.fromByteArray(new Uint8Array(n))}function s(e){var t=C.default.toByteArray(e);return{ip:t[0]+"."+t[1]+"."+t[2]+"."+t[3],port:256*t[4]+t[5]}}Object.defineProperty(t,"__esModule",{value:!0}),t.BitDataAmount=t.ByteDataAmount=t.DataAmount=t.base64ToIpPort=t.ipPortToBase64=t.base64ToHexHash=t.hexHashToBase64=t.numToUint8Array4=t.uint16ToUint8Array2=void 0;var u=n(6),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(0),p=r(_),v=n(1),E=r(v),m=n(115),S=r(m),g=n(10),T=r(g),y=n(274),C=r(y),D=n(4),A=r(D),w=function(e){var t=Math.floor(e/256),n=e%256;return new Uint8Array([n,t])},R=function(e){var t=w(Math.floor(e/65536)),n=w(e%65536);return new Uint8Array([n[0],n[1],t[0],t[1]])},P=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2;(0,p.default)(this,e),this.decoratedValue={value:t,stringRep:this._format(t,n,r,i,a)}}return(0,E.default)(e,[{key:"_format",value:function(e,t,n,r,i){if(e<1)return"0"+t+r;var a=["","K","M","G","T","P","E","Z","Y"],o=Math.min(Math.floor(Math.log(e)/Math.log(n)),a.length-1);return parseFloat((e/Math.pow(n,o)).toFixed(i))+a[o]+t+r}},{key:"valueOf",value:function(){return this.decoratedValue.value}},{key:"toString",value:function(){return this.decoratedValue.stringRep}}]),e}(),b=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return(0,p.default)(this,t),(0,d.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e,"B",1e3,n,r))}return(0,h.default)(t,e),t}(P),k=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return(0,p.default)(this,t),(0,d.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e,"b",1e3,n,r))}return(0,h.default)(t,e),t}(P);t.uint16ToUint8Array2=w,t.numToUint8Array4=R,t.hexHashToBase64=i,t.base64ToHexHash=a,t.ipPortToBase64=o,t.base64ToIpPort=s,t.DataAmount=P,t.ByteDataAmount=b,t.BitDataAmount=k},function(e,t,n){"use strict";function r(e){if(null===e)throw new Error("Panic! Attempted to unwrap null");if(void 0===e)throw new Error("Panic! Attempted to unwrap undefined");return e}Object.defineProperty(t,"__esModule",{value:!0}),t.unwrap=r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._expirationThreshold=t,this._values=[]}return(0,s.default)(e,[{key:"push",value:function(e){this._cleanExpiredValues(),this._values.push({time:Date.now(),value:e})}},{key:"_cleanExpiredValues",value:function(){for(var e=Date.now();this._values.length>0&&e-this._expirationThreshold>=this._values[0].time;)this._values.shift()}},{key:"subDelta",value:function(e){if(this._cleanExpiredValues(),e>this._expirationThreshold)return null;for(var t=Date.now()-e,n=0;n<this._values.length&&this._values[n].time<=t;)n++;return n<this._values.length-1?this._values[this._values.length-1].value-this._values[n].value:null}},{key:"subTimeDelta",value:function(e){if(this._cleanExpiredValues(),e>this._expirationThreshold)return null;for(var t=Date.now()-e,n=0;n<this._values.length&&this._values[n].time<=t;)n++;return n<this._values.length-1?this._values[this._values.length-1].time-this._values[n].time:null}},{key:"delta",get:function(){return this._cleanExpiredValues(),this._values.length>1?this._values[this._values.length-1].value-this._values[0].value:null}},{key:"timeDelta",get:function(){return this._cleanExpiredValues(),this._values.length>1?this._values[this._values.length-1].time-this._values[0].time:null}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(19),l=function(){function e(){(0,a.default)(this,e);var t=Date.now();this._metricSum=0,this._latestValue=0,this._integralTimestampDelta=new u.Delta(t),this._getterTimestampDelta=new u.Delta(t)}return(0,s.default)(e,[{key:"getAverage",value:function(){var e=this.getIntegral();return e.intervalLength?e.value/e.intervalLength:e.value}},{key:"getIntegral",value:function(){var e=Date.now(),t=this._integralTimestampDelta.calcDelta(e),n=this._getterTimestampDelta.calcDelta(e);this._metricSum+=this._latestValue*t;var r=this._metricSum;return this._metricSum=0,{value:r,intervalLength:n}}},{key:"updateMetric",value:function(e){var t=Date.now(),n=this._integralTimestampDelta.calcDelta(t);this._metricSum+=this._latestValue*n,this._latestValue=e}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){e.exports={default:n(281),__esModule:!0}},function(e,t,n){e.exports={default:n(299),__esModule:!0}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},function(e,t,n){var r=n(13),i=n(12).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){var r=n(44);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){"use strict";var r=n(60),i=n(9),a=n(134),o=n(24),s=n(27),u=n(35),l=n(312),c=n(49),d=n(132),f=n(11)("iterator"),h=!([].keys&&"next"in[].keys()),_=function(){return this};e.exports=function(e,t,n,p,v,E,m){l(n,t,p);var S,g,T,y=function(e){if(!h&&e in w)return w[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},C=t+" Iterator",D="values"==v,A=!1,w=e.prototype,R=w[f]||w["@@iterator"]||v&&w[v],P=R||y(v),b=v?D?y("entries"):P:void 0,k="Array"==t?w.entries||R:R;if(k&&(T=d(k.call(new e)))!==Object.prototype&&(c(T,C,!0),r||s(T,f)||o(T,f,_)),D&&R&&"values"!==R.name&&(A=!0,P=function(){return R.call(this)}),r&&!m||!h&&!A&&w[f]||o(w,f,P),u[t]=P,u[C]=_,v)if(S={values:D?P:y("values"),keys:E?P:y("keys"),entries:b},m)for(g in S)g in w||a(w,g,S[g]);else i(i.P+i.F*(h||A),t,S);return S}},function(e,t,n){var r=n(47),i=n(48),a=n(21),o=n(88),s=n(27),u=n(123),l=Object.getOwnPropertyDescriptor;t.f=n(16)?l:function(e,t){if(e=a(e),t=o(t,!0),u)try{return l(e,t)}catch(e){}if(s(e,t))return i(!r.f.call(e,t),e[t])}},function(e,t){t.f=Object.getOwnPropertySymbols},function(e,t,n){var r=n(24);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},function(e,t,n){var r=n(86)("keys"),i=n(63);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(12),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(13);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){var r=n(12),i=n(3),a=n(60),o=n(90),s=n(17).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},function(e,t,n){t.f=n(11)},function(e,t,n){var r=n(58),i=n(11)("iterator"),a=n(35);e.exports=n(3).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";function r(){var e=s.default.getUAObject();if(!e.ua)return!1;var t=e.browser;return"Edge"===t.name||"Safari"===t.name||"Mobile Safari"===t.name}function i(){return!!(window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection)}function a(e){return!(!(i()&&e.ALLOW_P2P&&e.CONTENT_ACTIVATED)||r())&&(!s.default.isMobile()||e.ENABLE_MOBILE_BROWSER)}Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),s=function(e){return e&&e.__esModule?e:{default:e}}(o);t.default={isP2PAvailable:i,isP2PEnabled:a},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(74),a=r(i),o=n(54),s=r(o),u={BACKEND_USE_SSL:!0,TRACKER_URL:"",SIGNALING_URL:"",FALLBACK_URLS:{KLARA_URL:"https://klara.streamroot.io"},DISTRIBUTOR:{URL:"https://distributor.streamroot.io",OVERRIDDEN:!1,TIMEOUT_DELAY:1e4,MAX_RETRY:1},SIGNALING_DELAY_STEP:1e4,SIGNALING_DELAY_MAX:3e5,SIGNALING_DELAY_MAX_INITIAL:3e4,TRACKER_DELAY_MAX:3e5,TRACKER_DELAY_INIT:2e3,MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE:10,ASK_PEERS_INTERVAL:6e4,ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL:1e4,SEND_TRACKS_INTERVAL:6e4,CONF_LABEL:"default",ANALYTICS:{KLARA_URL:"",EXPOSE_CONF_LABEL:!1,RETRY_NUMBER:3,RETRY_DELAY:1e4,TIMEOUT_DELAY:3e3,TRAFFIC_INTERVAL_ARRAY:function(e){for(var t=e.from,n=e.to,r=e.step,i=[],a=t;a<n;a+=r)i.push(a);return i.push(n),i}({from:5e3,to:12e4,step:1e4}),STATS_INTERVAL:12e4,CONTROL_INTERVAL:6e5,
STATS_SENDER_PERCENTAGE:100,CONTROL_SENDER_PERCENTAGE:100,ENABLE_STATS_SENDER:!0,ENABLE_CONTROL_SENDER:!0},QOS_REF_PERCENTAGE:0,QOS_P2P_DISABLED:!1,ERRORS:{API_KEY:"d04c6fa616c255ac55dec6b068ad7172",HANDLER:"xhr",STAGES:["staging","qa","production"]},PEER_CONNECTION_TIMEOUT:5e4,ICECANDIDATES_TIMEOUT:15e3,SEND_HEARTBEAT_INTERVAL:5e3,CHECK_HEARTBEAT_INTERVAL:1e4,DATACHANNEL_TYPE:"limited-retransmits",DATACHANNEL_MAX_PACKET_LIFETIME:1e3,DATACHANNEL_MAX_RETRANSMITS:1,ENABLE_STUN:!0,ENABLE_TURN:!1,ENCODE_SDP:!0,STUNSERVERS:["stun.l.google.com:19302"],TURNSERVERS:[{urls:"turn:23.97.160.254:3478?transport=udp",credential:"streamroot",username:"streamroot"}],CLIENT_TRACKER_PROTOCOL_VERSION:"3.0.0",P2P_PROTOCOL_VERSION:"3.5.0",CHUNK_SIZE:15360,ALLOW_LIVE_PUSH_SEGMENT:!0,ALLOW_VOD_PUSH_SEGMENT:!0,MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER:80,P2P_CACHE_MAX_SIZE:136314880,MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH:300,GETSEGMENTTIME_CACHE_MAX_SIZE:1e3,NB_SEGMENT_P2P_PREBUFFER:10,MAX_BUFFER_DURATION:300,SEGMENT_ID_ACCEPTABLE_RANGE:a.default,CHUNK_BATCHING_INTERVAL:1e3,CHUNK_TIMEOUT:2500,CHUNK_GRACE_DURATION:1e4,UP_BUFFERED_AMOUNT_LOW_THRESHOLD:15e3,UP_MAX_BUFFERED_AMOUNT:6e4,CHUNK_UP_TIMEOUT:1900,SPLIT_UPLOAD_QUEUE:!1,ENABLE_UPLOAD_DEQUEUE_ALL:!1,LIVE:{LOWER_BUFFER_TARGET:15,HIGHER_BUFFER_TARGET:30,BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT:.1,UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING:6e3,P2P_CACHE_MAX_SIZE:62914560,CHUNK_TIMEOUT:2e3,CHUNK_UP_TIMEOUT:1400,QOS_REF_PERCENTAGE:0,NEAR_EDGE_MARGIN:12e4,LOW_TARGET_P2P_DL_BLOCK_DURATION:2e4,INIT_P2P_DOWNLOAD_BLOCK_DURATION:0,INIT_P2P_UPLOAD_BLOCK_DURATION:0,ENABLE_DYNAMIC_LOWER_TARGET:!1,CRITICAL_LOWER_TARGET_RATIO:.5,FAST_BUFFER_FILL_FRACTION:.5,LOWER_BUFFER_TARGET_DECREASE_STEP:.2,LOWER_BUFFER_TARGET_INCREASE_STEP:.3},BUFFER_CHECK_INTERVAL:100,BUFFER_ZERO_THRESHOLD:2,VOD_CRITICAL_BUFFER_THRESHOLD:-1,VOD_CRITICAL_BUFFER_P2P_STOP_DOWNLOAD_DURATION:2e4,VOD_CRITICAL_BUFFER_P2P_STOP_UPLOAD_DURATION:0,VOD_SAFE_BUFFER_THRESHOLD:10,SPEED_MONITOR_INTERVAL:1e3,MEAN_SPEED_CALCULATION_INTERVAL:500,PEER_UPLOAD_SPEED_EMA_HALF_LIFE:1e4,PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE:15e3,PEER_SPEED_MONITOR_INTERVAL:1e3,PEER_TIMEOUT_RATIO_WINDOW:3e4,PEER_UPLOAD_CAPACITY_SAFE_RATIO:.8,PEER_UPLOAD_CAPACITY_EXTRA_RATIO:.1,PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL:1e3,DEFAULT_PEER_UPLOAD_CAPACITY:1e3,MIN_PEER_UPLOAD_CAPACITY:200,MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO:.1,PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP:.3,PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN:.5,PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO:!1,PUC_EMWA_WEIGHT_CAP:.9,PEER_INIT_LOCKED_DURATION:1e4,PEER_LOCKED_UPLOAD_THRESHOLD:.05,PEER_LOCKED_DOWNLOAD_THRESHOLD:.1,POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON:!1,POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION:5e3,PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE:2e3,PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE:3e3,PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD:.6,LOOSER_UPLOAD_THRESHOLD:50,PEER_POOL_LIMIT:16,PEER_POOL_MAINTENANCE_INTERVAL:1e3,EXPECTED_CONNECTION_SUCCESS_RATE:.4,RESERVED_OFFER_SLOTS:3,CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL:1e3,MAX_TRACKER_EXCLUSION_LENGTH:100,PEER_DISCONNECTED_EXCLUSION_DURATION:6e4,PEER_DISCONNECTED_EXCLUSION_RANK:1,OFFER_DECLINED_EXCLUSION_DURATION:6e4,OFFER_DECLINED_EXCLUSION_RANK:1,PEER_REMOVED_EXCLUSION_DURATION:9e5,PEER_REMOVED_EXCLUSION_RANK:1,PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION:9e5,PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK:1,CDN_SPEED_ESTIMATE_CONSIDER_P2P:!0,CDN_CONCURRENT_SCALING_CAP:1.5,P2P_SPEED_ZERO_THRESHOLD:50,P2P_SPEED_ESTIMATION_BUCKET_DURATION:100,P2P_SPEED_ESTIMATION_BUCKET_COUNT:10,P2P_SPEED_EMA_WEIGHT:.5,P2P_SPEED_EMA_ZERO_HALF_LIFE:12e4,P2P_USEFUL_CALCULATION_INTERVAL:5e3,P2P_USEFUL_SMA_WINDOW:12e4,P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION:50,P2P_USEFUL_RATIO_WEIGHT:.8,ABR_SEGMENT_CDN_RATIO_THRESHOLD:.3,ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD:.3,ABR_CDN_SMALL_SEGMENT_SPEED_UPDATE_RATIO_THRESHOLD:0,ABR_CDN_DL_THRESHOLD:100,ABR_CDN_DL_DECAY_TIME:6e4,USE_COMBINED_ABR_FEEDBACK:!0,BITRATE_ESTIMATION_WINDOW:3e4,ENABLE_PREBUFFER_FEEDBACK:!1,BLOCK_SEEDER_SCHEDULING_WINDOW:6e4,BLOCK_SEEDER_SCHEDULING_DURATION:12e4,BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD:1.1,BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD:50,PEER_COMPUTE_RTT_INTERVAL:5e3,USE_CONTINOUS_PROGRESS_FEEDBACK:!1,PROGRESS_ADD_TOTAL:!1,ENABLE_LATENCY_FEEDBACK:!1,LATENCY_CAPPING_RATIO:.5,MAX_PEER_CONNECTION_FAILURES:a.default,SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS:null,TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND:null,LOCKED_RETRY_INTERVAL:30,LOCKED_RETRY_TIMEOUT:500,TIMEOUT_GET_FULL_SEGMENT:500,RETURN_COPY_SEGMENT:!0,ENABLE_FIX_UNRELIABLE_SEGMENT_TIME:!1,ALLOW_P2P:!0,DEVICE_INFO:"",ID_CLIENT:"",ENABLE_MOBILE_BROWSER:!1,CONTENT_ACTIVATED:!0,RAMP_UP_ACTIVATED:!0,ENABLE_PLAYBACK_ERROR_LOGGING:!1,DEBUG:!1,ENABLE_FILTER_BANNED_SEEDERS:!1,ENABLE_PUSH_SEGMENT_OPTIM:!1,ENABLE_P2P_SCHEDULER_OPTIM:!1,ENABLE_FUNNEL_GETSEGMENT_CALLBACKS:!1,ENABLE_RANGE_REQUEST_DETECTION:!1,ENABLE_TRACK_EDGE_GC_BLOCK:!1,P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION:0,RANGE_REQUEST_DETECTION:!0,RR_DETECTION_MIN_BUFFER_LEVEL:10};s.default.deepFreeze(u),t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function e(t){(0,i.default)(this,e),this.message=t.error.message,this.stacktrace=t.error.stack,this.fileName=t.filename,this.lineNumber=t.lineno,this.columnNumber=t.colno?t.colno:void 0};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(118),a=r(i),o=n(34),s=r(o),u=n(0),l=r(u),c=n(1),d=r(c),f=n(5),h=n(25),_=n(54),p=r(_),v=n(53),E={GET:"GET",POST:"POST"},m={JSON:"json",ARRAY_BUFFER:"arraybuffer"},S={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},g={INVALID_STATUS:"Response status is not part of valid status codes",REQUEST_ABORTED:"Request has been aborted",REQUEST_ERROR:"An error occured while sending the request",REQUEST_TIMEOUT:"Request timeout"},T=function(){function e(t,n,r){(0,l.default)(this,e),this._method=t,this._url=n,this._retryCount=0,this._aborted=!1,this._options=p.default.merge({responseType:e.ResponseTypes.JSON,validStatusCodes:[].concat((0,s.default)((0,h.range)(200,206)),[304]),timeout:0,retry:0,retryDelay:0,withCredentials:!1,headers:{},events:{onprogress:v.noop}},r)}return(0,d.default)(e,[{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new a.default(function(n,r){function i(){var e=this;this._send(t).then(function(e){n(e)}).catch(function(t){return e._retryCount===e._options.retry?void r(t):(e._retryCount++,void(0,f.createTimeout)(function(){e._init(),i.call(e)},e._options.retryDelay))})}i.call(e)})}},{key:"abort",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"_send",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"_init",value:function(){throw new TypeError("Cannot call abstract method")}},{key:"isStreamroot",set:function(e){this._isStreamrootEndpoint=e}}]),e}();T.Methods=E,T.ResponseTypes=m,T.ReadyStates=S,T.Errors=g,t.default=T,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;(0,a.default)(this,e),this._message=t,this._status=n}return(0,s.default)(e,[{key:"message",get:function(){return this._message}},{key:"status",get:function(){return this._status}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t,n,r){(0,a.default)(this,e),this._segmentCoord=t,this._chunkIndex=n,this._bandwidthSafety=r,this._timestamp=Date.now()}return(0,s.default)(e,[{key:"segmentCoord",get:function(){return this._segmentCoord}},{key:"chunkIndex",get:function(){return this._chunkIndex}},{key:"bandwidthSafety",get:function(){return this._bandwidthSafety}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){var i=t?g.default.Methods.POST:g.default.Methods.GET,a=new g.default(i,e,{headers:{Authorization:r}}),s=t?(0,o.default)(t):null;return a.isStreamroot=!0,a.send(s).then(function(e){n(null,e)},function(e){n(e,null)}),a}Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_TRACK_HASH=void 0;var a=n(41),o=r(a),s=n(14),u=r(s),l=n(0),c=r(l),d=n(1),f=r(d),h=n(18),_=r(h),p=n(31),v=r(p),E=n(5),m=n(71),S=n(51),g=r(S),T=n(2),y=r(T),C=n(4),D=r(C),A={TRACKS:"tracks",RECONNECT:"reconnect"},w={INIT:"init",PEERS:"peers",TRACKS:"tracks"},R=t.DEFAULT_TRACK_HASH="defautTrackHash",P=function(){function e(t,n,r){var i=this;(0,c.default)(this,e),this._conf=r.conf,this._eventBus=r.eventBus,this._status=r.status,this._moduleState=r.moduleState,this._controlStats=r.controlStats;var a=new _.default;this._trackerProtocolVersion=this._conf.CLIENT_TRACKER_PROTOCOL_VERSION,this._playerInterface=t,this._p2pCacheStats=n,this._connected=!1,this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._timerStore=new v.default,this._callQueue=[],this._pending=!1,this.getEE=function(){return a},this._onConnectionRequest=function(){i._init()},this._onTemporaryDisconnectionRequest=function(){i.disconnect()},this._onPermanentDisconnectionRequest=function(){i._isPermanentlyDisconnected=!0,i.disconnect()},r.eventBus.once(y.default.Distributor.ANSWERED,this._onConnectionRequest),r.eventBus.on(y.default.Tracker.TRACKER_RECONNECTION_REQUEST,this._onConnectionRequest),r.eventBus.on(y.default.Tracker.TEMP_TRACKER_DISCONNECTION_REQUEST,this._onTemporaryDisconnectionRequest),r.eventBus.on(y.default.Tracker.PERM_TRACKER_DISCONNECTION_REQUEST,this._onPermanentDisconnectionRequest)}return(0,f.default)(e,null,[{key:"Status",get:function(){return{READY:"tracker_ready",ERROR:"tracker_error",CONTENT_DEACTIVATED:"content_deactivated",RAMP_UP_DEACTIVATED:"ramp_up_deactivated",QOS_TESTER:"qos_tester",OTHER:"other"}}}]),(0,f.default)(e,[{key:"dispose",value:function(){this._eventBus.removeListener(y.default.Distributor.ANSWERED,this._onConnectionRequest),this._eventBus.removeListener(y.default.Tracker.TRACKER_RECONNECTION_REQUEST,this._onConnectionRequest),this._eventBus.removeListener(y.default.Tracker.TEMP_TRACKER_DISCONNECTION_REQUEST,this._onTemporaryDisconnectionRequest),this._eventBus.removeListener(y.default.Tracker.PERM_TRACKER_DISCONNECTION_REQUEST,this._onPermanentDisconnectionRequest),this._isPermanentlyDisconnected=!0,this.disconnect(),this._timerStore.clearAll(),this._currentHttpRequest&&(this._currentHttpRequest.abort(),this._currentHttpRequest=null)}},{key:"_getVideoTrackHash",value:function(){var e=this._moduleState.currentTracks.video;return e?e.viewToString():R}},{key:"askPeers",value:function(e,t){var n=function(e,n){t(e,[n])},r={tracks:[this._getVideoTrackHash()],exclusions:e,peer_number:this._conf.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE,current_position:this._moduleState.videoCurrentTime,id:(0,m.unwrap)(this._peerID)};this._injectBufferIntoPayload(r),this._sendRequest(w.PEERS,r,n,!0)}},{key:"_init",value:function(){if(this._isPermanentlyDisconnected||!0===this._conf.QOS_P2P_DISABLED||!this._conf.CONTENT_ACTIVATED||!this._conf.RAMP_UP_ACTIVATED){var t=void 0;return t=this._conf.RAMP_UP_ACTIVATED?!0===this._conf.QOS_P2P_DISABLED?e.Status.QOS_TESTER:this._conf.CONTENT_ACTIVATED?e.Status.OTHER:e.Status.CONTENT_DEACTIVATED:e.Status.RAMP_UP_DEACTIVATED,void this._eventBus.emit(y.default.Tracker.BLOCKED,{reason:t})}this._trackerURL=this._conf.TRACKER_URL,this._bearerToken=this._status.getBearerToken();var n=(0,m.unwrap)(this._moduleState.content),r=this._conf.P2P_PROTOCOL_VERSION,i=this._conf.ID_CLIENT,a=this._moduleState.isLive(),o=this._status.getTrackerId(),s=void 0;s=a?{content:n,p2p_protocol:r,customer_id:i,is_live:a,buffer_level_max:this._playerInterface.getBufferLevelMax(),tracker_id:o}:{content:n,p2p_protocol:r,customer_id:i,is_live:a,tracker_id:o},this._sendRequest(w.INIT,s,this._onTrackerReady.bind(this),!0)}},{key:"_onTrackerReady",value:function(t,n){if(t)return D.default.notifyError(t),void this._eventBus.emit(y.default.Tracker.FAILED,{reason:e.Status.ERROR});this._peerID=n.peer_id,this._status.setMyPeerId(this._peerID);var r=(0,E.createInterval)(this._publishTracks.bind(this),this._conf.SEND_TRACKS_INTERVAL);this._timerStore.registerAs(A.TRACKS,r),this._status.setConnected(!0),this._status.setTrackerId(n.tracker_id),this._connected=!0,this._eventBus.emit(y.default.Tracker.READY),this.getEE().emit(e.Status.READY)}},{key:"_publishTracks",value:function(){var e={tracks:[this._getVideoTrackHash()],id:(0,m.unwrap)(this._peerID),current_position:this._moduleState.videoCurrentTime};this._injectBufferIntoPayload(e),this._sendRequest(w.TRACKS,e,function(){},!0)}},{key:"_injectBufferIntoPayload",value:function(e){var t=this._p2pCacheStats.getStats();t&&(this._moduleState.isLive()&&(t.near_edge=this._moduleState.isNearEdge),(0,u.default)(e,{buffer:t}))}},{key:"_sendRequest",value:function(e,t,n,r){var a=this;switch(e){case w.INIT:this._controlStats.sentTrackerInitCount++;break;case w.PEERS:this._controlStats.sentTrackerPeersCount++;break;case w.TRACKS:this._controlStats.sentTrackerTracksCount++;break;default:D.default.notifyError(new Error("Unexpected tracker route: "+e))}var o=function(e,t){if(a._currentHttpRequest=null,!a._moduleState.peerAgentDisposed){if(e&&r)return a.disconnect(),a._scheduleReconnect(),void n(e,t);var o=a._callQueue.shift();void 0===o?a._pending=!1:a._currentHttpRequest=i(o.url,o.data,o.callback,a._bearerToken),n(e,t)}},s=this._trackerURL+e;this._pending?this._callQueue.push({url:s,data:t,callback:o}):(this._pending=!0,this._currentHttpRequest=i(s,t,o,this._bearerToken))}},{key:"disconnect",value:function(){this._timerStore.clearNamedTimer(A.TRACKS),this._timerStore.clearNamedTimer(A.RECONNECT),this._pending=!1,this._callQueue=[],!0===this._connected&&(this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._status.setConnected(!1),this._connected=!1,i(this._trackerURL+"bye",{id:(0,m.unwrap)(this._peerID)},function(){},this._bearerToken),this.getEE().emit("tracker_disconnected"))}},{key:"_scheduleReconnect",value:function(){var e=(0,E.createTimeout)(this._init.bind(this),this._delayReconnection);this._timerStore.registerAs(A.RECONNECT,e),this._delayReconnection=Math.min(2*this._delayReconnection,this._conf.TRACKER_DELAY_MAX)}}]),e}();t.default=P},function(e,t,n){"use strict";e.exports=n(204)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={IDLE:"IDLE",NO_PEER:"NO_PEER",RANDOM:"RANDOM",DYNAMIC:"DYNAMIC",TOP_SEEDER:"TOP_SEEDER"};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(53),l=function(){function e(t,n,r){(0,a.default)(this,e),this._sharedState=t,this._request=n,this._handlers=r}return(0,s.default)(e,[{key:"getSegment",value:function(){try{this._getSegmentImplementation()}catch(e){this._onRequestFallback(e)}return{abort:this._abort.bind(this)}}},{key:"_getSegmentImplementation",value:function(){throw new Error("Cannot call abstract method")}},{key:"_onRequestSuccess",value:function(e){this._incSuccessStats(),this._handlers.onSuccess(e,this._stats,this._request)}},{key:"_onRequestError",value:function(e){this._handlers.onError(e,this._request)}},{key:"_onRequestFallback",value:function(e){this._handlers.onFallback(e)}},{key:"_abort",value:function(){this._noopHandlers(),this._incAbortStats()}},{key:"_noopHandlers",value:function(){this._handlers.onSuccess=u.noop,this._handlers.onFallback=u.noop}},{key:"_incSuccessStats",value:function(){this._sharedState.controlStats.getSegmentSuccess++}},{key:"_incAbortStats",value:function(){this._sharedState.mediaStats.abortFragmentCount++}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=r(u),c=n(2),d=r(c),f=n(5),h=function(){function e(t,n){(0,a.default)(this,e),this._sharedState=t,this._partialSegment=n,this._eventEmitter=new l.default}return(0,s.default)(e,[{key:"once",value:function(e,t){this._eventEmitter.once(e,t)}},{key:"_emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._eventEmitter).emit.apply(t,[e].concat(r)),this.removeAllListeners()}},{key:"removeAllListeners",value:function(){this._eventEmitter.removeAllListeners()}},{key:"fillSegment",value:function(e){var t=this;try{this._partialSegment.getFullSegment({response:e},this._onSegmentFillSuccess.bind(this),this._onSegmentFillError.bind(this))}catch(e){return void this._onSegmentFillError(e)}(0,f.createTimeout)(function(){t._onSegmentFillError()},this._sharedState.conf.TIMEOUT_GET_FULL_SEGMENT)}},{key:"_onSegmentFillSuccess",value:function(e){this._emit(d.default.SegmentFiller.SUCCESS,e.response)}},{key:"_onSegmentFillError",value:function(e){this._emit(d.default.SegmentFiller.FALLBACK,e)}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return"bytes="+e.start+"-"+(e.end||"")}function i(e,t){var n={},i=e.headers;if(i&&void 0!==i.length)throw new Error("Custom headers object should not have a `length` attribute (you might use the previous API format)");return i&&(0,s.default)(n,i),t&&(n.Range=r(t)),n}function a(e){var t=e.headers;if(t&&void 0!==t.Range){var n=t.Range.split("="),r=n[1].split("-"),i=parseInt(r[0],10),a=parseInt(r[1],10);return isNaN(a)?{start:i}:{start:i,end:a}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeFromRequest=t.getHttpRequestHeaders=void 0;var o=n(14),s=function(e){return e&&e.__esModule?e:{default:e}}(o);t.getHttpRequestHeaders=i,t.getRangeFromRequest=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=r(i),o=n(15),s=r(o),u=n(75),l=r(u),c=n(10),d=r(c),f=n(0),h=r(f),_=n(1),p=r(_),v=n(241),E=r(v),m=n(192),S=r(m),g=n(2),T=r(g),y=n(4),C=r(y),D=n(38),A=function(){function e(t,n,r,i){(0,h.default)(this,e),this._reachedLiveEdge=!1,this._cachedSegmentToDownload=[],this._sharedState=i,this._currentTracks=i.moduleState.currentTracks,this._p2pCache=n,this._distributedSegmentList=r,this._mediaMapCache=new S.default(t,i),this._edges=new E.default(this._mediaMapCache,i)}return(0,p.default)(e,[{key:"_getSegmentsToDownloadByTrack",value:function(e,t){var n=[],r=void 0;if(r="audio"===t?this._edges.audio:this._edges.video){var i=this._mediaMapCache.getSegmentListAfterEdge(e,r,this._sharedState.conf.MAX_BUFFER_DURATION),a=this._distributedSegmentList.getSegmentListAfter(r),o=this._mergeDedupe(i,a),s=this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM&&0===o.length?[]:this._p2pCache.listSegmentsToSkipForTrack(e);if("video"===t){var u=this._sharedState.conf.ENABLE_PREBUFFER_FEEDBACK||this._sharedState.conf.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME?!i.length:i.length<=1;u!==this._reachedLiveEdge&&(this._reachedLiveEdge=u,this._sharedState.eventBus.emit(T.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,u))}if(n=this._getDifference(o,s),this._sharedState.conf.ENABLE_PREBUFFER_FEEDBACK&&this._checkNextSegmentPrebuffered(t,o,n),null===this._mediaMapCache.getSegmentTime(r))C.default.notifyError(new Error("Unexpected getSegmentTime error: track edge timestamp is not supposed to be unreliable"));else if(this._sharedState.moduleState.isLive()){var l=this._sharedState.moduleState.streamType===D.StreamTypes.HLS?i:o;if(l.length>1){var c=l[0],d=l[l.length-1],f=this._mediaMapCache.getSegmentTime(c),h=this._mediaMapCache.getSegmentTime(d);if(null!==f&&null!==h){var _=h-f;this._sharedState.moduleState.isNearEdge=_<=this._sharedState.conf.LIVE.NEAR_EDGE_MARGIN/1e3}else C.default.notify(new Error("Unexpected getSegmentTime error: 1st and last segments in range are unreliable")),this._sharedState.moduleState.isNearEdge=!0}else this._sharedState.moduleState.isNearEdge=!0}}return n}},{key:"_checkNextSegmentPrebuffered",value:function(e,t,n){this._sharedState.moduleState.nextSegmentPrebuffered[e]=t.length>=2&&(!n.length||!t[0].isEqual(n[0])&&!t[1].isEqual(n[0]))}},{key:"isSegmentRequested",value:function(e){if(this._sharedState.conf.ENABLE_PUSH_SEGMENT_OPTIM){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,d.default)(this._cachedSegmentToDownload);!(t=(i=a.next()).done);t=!0){var o=i.value;if(e.isEqual(o)){var s=this._p2pCache.getSegmentHandler(e);return s&&s.chunkManager.shouldDownloadSegment()}}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return this._cachedSegmentToDownload.length<this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER&&this.isSegmentInAcceptableRange(e)}var u=this.getSegmentListToDownload(),l=!0,c=!1,f=void 0;try{for(var h,_=(0,d.default)(u);!(l=(h=_.next()).done);l=!0){var p=h.value;if(e.isEqual(p))return!0}}catch(e){c=!0,f=e}finally{try{!l&&_.return&&_.return()}finally{if(c)throw f}}return!1}},{key:"isSegmentInAcceptableRange",value:function(e){for(var t=!1,n=["audio","video"],r=0;r<n.length;r++){var i=n[r],a=this._edges[i];t=t||!!a&&e.isInTrack(a.trackView)&&e.getId()>a.getId()&&e.getId()-a.getId()<=this._sharedState.conf.SEGMENT_ID_ACCEPTABLE_RANGE}return t}},{key:"_getDifference",value:function(e,t){if(this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM){if(0===t.length||0===e.length)return e;var n=new l.default(t.map(function(e){return e.viewToString()}));return e.filter(function(e){return!n.has(e.viewToString())})}return e.filter(function(e){return void 0===t.find(function(t){return e.isEqual(t)})})}},{key:"_mergeDedupe",value:function(e,t){var n=new s.default,r=!0,i=!1,o=void 0;try{for(var u,l=(0,d.default)(e);!(r=(u=l.next()).done);r=!0){var c=u.value;n.set(c.viewToString(),c)}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}var f=!0,h=!1,_=void 0;try{for(var p,v=(0,d.default)(t);!(f=(p=v.next()).done);f=!0){var E=p.value;n.set(E.viewToString(),E)}}catch(e){h=!0,_=e}finally{try{!f&&v.return&&v.return()}finally{if(h)throw _}}return(0,a.default)(n.values())}},{key:"getCachedSegmentListToDownload",value:function(){return this._cachedSegmentToDownload}},{key:"getSegmentListToDownload",value:function(){throw new Error("Cannot call abstract method")}},{key:"updateTrackEdge",value:function(e){throw new Error("Cannot call abstract method")}},{key:"getEdgeSegment",value:function(){return this._edges.video}},{key:"dispose",value:function(){this._mediaMapCache.dispose()}}]),e}();t.default=A,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={PeerStats:{SAMPLED_PUC:"sampledPUC",SAMPLED_LIVE_CONNECTION_RTT:"sampledLiveConnectionRtt",TOTAL_CONNECTION_DURATION:"totalConnectionDuration"}},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._providers={}}return(0,s.default)(e,[{key:"registerProvider",value:function(e,t){this._providers[e]=t}},{key:"getStat",value:function(e){var t=this._providers[e];if(t)return t()}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(56),a=r(i),o=n(0),s=r(o),u=n(19),l=n(50),c=n(67),d=r(c),f=function e(t,n,r){if((0,s.default)(this,e),(0,l.checkInterface)(d.default,t),!(0,u.isNumeric)(n))throw new Error("Invalid value for size");if(!r)throw new Error("No hash");this.segmentCoord=t,this.size=n,this.hash=r,(0,a.default)(this)};t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){e.length=0}function i(e,t){for(var n=0,r=e.length-1;r>=0;r--)(0,o.default)(e[r],t)&&(e.splice(r,1),n++);return n}Object.defineProperty(t,"__esModule",{value:!0});var a=n(268),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={clear:r,withoutAll:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._internalQueue=t}return(0,s.default)(e,[{key:"_canDequeue",value:function(){return!0}},{key:"_dequeuedCallback",value:function(e){}},{key:"_emptyCallback",value:function(){}},{key:"_validateItem",value:function(e){return!0}},{key:"push",value:function(e){this._internalQueue.push(e),this.tryDequeue()}},{key:"_skipInvalidItems",value:function(){for(var e=this._internalQueue.shift();void 0!==e&&!this._validateItem(e);)e=this._internalQueue.shift();return e}},{key:"tryDequeue",value:function(){if(this._canDequeue()){var e=this._skipInvalidItems();e?this._dequeuedCallback(e):this._emptyCallback()}}},{key:"tryDequeueN",value:function(e){for(;this._canDequeue()&&e>0;){var t=this._skipInvalidItems();if(!t){this._emptyCallback();break}this._dequeuedCallback(t),e--}}},{key:"tryDequeueAll",value:function(){for(;this._canDequeue();){var e=this._skipInvalidItems();if(!e){this._emptyCallback();break}this._dequeuedCallback(e)}}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(0===e.length)return null;e.sort(function(e,t){return e-t});var t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])/2}function i(e){if(0===e.length)return null;for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function a(e){var t=i(e);if(!t)return null;for(var n=0,r=0;r<e.length;r++)n+=Math.abs(e[r]-t);return n/e.length}Object.defineProperty(t,"__esModule",{value:!0}),t.default={median:r,mean:i,meanAbsoluteDeviation:a},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._maxSize=t,this._internalQueue=[]}return(0,s.default)(e,[{key:"addSample",value:function(e){this._internalQueue.length>=this._maxSize&&this._internalQueue.shift(),this._internalQueue.push(e)}},{key:"fetchSample",value:function(){if(this._internalQueue.length>0){var e=Math.floor(Math.random()*this._internalQueue.length);return this._internalQueue.splice(e,1)[0]}}},{key:"mean",get:function(){return this.length>0?this._internalQueue.reduce(function(e,t){return e+t})/this.length:0}},{key:"length",get:function(){return this._internalQueue.length}},{key:"sampleList",get:function(){return this._internalQueue}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(115),a=r(i),o=n(10),s=r(o),u=n(32),l=r(u),c=n(40),d=r(c),f=n(70),h=window.RTCPeerConnection||window.webkitRTCPeerConnection,_=window.RTCIceCandidate,p=window.RTCSessionDescription,v=function(e){return new h(E(e),{optional:[{DtlsSrtpKeyAgreement:!0}]})},E=function(e){var t=e.ENABLE_STUN,n=e.ENABLE_TURN;if(!t&&!n)return{};var r=t?[{urls:e.STUNSERVERS.map(function(e){return"stun:"+e})}]:[];return{iceServers:n?e.TURNSERVERS.concat(r):r}},m=function(e,t){"Firefox"===d.default.getUAObject().browser.name?e.getStats(null,function(e){t((0,l.default)(e.values()))},function(){}):e.getStats(function(e){var n=[];e.result().forEach(function(e){var t={};e.names().forEach(function(n){t[n]=e.stat(n)}),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,n.push(t)}),t(n)})},S=function(e,t){"Firefox"!==d.default.getUAObject().browser.name&&m(e,function(e){var n=!0,r=!1,i=void 0;try{for(var a,o=(0,s.default)(e);!(n=(a=o.next()).done);n=!0){var u=a.value;if(u.googRtt)return void t(parseFloat(u.googRtt))}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}})},g=/^a=ice-ufrag:(.+)/,T=/^a=ice-pwd:(.+)/,y=/^a=fingerprint:sha-256 ([A-F0-9]{2}(?::[A-F0-9]{2}){31})/,C=/^a=candidate:.* (?:udp|UDP) .* ([0-9]{1,3}(?:\.[0-9]{1,3}){3}) ([0-9]{1,5}) typ ([a-zA-Z]+)(?: raddr ([0-9]{1,3}(?:\.[0-9]{1,3}){3}) rport ([0-9]{1,5}))?/,D=function(e,t){var n="",r="",i="",o=[],u=!0,l=!1,c=void 0;try{for(var d,h=(0,s.default)(e.split("\n"));!(u=(d=h.next()).done);u=!0){var _=d.value,p=g.exec(_);null===p?(p=T.exec(_),null===p?(p=y.exec(_),null===p?null===(p=C.exec(_))||o.push({globalIp:p[1],globalPort:p[2],type:p[3],localIp:p[4],localPort:p[5]}):i=p[1]):r=p[1]):n=p[1]}}catch(e){l=!0,c=e}finally{try{!u&&h.return&&h.return()}finally{if(l)throw c}}var v="";"offer"===t?v+="O":"answer"===t&&(v+="A"),v+=","+n+","+r,v+=","+(0,f.hexHashToBase64)(i);var E=!0,m=!1,S=void 0;try{for(var D,A=(0,s.default)(o);!(E=(D=A.next()).done);E=!0){var w=D.value,R="";if("host"===w.type)R+=",H";else{if("srflx"!==w.type)continue;R+=",S"}if(R+=","+(0,f.ipPortToBase64)(w.globalIp,(0,a.default)(w.globalPort,10)),"srflx"===w.type){if(!w.localIp||!w.localPort)continue;R+=","+(0,f.ipPortToBase64)(w.localIp,(0,a.default)(w.localPort,10))}v+=R}}catch(e){m=!0,S=e}finally{try{!E&&A.return&&A.return()}finally{if(m)throw S}}return v},A=function(e){for(var t=e.split(","),n=t.shift(),r=t.shift(),i=t.shift(),a=(0,f.base64ToHexHash)(t.shift()),o=[];t.length>0;){var u=t.shift(),l=(0,f.base64ToIpPort)(t.shift()),c=void 0;"S"===u&&(c=(0,f.base64ToIpPort)(t.shift())),o.push({type:"S"===u?"srflx":"host",globalIp:l.ip,globalPort:l.port.toString(),localIp:c?c.ip:void 0,localPort:c?c.port.toString():void 0})}var d="v=0\n        o=- 2533049204347174788 2 IN IP4 127.0.0.1\n        s=-\n        t=0 0\n        a=msid-semantic: WMS\n        m=application 59118 DTLS/SCTP 5000\n        c=IN IP4 0.0.0.0\n        a=sctpmap:5000 webrtc-datachannel 1024\n        a=setup:"+("O"===n?"actpass":"active")+"\n        a=ice-ufrag:"+r+"\n        a=ice-pwd:"+i+"\n        a=fingerprint:sha-256 "+a,h=1,_=!0,p=!1,v=void 0;try{for(var E,m=(0,s.default)(o);!(_=(E=m.next()).done);_=!0){var S=E.value;d+="\na=candidate:"+(h-1)+" 1 udp "+h+" "+S.globalIp+" "+S.globalPort+" typ "+S.type,S.localIp&&S.localPort&&(d+=" raddr "+S.localIp+" rport "+S.localPort),h++}}catch(e){p=!0,v=e}finally{try{!_&&m.return&&m.return()}finally{if(p)throw v}}return d+="\n",d.replace(/^\s+/gm,"")};t.default={createPeerConnection:v,getPeerConnectionRTT:S,IceCandidate:_,SessionDescription:p,getStats:m,encodeFullSdp:D,decodeSdp:A},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.TIMER_TYPE=t.AbstractTimer=void 0;var i=n(0),a=r(i),o=n(1),s=r(o),u=n(139),l=r(u),c={TIMEOUT:0,INTERVAL:1},d=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c.TIMEOUT;(0,a.default)(this,e),this._id="timer-"+l.default.v4(),this._name=this._id,this._callback=t,this._time=n,this._type=r,this._isRepeatable=r===c.INTERVAL}return(0,s.default)(e,[{key:"clear",value:function(){throw new Error("Cannot call abstract method")}},{key:"id",get:function(){return this._id}},{key:"name",set:function(e){this._name=e},get:function(){return this._name}}]),e}();t.AbstractTimer=d,t.TIMER_TYPE=c},function(e,t,n){e.exports={default:n(283),__esModule:!0}},function(e,t,n){e.exports={default:n(290),__esModule:!0}},function(e,t,n){e.exports={default:n(295),__esModule:!0}},function(e,t,n){e.exports={default:n(298),__esModule:!0}},function(e,t,n){"use strict";var r=n(17).f,i=n(61),a=n(84),o=n(22),s=n(77),u=n(45),l=n(59),c=n(81),d=n(128),f=n(135),h=n(16),_=n(46).fastKey,p=h?"_s":"size",v=function(e,t){var n,r=_(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var d=e(function(e,r){s(e,d,t,"_i"),e._i=i(null),
e._f=void 0,e._l=void 0,e[p]=0,void 0!=r&&l(r,n,e[c],e)});return a(d.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[p]=0},delete:function(e){var t=this,n=v(t,e);if(n){var r=n.n,i=n.p;delete t._i[n.i],n.r=!0,i&&(i.n=r),r&&(r.p=i),t._f==n&&(t._f=r),t._l==n&&(t._l=i),t[p]--}return!!n},forEach:function(e){s(this,d,"forEach");for(var t,n=o(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!v(this,e)}}),h&&r(d.prototype,"size",{get:function(){return u(this[p])}}),d},def:function(e,t,n){var r,i,a=v(e,t);return a?a.v=n:(e._l=a={i:i=_(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=a),r&&(r.n=a),e[p]++,"F"!==i&&(e._i[i]=a)),e},getEntry:v,setStrong:function(e,t,n){c(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?d(0,n.k):"values"==t?d(0,n.v):d(0,[n.k,n.v]):(e._t=void 0,d(1))},n?"entries":"values",!n,!0),f(t)}}},function(e,t,n){var r=n(58),i=n(303);e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},function(e,t,n){"use strict";var r=n(12),i=n(9),a=n(46),o=n(23),s=n(24),u=n(84),l=n(59),c=n(77),d=n(13),f=n(49),h=n(17).f,_=n(305)(0),p=n(16);e.exports=function(e,t,n,v,E,m){var S=r[e],g=S,T=E?"set":"add",y=g&&g.prototype,C={};return p&&"function"==typeof g&&(m||y.forEach&&!o(function(){(new g).entries().next()}))?(g=t(function(t,n){c(t,g,e,"_c"),t._c=new S,void 0!=n&&l(n,E,t[T],t)}),_("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in y&&(!m||"clear"!=e)&&s(g.prototype,e,function(n,r){if(c(this,g,e),!t&&m&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i})}),"size"in y&&h(g.prototype,"size",{get:function(){return this._c.size}})):(g=v.getConstructor(t,e,E,T),u(g.prototype,n),a.NEED=!0),f(g,e),C[e]=g,i(i.G+i.W+i.F,C),m||v.setStrong(g,e,E),g}},function(e,t,n){e.exports=n(12).document&&document.documentElement},function(e,t,n){e.exports=!n(16)&&!n(23)(function(){return 7!=Object.defineProperty(n(78)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(35),i=n(11)("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||a[i]===e)}},function(e,t,n){var r=n(44);e.exports=Array.isArray||function(e){return"Array"==r(e)}},function(e,t,n){var r=n(20);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&r(a.call(e)),t}}},function(e,t,n){var r=n(11)("iterator"),i=!1;try{var a=[7][r]();a.return=function(){i=!0},Array.from(a,function(){throw 2})}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var a=[7],o=a[r]();o.next=function(){return{done:n=!0}},a[r]=function(){return o},e(a)}catch(e){}return n}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t,n){var r=n(17),i=n(20),a=n(28);e.exports=n(16)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){var r=n(21),i=n(131).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(e){try{return i(e)}catch(e){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?s(e):i(r(e))}},function(e,t,n){var r=n(133),i=n(79).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},function(e,t,n){var r=n(27),i=n(36),a=n(85)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){var r=n(27),i=n(21),a=n(304)(!1),o=n(85)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(l,n)||l.push(n));return l}},function(e,t,n){e.exports=n(24)},function(e,t,n){"use strict";var r=n(12),i=n(3),a=n(17),o=n(16),s=n(11)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];o&&t&&!t[s]&&a.f(t,s,{configurable:!0,get:function(){return this}})}},function(e,t){e.exports="\t\n\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029\ufeff"},function(e,t,n){var r,i,a,o=n(22),s=n(310),u=n(122),l=n(78),c=n(12),d=c.process,f=c.setImmediate,h=c.clearImmediate,_=c.MessageChannel,p=0,v={},E=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},m=function(e){E.call(e.data)};f&&h||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++p]=function(){s("function"==typeof e?e:Function(e),t)},r(p),p},h=function(e){delete v[e]},"process"==n(44)(d)?r=function(e){d.nextTick(o(E,e,1))}:_?(i=new _,a=i.port2,i.port1.onmessage=m,r=o(a.postMessage,a,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",m,!1)):r="onreadystatechange"in l("script")?function(e){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),E.call(e)}}:function(e){setTimeout(o(E,e,1),0)}),e.exports={set:f,clear:h}},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=29)}([function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(30),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(e,t){var n=e.exports={version:"2.4.0"};"number"==typeof __e&&(__e=n)},function(e,t,n){var r=n(24)("wks"),i=n(25),a=n(2).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:i)("Symbol."+e))}).store=r},function(e,t,n){var r=n(7),i=n(20);e.exports=n(6)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},function(e,t,n){e.exports=!n(13)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(8),i=n(35),a=n(36),o=Object.defineProperty;t.f=n(6)?Object.defineProperty:function(e,t,n){if(r(e),t=a(t,!0),r(n),i)try{return o(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},function(e,t,n){var r=n(12);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},function(e,t){e.exports={}},function(e,t,n){var r=n(2),i=n(3),a=n(33),o=n(5),s=function(e,t,n){var u,l,c,d=e&s.F,f=e&s.G,h=e&s.S,_=e&s.P,p=e&s.B,v=e&s.W,E=f?i:i[t]||(i[t]={}),m=E.prototype,S=f?r:h?r[t]:(r[t]||{}).prototype;f&&(n=t);for(u in n)(l=!d&&S&&void 0!==S[u])&&u in E||(c=l?S[u]:n[u],E[u]=f&&"function"!=typeof S[u]?n[u]:p&&l?a(c,r):v&&S[u]==c?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(c):_&&"function"==typeof c?a(Function.call,c):c,_&&((E.virtual||(E.virtual={}))[u]=c,e&s.R&&m&&!m[u]&&o(m,u,c)))};s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={IDLE:"IDLE",PLAYING:"PLAYING",SEEKING:"SEEKING",BUFFERING:"BUFFERING",BUFFERING_WITH_BUFFER:"BUFFERING_WITH_BUFFER",PAUSED:"PAUSED",ENDED:"ENDED"};t.default=r,e.exports=t.default},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t,n){var r=n(44),i=n(15);e.exports=function(e){return r(i(e))}},function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},function(e,t,n){var r=n(24)("keys"),i=n(25);e.exports=function(e){return r[e]||(r[e]=i(e))}},function(e,t,n){var r=n(12),i=n(2).document,a=r(i)&&r(i.createElement);e.exports=function(e){return a?i.createElement(e):{}}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,n){var r=n(15);e.exports=function(e){return Object(r(e))}},function(e,t,n){var r=n(43),i=n(26);e.exports=Object.keys||function(e){return r(e,i)}},function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},function(e,t,n){var r=n(2),i=r["__core-js_shared__"]||(r["__core-js_shared__"]={});e.exports=function(e){return i[e]||(i[e]={})}},function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,n){"use strict";var r=n(55),i=n(11),a=n(56),o=n(5),s=n(9),u=n(10),l=n(57),c=n(28),d=n(61),f=n(4)("iterator"),h=!([].keys&&"next"in[].keys()),_=function(){return this};e.exports=function(e,t,n,p,v,E,m){l(n,t,p);var S,g,T,y=function(e){if(!h&&e in w)return w[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},C=t+" Iterator",D="values"==v,A=!1,w=e.prototype,R=w[f]||w["@@iterator"]||v&&w[v],P=R||y(v),b=v?D?y("entries"):P:void 0,k="Array"==t?w.entries||R:R;if(k&&(T=d(k.call(new e)))!==Object.prototype&&(c(T,C,!0),r||s(T,f)||o(T,f,_)),D&&R&&"values"!==R.name&&(A=!0,P=function(){return R.call(this)}),r&&!m||!h&&!A&&w[f]||o(w,f,P),u[t]=P,u[C]=_,v)if(S={values:D?P:y("values"),keys:E?P:y("keys"),entries:b},m)for(g in S)g in w||a(w,g,S[g]);else i(i.P+i.F*(h||A),t,S);return S}},function(e,t,n){var r=n(7).f,i=n(9),a=n(4)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(37),l=r(u),c=n(38),d=r(c),f=n(39),h=r(f),_=n(67),p=r(_),v=n(68),E=r(v),m={ATTACHED:"ATTACHED",DETACHED:"DETACHED",DISPOSED:"DISPOSED"},S=function(){function e(t,n){(0,a.default)(this,e),this._state=m.ATTACHED,this._stateMachine=new l.default,this._playbackWatcher=new d.default(t,this._stateMachine,n||p.default),this._stateTimeCalculator=new h.default(this._stateMachine),this._qosStats=new E.default(t,this._stateTimeCalculator)}return(0,s.default)(e,[{key:"getQoSAnalytics",value:function(){return this._qosStats.getAnalytics()}},{key:"attach",value:function(){this._state===m.DETACHED&&(this._state=m.ATTACHED,this._playbackWatcher.resume(),this._stateTimeCalculator.resume())}},{key:"detach",value:function(){this._state===m.ATTACHED&&(this._state=m.DETACHED,this._playbackWatcher.pause(),this._stateTimeCalculator.pause())}},{key:"dispose",value:function(){this._state=m.DISPOSED,this._playbackWatcher.dispose(),this._stateTimeCalculator.dispose()}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){e.exports={default:n(31),__esModule:!0}},function(e,t,n){n(32);var r=n(3).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){var r=n(11);r(r.S+r.F*!n(6),"Object",{defineProperty:n(7).f})},function(e,t,n){var r=n(34);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,n){e.exports=!n(6)&&!n(13)(function(){return 7!=Object.defineProperty(n(19)("div"),"a",{get:function(){return 7}}).a})},function(e,t,n){var r=n(12);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(14),l=r(u),c=function(){function e(){(0,a.default)(this,e),this._stateChangedCallbacks=[],this.gotoIdle()}return(0,s.default)(e,[{key:"_setState",value:function(e){var t=this;this._state!==e&&(this._prevState=this._state,this._state=e,this._stateChangedCallbacks.forEach(function(e){e(t._state,t._prevState)}))}},{key:"gotoIdle",value:function(){this._setState(l.default.IDLE)}},{key:"gotoPlaying",value:function(){this._setState(l.default.PLAYING)}},{key:"gotoSeeking",value:function(){this._setState(l.default.SEEKING)}},{key:"gotoBuffering",value:function(){this._setState(l.default.BUFFERING)}},{key:"gotoBufferingWithBuffer",value:function(){this._setState(l.default.BUFFERING_WITH_BUFFER)}},{key:"gotoPaused",value:function(){this._setState(l.default.PAUSED)}},{key:"gotoEnded",value:function(){this._setState(l.default.ENDED)}},{key:"getState",value:function(){return this._state}},{key:"addObserver",value:function(e){this._stateChangedCallbacks.indexOf(e)<0&&this._stateChangedCallbacks.push(e)}},{key:"removeObserver",value:function(e){var t=this._stateChangedCallbacks.indexOf(e);t>-1&&this._stateChangedCallbacks.splice(t,1)}},{key:"isIdle",value:function(){return this._state===l.default.IDLE}},{key:"isPlaying",value:function(){return this._state===l.default.PLAYING}},{key:"isSeeking",value:function(){return this._state===l.default.SEEKING}},{key:"isBuffering",value:function(){return this._state===l.default.BUFFERING}},{key:"isBufferingWithBuffer",value:function(){return this._state===l.default.BUFFERING_WITH_BUFFER}},{key:"isPaused",value:function(){return this._state===l.default.PAUSED}},{key:"isEnded",value:function(){return this._state===l.default.ENDED}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t,n,r){(0,a.default)(this,e),this._createInterval=r,this._video=t,this._stateMachine=n,this._previousPlaybackTime=0,this.resume()}return(0,s.default)(e,[{key:"dispose",value:function(){this.pause()}},{key:"pause",value:function(){this._tickInterval.clear()}},{key:"resume",value:function(){this._tickInterval=this._createInterval(this._tickHandler.bind(this),100)}},{key:"_getBufferLength",value:function(){for(var e=this._video.currentTime,t=this._video.buffered,n=0;n<t.length;n++)if(t.start(n)<=e&&e<=t.end(n))return t.end(n)-e;return 0}},{key:"_tickHandler",value:function(){var e=this._video.duration-this._video.currentTime,t=Math.abs(this._video.currentTime-this._previousPlaybackTime);if(isNaN(t))this._stateMachine.gotoIdle();else if(this._video.seeking)this._stateMachine.gotoSeeking();else if(this._video.paused)this._stateMachine.isIdle()||(!isNaN(e)&&e<.3?this._stateMachine.gotoEnded():this._stateMachine.gotoPaused());else if(t>0)this._stateMachine.gotoPlaying();else if(!this._stateMachine.isIdle()&&!this._stateMachine.isSeeking()){var n=this._getBufferLength();n<1?this._stateMachine.gotoBuffering():this._stateMachine.gotoBufferingWithBuffer()}this._previousPlaybackTime=this._video.currentTime}}],[{key:"BUFFERING_WITH_BUFFER_THRESHOLD",get:function(){return 1}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(40),a=r(i),o=n(49),s=r(o),u=n(0),l=r(u),c=n(1),d=r(c),f=n(14),h=r(f),_=function(){function e(t){(0,l.default)(this,e),this._stateMachine=t,this._stats={};var n=!0,r=!1,i=void 0;try{for(var o,u=(0,s.default)((0,a.default)(h.default));!(n=(o=u.next()).done);n=!0){var c=o.value;this._stats[c]={count:0,timeSpent:0}}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}this.resume(),this._onStateChangedCallback=this._onStateChanged.bind(this),this._stateMachine.addObserver(this._onStateChangedCallback)}return(0,d.default)(e,[{key:"getStats",value:function(){return this._isAttached&&this._updateStateTimeSpent(this._stateMachine.getState()),this._stats}},{key:"pause",value:function(){this._isAttached=!1,this._terminateState(this._stateMachine.getState())}},{key:"resume",value:function(){this._isAttached=!0,this._resumeState(this._stateMachine.getState())}},{key:"dispose",value:function(){this.pause(),this._stateMachine.removeObserver(this._onStateChangedCallback)}},{key:"_onStateChanged",value:function(e,t){this._terminateState(t),this._resumeState(e)}},{key:"_terminateState",value:function(e){this._updateStateTimeSpent(e),this._stats[e].startTimeStamp=null}},{key:"_updateStateTimeSpent",value:function(e){var t=this._stats[e],n=Date.now();t.timeSpent+=(n-t.startTimeStamp)/1e3,t.startTimeStamp=n}},{key:"_resumeState",value:function(e){var t=this._stats[e];t.count++,t.startTimeStamp=Date.now()}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){e.exports={default:n(41),__esModule:!0}},function(e,t,n){n(42),e.exports=n(3).Object.keys},function(e,t,n){var r=n(21),i=n(22);n(48)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(9),i=n(16),a=n(45)(!1),o=n(18)("IE_PROTO");e.exports=function(e,t){var n,s=i(e),u=0,l=[];for(n in s)n!=o&&r(s,n)&&l.push(n);for(;t.length>u;)r(s,n=t[u++])&&(~a(l,n)||l.push(n));return l}},function(e,t,n){var r=n(23);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},function(e,t,n){var r=n(16),i=n(46),a=n(47);e.exports=function(e){return function(t,n,o){var s,u=r(t),l=i(u.length),c=a(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(17),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},function(e,t,n){var r=n(17),i=Math.max,a=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(11),i=n(3),a=n(13);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*a(function(){n(1)}),"Object",o)}},function(e,t,n){e.exports={default:n(50),__esModule:!0}},function(e,t,n){n(51),n(62),e.exports=n(64)},function(e,t,n){n(52);for(var r=n(2),i=n(5),a=n(10),o=n(4)("toStringTag"),s=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;u<5;u++){var l=s[u],c=r[l],d=c&&c.prototype;d&&!d[o]&&i(d,o,l),a[l]=a.Array}},function(e,t,n){"use strict";var r=n(53),i=n(54),a=n(10),o=n(16);e.exports=n(27)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t){e.exports=function(){}},function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},function(e,t){e.exports=!0},function(e,t,n){e.exports=n(5)},function(e,t,n){"use strict";var r=n(58),i=n(20),a=n(28),o={};n(5)(o,n(4)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(8),i=n(59),a=n(26),o=n(18)("IE_PROTO"),s=function(){},u=function(){var e,t=n(19)("iframe"),r=a.length;for(t.style.display="none",n(60).appendChild(t),t.src="javascript:",e=t.contentWindow.document,e.open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[a[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(s.prototype=r(e),n=new s,s.prototype=null,n[o]=e):n=u(),void 0===t?n:i(n,t)}},function(e,t,n){var r=n(7),i=n(8),a=n(22);e.exports=n(6)?Object.defineProperties:function(e,t){i(e);for(var n,o=a(t),s=o.length,u=0;s>u;)r.f(e,n=o[u++],t[n]);return e}},function(e,t,n){e.exports=n(2).document&&document.documentElement},function(e,t,n){var r=n(9),i=n(21),a=n(18)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},function(e,t,n){"use strict";var r=n(63)(!0);n(27)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},function(e,t,n){var r=n(17),i=n(15);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(a=s.charCodeAt(u),a<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):o-56320+(a-55296<<10)+65536)}}},function(e,t,n){var r=n(8),i=n(65);e.exports=n(3).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){var r=n(66),i=n(4)("iterator"),a=n(10);e.exports=n(3).getIteratorMethod=function(e){if(void 0!=e)return e[i]||e["@@iterator"]||a[r(e)]}},function(e,t,n){var r=n(23),i=n(4)("toStringTag"),a="Arguments"==r(function(){return arguments}()),o=function(e,t){try{return e[t]}catch(e){}};e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=o(t=Object(e),i))?n:a?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o);t.default=function(e,t){return new u(e,t)};var u=function(){function e(t,n){(0,a.default)(this,e),this._callback=t,this._time=n,this._timer=this._createTimer()}return(0,s.default)(e,[{key:"_createTimer",value:function(){return setInterval(this._callback,this._time)}},{key:"clear",value:function(){clearInterval(this._timer)}}]),e}();e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(14),l=r(u),c=function(){function e(t,n){(0,a.default)(this,e),this._video=t,this._stateTimeCalculator=n,this._cachedDroppedFrameCount=0}return(0,s.default)(e,[{key:"_getDroppedFrameCount",value:function(){var e=0;return e=this._video.getVideoPlaybackQuality?this._video.getVideoPlaybackQuality().droppedVideoFrames||0:this._video.webkitDroppedFrameCount||this._video.droppedFrameCount||0,e>0&&(this._cachedDroppedFrameCount=e),this._cachedDroppedFrameCount}},{key:"getAnalytics",value:function(){var e=this._stateTimeCalculator.getStats();return{droppedFrameCount:this._getDroppedFrameCount(),timeSpentPlaying:e[l.default.PLAYING].timeSpent,timeSpentPaused:e[l.default.PAUSED].timeSpent,timeSpentSeeking:e[l.default.SEEKING].timeSpent,timeSpentEnded:e[l.default.ENDED].timeSpent,rebufferingCount:e[l.default.BUFFERING].count,timeSpentRebuffering:e[l.default.BUFFERING].timeSpent,rebufferingCountWithBuffer:e[l.default.BUFFERING_WITH_BUFFER].count,timeSpentRebufferingWithBuffer:e[l.default.BUFFERING_WITH_BUFFER].timeSpent}}}]),e}();t.default=c,e.exports=t.default}])})},function(e,t,n){var r=n(358),i=n(359),a=i;a.v1=r,a.v4=i,e.exports=a},function(e,t){function n(e,t){var n=t||0,i=r;return i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+"-"+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]+i[e[n++]]}for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);e.exports=n},function(e,t,n){(function(t){var n,r=t.crypto||t.msCrypto;if(r&&r.getRandomValues){var i=new Uint8Array(16);n=function(){return r.getRandomValues(i),i}}if(!n){var a=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}e.exports=n}).call(t,n(92))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(176),l=r(u),c=n(175),d=r(c),f=n(170),h=r(f),_=n(171),p=r(_),v=n(31),E=r(v),m=n(2),S=r(m),g=n(5),T=function(){function e(t,n){(0,a.default)(this,e),this._trafficIntervalCounter=0,this._sharedState=n,this._timerStore=new E.default,this._configReporter=new h.default(n),this._trafficAnalytics=new l.default(n),this._statsAnalytics=new d.default(t,n),this._mediaEndedListener=new p.default(t,n),this._sharedState.eventBus.once(S.default.Distributor.ANSWERED,this._init.bind(this))}return(0,s.default)(e,[{key:"_init",value:function(){this._sharedState.conf.CONTENT_ACTIVATED&&(this._sharedState.conf.ANALYTICS.ENABLE_STATS_SENDER&&this._scheduleStatReport(),this._sharedState.conf.ANALYTICS.ENABLE_CONTROL_SENDER&&this._scheduleControlReport(),this._sharedState.conf.RAMP_UP_ACTIVATED&&(this._scheduleTrafficReport(),this._onBU=this._sendUsagePayload.bind(this),window.addEventListener("beforeunload",this._onBU),this._onME=this._sendUsagePayload.bind(this),this._sharedState.eventBus.once(S.default.Media.ENDED,this._onME)))}},{key:"_sendUsagePayload",value:function(){this._trafficAnalytics.sendUsage()}},{key:"dispose",value:function(){this._timerStore.clearAll(),this._configReporter.dispose(),this._statsAnalytics.dispose(),this._mediaEndedListener.dispose(),window.removeEventListener("beforeunload",this._onBU),this._sharedState.eventBus.removeListener(S.default.Media.ENDED,this._onME)}},{key:"_scheduleTrafficReport",value:function(){var e=this;if(this._trafficIntervalCounter<this._sharedState.conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1){var t=(0,g.createTimeout)(function(){e._trafficAnalytics.sendUsage(),e._scheduleTrafficReport()},this._sharedState.conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._trafficIntervalCounter]);this._timerStore.register(t),this._trafficIntervalCounter++}else{var n=this._sharedState.conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._sharedState.conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1],r=this._trafficAnalytics.sendUsage.bind(this._trafficAnalytics),i=(0,g.createInterval)(r,n);this._timerStore.register(i)}}},{key:"_scheduleStatReport",value:function(){var e=(0,g.createInterval)(this._statsAnalytics.sendStats.bind(this._statsAnalytics),this._sharedState.conf.ANALYTICS.STATS_INTERVAL);this._timerStore.register(e)}},{key:"_scheduleControlReport",value:function(){var e=(0,g.createInterval)(this._statsAnalytics.sendControl.bind(this._statsAnalytics),this._sharedState.conf.ANALYTICS.CONTROL_INTERVAL);this._timerStore.register(e)}}]),e}();t.default=T,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._mediaElement=null}return(0,s.default)(e,[{key:"mediaElement",get:function(){return this._mediaElement},set:function(e){this._mediaElement=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=new o.default(e.conf.BITRATE_ESTIMATION_WINDOW);e.eventBus.on(u.default.SRModuleInterface.ABR_FEEDBACK,function(){t.push(e.transferStats.p2pConsumed+e.transferStats.cdnConsumed);var n=t.delta,r=t.timeDelta;n&&r&&(e.abrStats.estimatedBitrate=8*n/r)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=i;var a=n(72),o=r(a),s=n(2),u=r(s);e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(5),l=n(251),c=r(l),d=n(2),f=r(d),h=function(){function e(t,n){(0,a.default)(this,e),this._mediaElementPlaceholder=t,this._sharedState=n,this._bufferCheck(),this._bufferCheckInterval=(0,u.createInterval)(this._bufferCheck.bind(this),this._sharedState.conf.BUFFER_CHECK_INTERVAL)}return(0,s.default)(e,[{key:"_bufferCheck",value:function(){this._bufferedAmount=c.default.getBufferedAmount(this._mediaElementPlaceholder),this._sharedState.bufferStats.bufferedAmount=this._bufferedAmount,this._sharedState.eventBus.emit(f.default.BufferedAmountObserver.BUFFER_CHECK,this._bufferedAmount)}},{key:"dispose",value:function(){this._bufferCheckInterval.clear()}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(5),d=n(201),f=r(d),h=n(2),_=r(h),p=n(55),v=r(p),E=function(){function e(t,n,r){(0,s.default)(this,e),this._wasLowBuffer=!1,this._pauseSegmentSchedulingTimestamp=a.default,this._p2pCache=t,this._scheduler=n,this._sharedState=r,this._onInit=this._init.bind(this),this._onTE=this._onTrackEdge.bind(this),this._sharedState.eventBus.once(_.default.Distributor.ANSWERED,this._onInit),this._sharedState.conf.ENABLE_TRACK_EDGE_GC_BLOCK&&this._sharedState.eventBus.on(_.default.P2PCache.ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE,this._onTE)}return(0,l.default)(e,[{key:"_init",value:function(){this._timer=(0,c.createInterval)(this._scheduleChunkDownloads.bind(this),this._sharedState.conf.CHUNK_BATCHING_INTERVAL)}},{key:"_onTrackEdge",value:function(){this._pauseSegmentScheduling(this._sharedState.conf.P2P_CACHE_GC_TRACK_EDGE_BLOCK_DURATION)}},{key:"dispose",value:function(){this._timer&&this._timer.clear(),this._sharedState.eventBus.removeListener(_.default.Distributor.ANSWERED,this._onInit),this._sharedState.eventBus.removeListener(_.default.P2PCache.ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE,this._onTE)}},{key:"_pauseSegmentScheduling",value:function(e){var t=Date.now()+e;this._pauseSegmentSchedulingTimestamp=Math.max(this._pauseSegmentSchedulingTimestamp,t)}},{key:"_isSegmentSchedulingPaused",value:function(){return Date.now()<this._pauseSegmentSchedulingTimestamp}},{key:"_scheduleChunkRequestsForSegment",value:function(e,t,n,r){for(var i=this._sharedState.conf.ENABLE_FILTER_BANNED_SEEDERS?t.seeders.allNotBanned():t.seeders.all(),a=i.length,o=0;o<a;o++){for(var s=i[o],u=n.getOrCreate(s);u[r]>0&&t.hasChunksToDownload;){var l=t.chunkManager.getNextChunks(s,u[r],r);u[r]-=l.size,s.requestChunks(e,l.encoded,r,t.chunkManager)}if(!t.hasChunksToDownload)break}}},{key:"_scheduleChunkDownloads",value:function(){for(var e=new f.default(this._sharedState.conf.CHUNK_BATCHING_INTERVAL),t=this._scheduler.getSegmentListToDownload(),n=t.length,r=0;r<n;r++){var i=t[r],a=this._isSegmentSchedulingPaused()?this._p2pCache.getSegmentHandler(i):this._p2pCache.getOrCreateSegmentHandler(i);null!==a&&this._sharedState.isP2PDownloadOn&&a.hasChunksToDownload&&!this._sharedState.isP2PDownloadBlocked&&(this._scheduleChunkRequestsForSegment(i,a,e,v.default.SAFE),this._scheduleChunkRequestsForSegment(i,a,e,v.default.UNSAFE))}}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e
}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(57),a=r(i),o=n(10),s=r(o),u=n(15),l=r(u),c=n(0),d=r(c),f=n(1),h=r(f),_=n(71),p=n(4),v=r(p),E=function(){function e(t,n){(0,d.default)(this,e),this._segmentListMap=new l.default,this._conf=n.conf;for(var r=t.getTrackList(),i=0;i<r.length;i++)this._segmentListMap.set(r[i],[])}return(0,h.default)(e,[{key:"insert",value:function(e){var t=this._getMatchingTrack(e);if(t){var n=(0,_.unwrap)(this._segmentListMap.get(t));if(0===n.length)n.push(e);else if(n[0].getId()>e.getId())n.unshift(e);else for(var r=n.length;r>0;r--)if(e.getId()>n[r-1].getId()){n.splice(r,0,e);break}var i=n.length;if(i>this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH){var a=n.slice(i-this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH);this._segmentListMap.set(t,a)}}}},{key:"getSegmentListAfter",value:function(e){var t=this._getMatchingTrack(e);if(t){var n=(0,_.unwrap)(this._segmentListMap.get(t)),r=n.filter(function(t){return t.getId()>e.getId()});return this._segmentListMap.set(t,r),this._conf.ENABLE_PUSH_SEGMENT_OPTIM?r.slice(0,this._conf.NB_SEGMENT_P2P_PREBUFFER):r}return[]}},{key:"_getMatchingTrack",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=(0,s.default)(this._segmentListMap);!(t=(i=o.next()).done);t=!0){var u=(0,a.default)(i.value,1),l=u[0];if(e.isInTrack(l))return l}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}v.default.notifyError(new Error("Pushed segment belongs to no track"))}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(51),l=r(u),c=n(4),d=r(c),f=n(2),h=r(f),_=function(){function e(t){(0,a.default)(this,e),this._sharedState=t,this._request=null,this._requestSent=!1}return(0,s.default)(e,[{key:"connect",value:function(){var e=this;if(this._requestSent)return void d.default.notifyError(new Error("Tried to connect to distributor twice."));this._requestSent=!0;var t=this._sharedState.conf.DISTRIBUTOR.URL,n=this._sharedState.conf.ID_CLIENT,r=this._sharedState.moduleState.content,i=t+"?customer="+n+"&content="+r+"&version=4.12.0";i+="&isLive="+String(this._sharedState.moduleState.isLive()),this._sharedState.controlStats.sentDistributorRootCount++;var a={timeout:this._sharedState.conf.DISTRIBUTOR.TIMEOUT_DELAY,retry:this._sharedState.conf.DISTRIBUTOR.MAX_RETRY};this._request=new l.default(l.default.Methods.GET,i,a),this._request.isStreamroot=!0,this._request.send().then(function(t){e._sharedState.moduleState.peerAgentDisposed||(e._sharedState.injectConfigFromDistributor(t),e._sharedState.eventBus.emit(h.default.Distributor.ANSWERED))}).catch(function(t){e._sharedState.moduleState.peerAgentDisposed||(e._sharedState.conf.DISTRIBUTOR.OVERRIDDEN||(e._sharedState.conf.ALLOW_P2P=!1,e._sharedState.setBackendFallbackUrls(),e._sharedState.eventBus.emit(h.default.Distributor.TIMED_OUT)),d.default.notifyError(new Error("Could not connect to distributor: "+t.message+". Status: "+t.status)))}).then(function(){e._request=null})}},{key:"dispose",value:function(){this._request&&(this._request.abort(),this._request=null)}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(34),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){var t=[],n=[],r=e,a={},o=function(e,n){t.push({eventName:e,fn:n}),r.addEventListener(e,n)},s=function(e,t){n.push({eventName:e,fn:t}),window.addEventListener(e,t)},u=function(){for(var e=0;e<t.length;e++){var n=t[e].eventName,i=t[e].fn;r.removeEventListener(n,i)}t=[]},l=function(){for(var e=0;e<n.length;e++){var t=n[e].eventName,r=n[e].fn;window.removeEventListener(t,r)}n=[]},c=function(){u(),l()},d=function(e){function t(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];a[e].arguments=n}return a[e]={arguments:void 0,handler:t},t},f=function(e){r.addEventListener(e,d(e))},h=function(e,t){if(!a[e]||!a[e].arguments)throw new Error("You are trying to trigger an event that have not been cached before");r.removeEventListener(e,a[e].handler),a[e].arguments&&t.apply(void 0,(0,i.default)(a[e].arguments))};this.addMediaEventListener=o,this.addWindowEventListener=s,this.removeAllExternalEventListener=c,this.cacheMediaEvent=f,this.triggerCachedEvent=h};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(74),a=r(i),o=n(57),s=r(o),u=n(34),l=r(u),c=n(10),d=r(c),f=n(15),h=r(f),_=n(0),p=r(_),v=n(1),E=r(v),m=n(240),S=r(m),g=n(100),T=r(g),y=n(2),C=r(y),D=n(4),A=r(D),w=function(){function e(t,n,r){(0,p.default)(this,e),this._peerPool=t,this._segmentInfoMap=n,this._sharedState=r,this._segmentHandlers=new h.default,this._onRemoveFromCache=this.removeSegmentHandler.bind(this),this._sharedState.eventBus.on(C.default.P2PCache.REMOVE_SEGMENT_FROM_CACHE,this._onRemoveFromCache)}return(0,E.default)(e,[{key:"getSegmentHandler",value:function(e){var t=this._segmentHandlers.get(e.viewToString());return t||null}},{key:"removePeer",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,d.default)(this._segmentHandlers.values());!(t=(i=a.next()).done);t=!0)i.value.seeders.remove(e)}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"getOrCreateSegmentHandler",value:function(e){var t=this.getSegmentHandler(e);return null===t&&(t=new S.default(e,this,this._peerPool,this._segmentInfoMap,this._sharedState),this._segmentHandlers.set(t.segmentCoord.viewToString(),t),this._peerPool.requestHasSegment(e),this._manageP2PCache()),t}},{key:"removeSegmentHandler",value:function(e){var t=e.viewToString(),n=this._segmentHandlers.get(t);n&&(n.dispose(),this._segmentHandlers.delete(t))}},{key:"fillSegment",value:function(e,t){var n=this.getOrCreateSegmentHandler(e),r=n.chunkManager,i=new T.default(t,e,this._sharedState.eventBus);i.setComplete(),r.storeSegment(i),n.seeders.clear(),(this._sharedState.moduleState.isLive()&&this._sharedState.conf.ALLOW_LIVE_PUSH_SEGMENT||!this._sharedState.moduleState.isLive()&&this._sharedState.conf.ALLOW_VOD_PUSH_SEGMENT)&&this._peerPool.broadcastSegmentInfo(e)}},{key:"getPartialSegment",value:function(e){var t=this.getSegmentHandler(e),n=t?t.chunkManager:null;return n?n.getPartialSegment():null}},{key:"listSegmentsToSkipForTrack",value:function(e){return[].concat((0,l.default)(this._segmentHandlers)).filter(function(t){var n=(0,s.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&!r.chunkManager.shouldDownloadSegment()}).map(function(e){var t=(0,s.default)(e,2);return t[0],t[1].segmentCoord})}},{key:"listSegmentsDownloadStatus",value:function(){return[].concat((0,l.default)(this._segmentHandlers)).map(function(e){var t=(0,s.default)(e,2),n=(t[0],t[1]);return{segmentcoord:n.segmentCoord,downloadStatusList:n.chunkManager.downloadStatus,seederCount:n.seeders.length}})}},{key:"listDownloadedSegmentsForTrack",value:function(e){return[].concat((0,l.default)(this._segmentHandlers)).filter(function(t){var n=(0,s.default)(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&r.chunkManager.isSegmentDownloaded()}).map(function(e){var t=(0,s.default)(e,2);return t[0],t[1].segmentCoord})}},{key:"getSegmentsStats",value:function(){if(!this._segmentHandlers.size)return{};var e=void 0,t=0,n=a.default,r=!0,i=!1,o=void 0;try{for(var s,u=(0,d.default)(this._segmentHandlers.values());!(r=(s=u.next()).done);r=!0)e=s.value.segmentCoord.getId(),n=Math.min(n,e),t=Math.max(t,e)}catch(e){i=!0,o=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw o}}return{minSegmentId:n,maxSegmentId:t}}},{key:"dispose",value:function(){this._segmentHandlers=new h.default,this._sharedState.eventBus.removeListener(C.default.P2PCache.REMOVE_SEGMENT_FROM_CACHE,this._onRemoveFromCache)}},{key:"_manageP2PCache",value:function(){var e=0,t=this._sharedState.moduleState.isLive()?this._sharedState.conf.LIVE.P2P_CACHE_MAX_SIZE:this._sharedState.conf.P2P_CACHE_MAX_SIZE,n=void 0,r=0,i=!0,a=!1,o=void 0;try{for(var s,u=(0,d.default)(this._segmentHandlers.values());!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.chunkManager.size&&(e+=l.chunkManager.size),e>t){n=this._segmentHandlers.size-r;break}r++}}catch(e){a=!0,o=e}finally{try{!i&&u.return&&u.return()}finally{if(a)throw o}}if(n){var c=!0,f=!1,h=void 0;try{for(var _,p=(0,d.default)(this._segmentHandlers.values());!(c=(_=p.next()).done);c=!0){var v=_.value,E=v.segmentCoord;if(0===n)break;var m=this._sharedState.moduleState.videoTrackEdge&&E.viewToString()===this._sharedState.moduleState.videoTrackEdge.viewToString(),S=this._sharedState.moduleState.audioTrackEdge&&E.viewToString()===this._sharedState.moduleState.audioTrackEdge.viewToString();if(this._sharedState.conf.ENABLE_TRACK_EDGE_GC_BLOCK&&(m||S)){A.default.notify("Attempted to remove track edge from P2PCache."),this._sharedState.eventBus.emit(C.default.P2PCache.ATTEMPTED_GC_TRACK_EDGE_FROM_CACHE);break}this.removeSegmentHandler(E),this._segmentInfoMap.removeSegmentInfo(E),n--}}catch(e){f=!0,h=e}finally{try{!c&&p.return&&p.return()}finally{if(f)throw h}}}}}]),e}();t.default=w,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"init",value:function(e,t){this._p2pCache=e,this._scheduler=t}},{key:"getStats",value:function(){var e=this._scheduler.getEdgeSegment();if(e){var t=e.getId(),n=this._p2pCache.getSegmentsStats(),r=n.minSegmentId,i=n.maxSegmentId;return{min:r||t,max:i||t,current:t}}return null}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this._scheduler=t,this._p2pCache=n,this._segmentInfoMap=r,this._distributedSegmentList=i,this._sharedState=o}return(0,s.default)(e,[{key:"_onHasSegment",value:function(e,t,n){var r=n.pushed;if(this._segmentInfoMap.addSegmentInfo(t),r&&this._sharedState.moduleState.isLive()&&(this._sharedState.conf.ENABLE_PUSH_SEGMENT_OPTIM&&!this._scheduler.isSegmentInAcceptableRange(t.segmentCoord)||this._distributedSegmentList.insert(t.segmentCoord)),this._scheduler.isSegmentRequested(t.segmentCoord)){var i=this._p2pCache.getOrCreateSegmentHandler(t.segmentCoord);i.chunkManager.setSegmentSize(t.size),e.isBannedSeeder()&&!this._sharedState.conf.ENABLE_FILTER_BANNED_SEEDERS||i.seeders.add(e)}}},{key:"_onPeerOpen",value:function(){var e=void 0;e=this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM?this._scheduler.getCachedSegmentListToDownload():this._scheduler.getSegmentListToDownload(),this._sharedState.eventBus.emit("segmentInfo",e,this._segmentInfoMap)}},{key:"_onPeerDestroyed",value:function(e){var t=e.remotePeer;this._p2pCache.removePeer(t)}}],[{key:"listenEvents",value:function(t,n,r,i,a){var o=new e(t,n,r,i,a);a.eventBus.on(l.default.PeerPool.PEER_OPEN,o._onPeerOpen.bind(o)),a.eventBus.on("hasSegment",o._onHasSegment.bind(o)),a.eventBus.on(l.default.PeerPool.PEER_DESTROYED,o._onPeerDestroyed.bind(o))}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(31),l=r(u),c=n(4),d=r(c),f=n(5),h=n(19),_=n(25),p=n(184),v=r(p),E=n(39),m=r(E),S=function(){function e(t){var n=this;(0,a.default)(this,e);var r=t.conf,i=t.transferStats,o=t.abrStats;this._conf=r,this._transferStats=i,this._abrStats=o,this._p2pMediaDownloadedDelta=new h.Delta,this._p2pTimeElapsedDelta=new h.Delta(Date.now());var s=r.P2P_SPEED_ESTIMATION_BUCKET_COUNT*r.P2P_SPEED_ESTIMATION_BUCKET_DURATION;this._p2pMediaDownloadedSMWA=new v.default(s),this._p2pMediaDownloadedEMWA=new m.default(0,r.P2P_SPEED_EMA_WEIGHT),this._p2pMediaDownloadedLongSMA=new v.default(r.P2P_USEFUL_SMA_WINDOW),this._p2pMediaDownloadedLongDelta=new h.Delta,this._p2pUsefulLongSMA=new v.default(r.P2P_USEFUL_SMA_WINDOW),this._p2pUsefulLongDelta=new h.Delta,this._timerStore=new l.default,this._ewmaZeroWeight=1-Math.exp(Math.log(.5)*r.MEAN_SPEED_CALCULATION_INTERVAL/r.P2P_SPEED_EMA_ZERO_HALF_LIFE);var u=(0,f.createInterval)(function(){n._computeMeanInstantSpeed()},this._conf.MEAN_SPEED_CALCULATION_INTERVAL),c=(0,f.createInterval)(function(){n._computeDeltaP2PSpeed()},r.P2P_SPEED_ESTIMATION_BUCKET_DURATION),d=(0,f.createInterval)(function(){n._updateUsefulP2PRatio()},this._conf.P2P_USEFUL_CALCULATION_INTERVAL);this._timerStore.register(u),this._timerStore.register(c),this._timerStore.register(d)}return(0,s.default)(e,[{key:"getP2PSpeedEstimate",value:function(){var e=this._p2pMediaDownloadedEMWA.value;return e*(1-this._conf.P2P_USEFUL_RATIO_WEIGHT)+e*this._abrStats.p2pUsefulEstimate*this._conf.P2P_USEFUL_RATIO_WEIGHT}},{key:"_updateUsefulP2PRatio",value:function(){var e=this._p2pUsefulLongDelta.calcDelta(this._transferStats.p2pUseful),t=this._p2pMediaDownloadedLongDelta.calcDelta(this._transferStats.p2pMediaDownloaded);t>0&&(this._p2pMediaDownloadedLongSMA.addPoint(t),this._p2pUsefulLongSMA.addPoint(e));var n=this._p2pMediaDownloadedLongSMA.computeSum(),r=this._p2pUsefulLongSMA.computeSum(),i=8*n/this._conf.P2P_USEFUL_SMA_WINDOW<this._conf.P2P_DL_THRESHOLD_FOR_USEFUL_CORRECTION?1:Math.min(1,r/n);this._abrStats.p2pUsefulEstimate=(0,_.toDecimal)(i,3)}},{key:"_computeMeanInstantSpeed",value:function(){var e=this._p2pMediaDownloadedSMWA.compute();this._abrStats.p2pSpeedWindowsCount++,0===e&&this._abrStats.zeroP2pSpeedWindowsCount++,e<0?d.default.notifyError(new Error("Negative p2pMediaDownloaded delta.")):this._p2pMediaDownloadedEMWA.value<this._conf.P2P_SPEED_ZERO_THRESHOLD?this._p2pMediaDownloadedEMWA.update(e,1):e>0?this._p2pMediaDownloadedEMWA.update(e):0===e&&this._p2pMediaDownloadedEMWA.update(e,this._ewmaZeroWeight),this._abrStats.p2pSpeed=this.getP2PSpeedEstimate()}},{key:"_computeDeltaP2PSpeed",value:function(){var e=this._p2pMediaDownloadedDelta.calcDelta(this._transferStats.p2pMediaDownloaded),t=this._p2pTimeElapsedDelta.calcDelta(Date.now());e>0&&t>0?this._p2pMediaDownloadedSMWA.addPoint(8*e/t):e<0&&d.default.notifyError(new Error("Negative p2pMediaDownloaded delta."))}},{key:"dispose",value:function(){this._timerStore.clearAll()}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(69),p=r(_),v=function(e){function t(e){(0,s.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n._segmentCoord=e,n}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getUpdatedRange",value:function(e){return e}},{key:"getFullSegment",value:function(e,t){t(e,this._segmentCoord)}},{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}},{key:"byteLength",get:function(){return null}}]),t}(p.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(69),p=r(_),v=n(108),E=r(v),m=function(e){function t(e,n,r,i){function o(e,t){function i(i,a){e.response=i;var o=new E.default(f,i.byteLength,a);r.addSegmentInfo(o),n.fillSegment(f,e.response),t(e,f)}l.callHashWorker(e.response,i)}(0,s.default)(this,t);var u=i.eventBus,l=i.workerHelper,c=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this)),f=e;return c.getFullSegment=function(e,t){u.emit("CDNSegmentDownloaded",f);var n=e.response;i.transferStats.cdnDownloaded+=n.byteLength,o(e,t)},c}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"getUpdatedRange",value:function(e){return e}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}},{key:"byteLength",get:function(){return null}}]),t}(p.default);t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=r(i),o=n(10),s=r(o),u=n(33),l=r(u),c=n(109),d=r(c),f=n(31),h=r(f),_=n(5),p=n(195),v=r(p),E=n(218),m=r(E),S=n(2),g=r(S),T=n(111),y=r(T),C=n(99),D=r(C),A=n(187),w=r(A),R=n(190),P=r(R),b=n(106),k=r(b),I={EXCLUSION_REMOVED:"removed",EXCLUSION_DISCONNECTED:"disconnected",EXCLUSION_OFFER_DECLINED:"offer_declined",EXCLUSION_CONNECTION_ATTEMPT_TIMED_OUT:"timed_out"},O=function(e,t,n,r,i){var o=i.conf,u=i.status,c=i.peerStats,f=void 0,p=null,E=!1,S=void 0,T=null,C=void 0,A=!1,R=0,b=l.default,O=[],N=new D.default(e,t,i),L=r,M=this,U=i.eventBus,B=i.statsProvider,x=new h.default,F=function(){return O.map(function(e){return e.getHistoricalMeanRtt()}).filter(function(e){return e.count>0}).map(function(e){return e.mean})},H=function(){var e=Date.now();return O.map(function(t){var n=t.getCreationTimestamp(),r=n>i.lastStatPayloadTimestamp?n:i.lastStatPayloadTimestamp;return e-r}).reduce(function(e,t){return e+t},0)/1e3},G=function(){E=!0,V()},j=function(){E=!1,V()},V=function(e){if(x.clear(p),p=null,!E){var t=Date.now()-b,n=e-t;n>0?(p=(0,_.createTimeout)(ee,n),x.register(p)):ee()}},W=function(e){if(e.isVideo){var t=!0,n=!1,r=void 0;try{for(var a,u=(0,s.default)(O);!(t=(a=u.next()).done);t=!0)if(a.value.isOnSameTrack()){i.abrStats.trackSwitchWithPeers++;break}}catch(e){n=!0,r=e}finally{try{!t&&u.return&&u.return()}finally{if(n)throw r}}p&&V(o.ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL)}},K=function(){ve()&&M.makeRoom();var e=0,t=0,n=!0,r=!1,i=void 0;try{for(var a,o=(0,s.default)(O);!(n=(a=o.next()).done);n=!0){var u=a.value;u.locked()&&e++,u.isLooser()&&t++}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}c.locked.updateMetric(e),c.loosers.updateMetric(t);var l=0,d=!0,f=!1,h=void 0;try{for(var _,p=(0,s.default)(O);!(d=(_=p.next()).done);d=!0)_.value.isOnSameTrack()&&l++}catch(e){f=!0,h=e}finally{try{!d&&p.return&&p.return()}finally{if(f)throw h}}U.emit(g.default.PeerPool.PEER_STATS_UPDATE,{peerCount:O.length,sameTrackPeerCount:l})},q=function(){for(var e=0,t=0,n=0;n<O.length;n++){var r=O[n];e+=r.getDlSpeed(),t+=r.getUpSpeed()}u.setDlSpeed(e),u.setUpSpeed(t),u.computeMaxAndAvgSpeed()},Y=function(){null!==T&&T.dispose(),T=new m.default(u.getMyPeerId(),this,n,i),C=new w.default(T,i),S=new P.default(this,T,i),f=C.onPeersFromTracker.bind(C),A&&z()},Q=function(){p&&(x.clear(p),p=null)},z=function(){if(u.getConnected()&&u.getConnectedToSignalingServer()){var e=Date.now()-b,t=Date.now()-i.moduleState.currentTracks.lastSwitchTimestamp,n=t<e?o.ASK_PEERS_AFTER_TRACK_SWITCH_INTERVAL:o.ASK_PEERS_INTERVAL;V(n),A=!0}},X=function(e){$(e),U.emit(g.default.PeerPool.PEER_DESTROYED,{remotePeer:e,peerCount:O.length})},Z=function(e){return d.default.withoutAll(O,e)>0&&(e.isConnected()&&e.close(),!0)},J=function(e){Z(e)&&(S.addSecondOrderExclusion(e.getId(),o.PEER_REMOVED_EXCLUSION_RANK,o.PEER_REMOVED_EXCLUSION_DURATION,I.EXCLUSION_REMOVED),e.isOnSameTrack()?c.droppedSameTrack++:c.droppedOtherTrack++)},$=function(e){Z(e)&&S.addSecondOrderExclusion(e.getId(),o.PEER_DISCONNECTED_EXCLUSION_RANK,o.PEER_DISCONNECTED_EXCLUSION_DURATION,I.EXCLUSION_DISCONNECTED)},ee=function e(){b=Date.now();var t=S.exclusionList;c.exclusionSize=S.secondOrderExclusions.size,N.askPeers(t,f),p=(0,_.createTimeout)(e,o.ASK_PEERS_INTERVAL),x.register(p)},te=function(){return O.length},ne=function(e){for(var t=0;t<O.length;t++)O[t].requestHasSegment(e)},re=function(){(0,a.default)(O).forEach(function(e){e.isConnected()&&e.close()})},ie=function(e,t,r){var a=ae(),o=new v.default(e,n,t,i,a);O.push(o),r?c.openedMatch++:c.openedOffer++,U.emit(g.default.PeerPool.PEER_OPEN,{remotePeer:o,peerCount:O.length}),de()},ae=function(){for(var e=[],t=0,n=O.length;t<n;t++)e.push(O[t].getUploadCapacity());var r=y.default.median(e);return r?Math.max(r,o.MIN_PEER_UPLOAD_CAPACITY):o.DEFAULT_PEER_UPLOAD_CAPACITY},oe=function(){for(var e=0,t=0,n=O.length;t<n;t++)e+=O[t].getUploadCapacity();c.peerPoolUploadCapacity.updateMetric(e)},se=function(){return O.length>0?O[Math.floor(Math.random()*O.length)].getUploadCapacity():0},ue=function(e){S.addSecondOrderExclusion(e,o.OFFER_DECLINED_EXCLUSION_RANK,o.OFFER_DECLINED_EXCLUSION_DURATION,I.EXCLUSION_OFFER_DECLINED),c.denied++},le=function(e){S.addSecondOrderExclusion(e,o.PEER_CONNECTION_ATTEMPT_EXCLUSION_RANK,o.PEER_CONNECTION_ATTEMPT_TIMED_OUT_EXCLUSION_DURATION,I.EXCLUSION_CONNECTION_ATTEMPT_TIMED_OUT),ce()},ce=function(){++R>o.MAX_PEER_CONNECTION_FAILURES&&(fe(),he())},de=function(){R=0},fe=function(){U.emit(g.default.Tracker.PERM_TRACKER_DISCONNECTION_REQUEST)},he=function(){U.emit(g.default.Signaling.PERM_SIGNALING_DISCONNECTION_REQUEST)},_e=function(e){var t=L.getSegmentInfo(e),n=!0,r=!1,i=void 0;try{for(var a,o=(0,s.default)(O);!(n=(a=o.next()).done);n=!0)a.value.answerHasSegment(t,{pushed:!0})}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}},pe=function(){var e=[],t=[],n=1,r=1,i=!0,a=!1,o=void 0;try{for(var u,l=(0,s.default)(O);!(i=(u=l.next()).done);i=!0){var c=u.value;c.locked()||(c.isLooser()?e.push(c):t.push(c)),n=Math.max(n,c.getUpSpeedEMA()),r=Math.max(r,c.getUsefulDlSpeedEMA())}}catch(e){a=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(a)throw o}}return{loosers:e,unlocked:t,maxUpSpeed:n,maxDownSpeed:r}},ve=function(){return O.length-o.PEER_POOL_LIMIT>0},Ee=function(e,t,n){var r=e.getUpSpeedEMA()/t+e.getUsefulDlSpeedEMA()/n;return r},me=function(){u.getEE().removeListener("tracker_ready",Y),u.getEE().removeListener("tracker_disconnected",Q),u.getEE().removeListener("signaling_ready",z),u.getEE().removeListener("signaling_disconnected",Q),null!==T&&T.dispose(),C&&C.dispose(),x.clearAll(),re(),N.dispose()};M.getPeerArray=function(){return O},M.lockedCount=function(){var e=0,t=!0,n=!1,r=void 0;try{for(var i,a=(0,s.default)(O);!(t=(i=a.next()).done);t=!0)i.value.locked()&&e++}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return e},M.openSlotsCount=function(){return Math.max(o.PEER_POOL_LIMIT-M.lockedCount(),0)},M.makeRoom=function(){var e=pe(),t=e.loosers,n=e.unlocked,r=e.maxUpSpeed,i=e.maxDownSpeed;for(t.sort(function(e,t){return t.getUpSpeedEMA()-e.getUpSpeedEMA()});t.length>0&&ve();){var a=t.pop();J(a)}if(ve())for(n.sort(function(e,t){return Ee(t,r,i)-Ee(e,r,i)});n.length>0&&ve();){var o=n.pop();J(o)}},M.getPeerCount=te,M.getPendingConnectionDebugInfos=function(){return T?T.getPendingConnectionDebugInfos():[]},M.requestHasSegment=ne,M.addPeerConnection=ie,this.offerDeclined=ue,this.connectionAttemptTimeout=le,M.broadcastSegmentInfo=_e,M.dispose=me,function(){var e=(0,_.createInterval)(q,o.SPEED_MONITOR_INTERVAL),t=(0,_.createInterval)(oe,o.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL),n=(0,_.createInterval)(K,o.PEER_POOL_MAINTENANCE_INTERVAL);x.register(e),x.register(t),x.register(n),U.on(g.default.Peer.PEER_DISCONNECTED,X),U.on(g.default.Metrics.TRACK_SWITCH,W,this),U.on(g.default.PeerPool.STOP_ASKING_PEERS,G),U.on(g.default.PeerPool.START_ASKING_PEERS,j),u.getEE().on("tracker_ready",Y,M),u.getEE().on("tracker_disconnected",Q,M),u.getEE().on("signaling_ready",z,M),u.getEE().on("signaling_disconnected",Q,M),B.registerProvider(k.default.PeerStats.SAMPLED_PUC,se),B.registerProvider(k.default.PeerStats.SAMPLED_LIVE_CONNECTION_RTT,F),B.registerProvider(k.default.PeerStats.TOTAL_CONNECTION_DURATION,H)}()};t.default=O,e.exports=t.default},function(e,t,n){"use strict";var r=n(226),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=n(53);e.exports={getSegment:function(e,t,n,r,o){var s=n.onProgress,u=void 0===s?a.noop:s,l=n.onError,c=void 0===l?a.noop:l,d=n.onSuccess,f=void 0===d?a.noop:d,h=n.onFallback,_=void 0===h?a.noop:h,p={onProgress:u,onError:c,onSuccess:f,onFallback:_};return(0,i.default)(e,o,t,p,r).getSegment()}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=function(){function e(){(0,s.default)(this,e),this._map=new a.default}return(0,l.default)(e,[{key:"addSegmentInfo",value:function(e){var t=e.segmentCoord.viewToString();this._map.set(t,e)}},{key:"getSegmentInfo",value:function(e){var t=e.viewToString(),n=this._map.get(t);if(!n)throw new Error("segmentInfo not found in the map for the given SegmentCoord");return n}},{key:"removeSegmentInfo",value:function(e){var t=e.viewToString();this._map.delete(t)}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){function r(e,t){if(n.isP2PUploadOn&&!n.isP2PUploadBlocked){var r=a.getSegmentHandler(t),o=r?r.chunkManager:null;if(o&&o.getPercentageOfChunksDownloaded()>=n.conf.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER){var s=i.getSegmentInfo(t);e.answerHasSegment(s,{pushed:!1})}}}var i=e,a=t;n.eventBus.on("segmentRequested",r)};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){var i=t.transferStats,a=i.cdnDownloaded,o=i.p2pUseful,s=i.p2pUploaded,u=e?e.getPeerArray().length:0,l={cdn:a,p2p:o,peers:u,upload:s,confLabel:""};if(t.conf.ANALYTICS.EXPOSE_CONF_LABEL){var c=t.conf.QOS_P2P_DISABLED||!t.conf.RAMP_UP_ACTIVATED?"off":"on";l.confLabel=t.conf.CONF_LABEL+"|"+c}return l}Object.defineProperty(t,"__esModule",{value:!0});var a=n(273),o=(r(a),n(138));r(o),n(5),t.default={get:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(50),l=n(191),c=r(l),d=n(228),f=r(d),h=function(){function e(t,n){(0,a.default)(this,e),this._externalEventManager=t,this._externalEventManager.cacheMediaEvent(c.default.TRACK_CHANGE_EVENT),this._sharedState=n}return(0,s.default)(e,[{key:"listenEvents",value:function(e){var t=this._updateCurrentTracks.bind(this),n=this._onFragLoadAborted.bind(this);this._externalEventManager.addMediaEventListener(c.default.TRACK_CHANGE_EVENT,t),this._externalEventManager.addMediaEventListener(c.default.EMERGENCY_FRAG_LOAD_ABORT,n);try{this._externalEventManager.triggerCachedEvent(c.default.TRACK_CHANGE_EVENT,t)}catch(t){if(!e)throw t}}},{key:"_onFragLoadAborted",value:function(){this._sharedState.mediaStats.emergencyTrackSwitchCount++}},{key:"_updateCurrentTracks",value:function(e){var t=e.audio,n=e.video;t&&(0,u.checkInterface)(f.default,t),n&&(0,u.checkInterface)(f.default,n),this._sharedState.moduleState.currentTracks.update({audio:t,video:n})}},{key:"updateWithSegmentView",value:function(e){var t={};t[e.trackView.type]=e.trackView,this._updateCurrentTracks(t)}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){e.eventBus.on(a.default.BufferedAmountObserver.BUFFER_CHECK,function(t){t<e.conf.VOD_CRITICAL_BUFFER_THRESHOLD?(e.p2pDownloadBlocker.block(e.conf.VOD_CRITICAL_BUFFER_P2P_STOP_DOWNLOAD_DURATION,o),e.p2pUploadBlocker.block(e.conf.VOD_CRITICAL_BUFFER_P2P_STOP_UPLOAD_DURATION,o)):t>e.conf.VOD_SAFE_BUFFER_THRESHOLD&&e.p2pDownloadBlocker.unblock(o)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var i=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(i),o="vodQosOptimizerBlock";e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(38),l=n(2),c=r(l),d=n(208),f=r(d),h=n(205),_=r(h),p=n(207),v=r(p),E=n(206),m=r(E),S=n(5),g=n(25),T=function(){function e(t,n,r){(0,a.default)(this,e),this._peerCount=0,this._bufferTarget=0,this._bufferedAmount=0,this._randomBufferLevel=null,this._reachedLiveEdge=!1,this._bufferTargetState=v.default.INIT,this._bufferStatus=m.default.ZERO,this._lastLowToModerateBufferTimestamp=null,this._droppedUnderLow=!1,this._reboundCount=0,this._netLowTargetChange=0,this._targetGapSamplerTimeout=null,this._allowBufferTargetAdjust=!1,this._sharedState=r,this._playerInterface=t,this._mediaElementPlaceholder=n,this._bufferStateMachine=new _.default(r.eventBus),this._onLiveEdgeChangedCallback=this._onLiveEdgeChanged.bind(this),this._onUncompleteSegmentRequestedCallback=this._onUncompleteSegmentRequested.bind(this),this._onPeerCountChangedCallback=this._onPeerCountChanged.bind(this),this._onBufferCheckCallback=this._bufferCheck.bind(this),this._onConfigUpdatedCallback=this._resetDynamicBufferLevels.bind(this),this._onDistributorAnsweredCallback=this._onDistributorAnswered.bind(this),this._sharedState.eventBus.on(c.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChangedCallback),this._sharedState.eventBus.on(c.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED,this._onUncompleteSegmentRequestedCallback),this._sharedState.eventBus.on(c.default.PeerPool.PEER_OPEN,this._onPeerCountChangedCallback),this._sharedState.eventBus.on(c.default.PeerPool.PEER_DESTROYED,this._onPeerCountChangedCallback),this._sharedState.eventBus.on(c.default.BufferedAmountObserver.BUFFER_CHECK,this._onBufferCheckCallback),this._sharedState.eventBus.on(c.default.Config.CONFIG_UPDATED,this._onConfigUpdatedCallback),this._sharedState.eventBus.once(c.default.Distributor.ANSWERED,this._onDistributorAnsweredCallback),this._currentLowerBufferTarget=this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._uploadCapacityCalculator=new f.default(this._sharedState),this._sampleTargetGap(0)}return(0,s.default)(e,[{key:"_sampleTargetGap",value:function(e){this._sharedState.bufferStats.sampledHighLowBufferTargetGap=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._currentLowerBufferTarget;var t=Math.random()*this._sharedState.conf.ANALYTICS.STATS_INTERVAL;this._targetGapSamplerTimeout=(0,S.createTimeout)(this._sampleTargetGap.bind(this,this._sharedState.conf.ANALYTICS.STATS_INTERVAL-t),e+t)}},{key:"_onUncompleteSegmentRequested",value:function(){this._isLowBufferTarget()&&(this._sharedState.eventBus.emit(c.default.BufferManager.LOW_BUFFER,this._bufferedAmount),this._setHighTarget())}},{key:"_onLiveEdgeChanged",value:function(e){this._reachedLiveEdge=e&&(this._sharedState.moduleState.streamType!==u.StreamTypes.SMOOTH||this._bufferedAmount>this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-3)}},{key:"_onPeerCountChanged",value:function(e){var t=e.peerCount;this._peerCount=t}},{key:"_onDistributorAnswered",value:function(){this._sharedState.conf.LIVE.INIT_P2P_DOWNLOAD_BLOCK_DURATION>0&&this._sharedState.p2pDownloadBlocker.block(this._sharedState.conf.LIVE.INIT_P2P_DOWNLOAD_BLOCK_DURATION,"liveInitBlock"),this._sharedState.conf.LIVE.INIT_P2P_UPLOAD_BLOCK_DURATION>0&&this._sharedState.p2pUploadBlocker.block(this._sharedState.conf.LIVE.INIT_P2P_UPLOAD_BLOCK_DURATION,"liveInitBlock")}},{key:"_bufferCheck",value:function(e){this._bufferedAmount=e,0===this._peerCount?(this._bufferStateMachine.gotoNoPeer(),this._setHighTarget()):this._uploadCapacityCalculator.uploadCapacityEMWA>=this._sharedState.conf.LIVE.UPLOAD_THRESHOLD_MAX_BUFFER_TARGET_LOCKING?(this._bufferStateMachine.gotoTopSeeder(),this._setHighTarget()):null!==this._mediaElementPlaceholder.mediaElement?(this._bufferStateMachine.gotoDynamic(),this._dynamicBufferCheck()):(this._bufferStateMachine.gotoRandom(),this._setRandomTarget());var t=void 0;t=this._reachedLiveEdge||this._bufferedAmount>this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET?m.default.HIGH:this._bufferedAmount>this._currentLowerBufferTarget?m.default.MODERATE:this._bufferedAmount>this._sharedState.conf.LIVE.CRITICAL_LOWER_TARGET_RATIO*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET?m.default.LOW:this._bufferedAmount>this._sharedState.conf.BUFFER_ZERO_THRESHOLD?m.default.CRITICALLY_LOW:m.default.ZERO,
this._bufferedAmount<this._currentLowerBufferTarget&&this._reachedLiveEdge?this._sharedState.bufferStats.timeLowerTargetAboveLiveEdgeStaircase.updateMetric(1):this._sharedState.bufferStats.timeLowerTargetAboveLiveEdgeStaircase.updateMetric(0),t>=m.default.MODERATE&&(this._allowBufferTargetAdjust=!0),this._bufferStatus!==t&&(this._bufferStatusChanged(this._bufferStatus,t),this._bufferStatus=t)}},{key:"_bufferStatusChanged",value:function(e,t){if(this._sharedState.conf.LIVE.ENABLE_DYNAMIC_LOWER_TARGET){if(e>m.default.ZERO&&t===m.default.CRITICALLY_LOW&&this._adjustLowerTarget((this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET)*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET_INCREASE_STEP),e<=m.default.LOW&&t>=m.default.MODERATE&&(this._lastLowToModerateBufferTimestamp=Date.now()),e>=m.default.MODERATE&&t<=m.default.LOW&&(this._droppedUnderLow=!0),t>=m.default.HIGH){if(null!=this._lastLowToModerateBufferTimestamp){var n=(Date.now()-this._lastLowToModerateBufferTimestamp)/1e3;this._lastLowToModerateBufferTimestamp=null;var r=(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._currentLowerBufferTarget)*this._sharedState.conf.LIVE.FAST_BUFFER_FILL_FRACTION;(n<=r||0===r)&&this._adjustLowerTarget(-(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET)*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET_DECREASE_STEP)}this._droppedUnderLow&&this._reboundCount++}this._reboundCount>0&&(this._sharedState.bufferStats.lowerBufferTargetNetChangePerRebound=this._netLowTargetChange/this._reboundCount)}}},{key:"_resetDynamicBufferLevels",value:function(){var e=this._isLowBufferTarget();this._currentLowerBufferTarget=this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._droppedUnderLow=!1,e&&this._setLowTarget()}},{key:"_adjustLowerTarget",value:function(e){if(this._allowBufferTargetAdjust){var t=this._currentLowerBufferTarget,n=this._isLowBufferTarget();this._currentLowerBufferTarget=(0,g.clamp)(this._currentLowerBufferTarget+e,this._sharedState.conf.LIVE.CRITICAL_LOWER_TARGET_RATIO*this._sharedState.conf.LIVE.LOWER_BUFFER_TARGET,this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET),this._netLowTargetChange+=Math.abs(t-this._currentLowerBufferTarget),n&&this._setLowTarget(),this._allowBufferTargetAdjust=!1}}},{key:"_dynamicBufferCheck",value:function(){this._isHighBufferTarget()?(this._bufferedAmount>=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET||this._reachedLiveEdge)&&(this._sharedState.eventBus.emit(c.default.BufferManager.HIGH_BUFFER,this._bufferedAmount),this._setLowTarget()):this._isLowBufferTarget()||this._setHighTarget()}},{key:"_bufferTargetStateChanged",value:function(e){e!==this._bufferTargetState&&(this._bufferTargetState===v.default.LOW&&e===v.default.HIGH?this._sharedState.p2pDownloadBlocker.block(this._sharedState.conf.LIVE.LOW_TARGET_P2P_DL_BLOCK_DURATION,"liveLowToHighBlock"):this._bufferTargetState===v.default.HIGH&&e===v.default.LOW&&(this._sharedState.p2pDownloadBlocker.unblock("liveLowToHighBlock"),this._sharedState.p2pDownloadBlocker.unblock("liveInitBlock"),this._sharedState.p2pUploadBlocker.unblock("liveInitBlock")),this._bufferTargetState=e)}},{key:"_setRandomTarget",value:function(){this._bufferTargetStateChanged(v.default.RANDOM),this._bufferTarget=this._getRandomBufferLevel(),this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_setHighTarget",value:function(){this._bufferTargetStateChanged(v.default.HIGH),this._bufferTarget=this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET,this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_setLowTarget",value:function(){this._bufferTargetStateChanged(v.default.LOW),this._bufferTarget=this._currentLowerBufferTarget,this._playerInterface.setBufferMarginLive(this._bufferTarget)}},{key:"_isLowBufferTarget",value:function(){return this._bufferTarget===this._currentLowerBufferTarget}},{key:"_isHighBufferTarget",value:function(){return this._bufferTarget===this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET}},{key:"_getRandomBufferLevel",value:function(){return this._randomBufferLevel=this._randomBufferLevel||Math.floor(Math.random()*(this._sharedState.conf.LIVE.HIGHER_BUFFER_TARGET-this._currentLowerBufferTarget+1))+this._currentLowerBufferTarget,this._randomBufferLevel}},{key:"dispose",value:function(){this._uploadCapacityCalculator.dispose(),this._targetGapSamplerTimeout&&this._targetGapSamplerTimeout.clear(),this._sharedState.eventBus.removeListener(c.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChangedCallback),this._sharedState.eventBus.removeListener(c.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED,this._onUncompleteSegmentRequestedCallback),this._sharedState.eventBus.removeListener(c.default.PeerPool.PEER_OPEN,this._onPeerCountChangedCallback),this._sharedState.eventBus.removeListener(c.default.PeerPool.PEER_DESTROYED,this._onPeerCountChangedCallback),this._sharedState.eventBus.removeListener(c.default.BufferedAmountObserver.BUFFER_CHECK,this._onBufferCheckCallback),this._sharedState.eventBus.removeListener(c.default.Config.CONFIG_UPDATED,this._onConfigUpdatedCallback),this._sharedState.eventBus.removeListener(c.default.Distributor.ANSWERED,this._onDistributorAnsweredCallback)}},{key:"bufferTarget",get:function(){return this._bufferTarget}},{key:"bufferedAmount",get:function(){return this._bufferedAmount}},{key:"mediaElementPlaceholder",set:function(e){this._mediaElementPlaceholder=e}},{key:"reachedLiveEdge",get:function(){return this._reachedLiveEdge}}]),e}();t.default=T,e.exports=t.default},function(e,t,n){"use strict";(function(n){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,r){var i=r.status,a=function(){for(var n={download:{p2pUseful:r.transferStats.p2pUseful,p2pUploaded:r.transferStats.p2pUploaded,cdnDownloaded:r.transferStats.cdnDownloaded,dlSpeed:i.getDlSpeed(),upSpeed:i.getUpSpeed(),p2pDownloaded:r.transferStats.p2pUseful,p2pDownloadedNewAnalytics:r.transferStats.p2pUseful},peers:{count:0},buffer:{bufferTarget:t?t.bufferTarget:0,bufferedAmount:r.bufferStats.bufferedAmount,reachedLiveEdge:t?t._reachedLiveEdge:void 0},tracker:{connected:i.getConnected()},trackerConnected:i.getConnected(),sigConnected:i.getConnectedToSignalingServer(),isLive:r.moduleState.isLive()},a=[],o=0;o<e.getPeerArray().length;o++){var s=e.getPeerArray()[o];s.getId()&&n.peers.count++,a.push(s.getDebugInfos())}return n.peerList=a,n};!function(){n.SR_DISPLAY_INTERFACE={getStats:a}}(),this.dispose=function(){delete window.SR_DISPLAY_INTERFACE}};t.default=r,e.exports=t.default}).call(t,n(92))},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getBufferLevelMax",value:function(){return 0}},{key:"isLive",value:function(){return!1}},{key:"setBufferMarginLive",value:function(e){}},{key:"addEventListener",value:function(e,t){}},{key:"removeEventListener",value:function(e,t){}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r){return r.moduleState.streamType===l.StreamTypes.HLS?new o.default(e,t,n,r):new u.default(e,t,n,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.createScheduler=i;var a=n(231),o=r(a),s=n(230),u=r(s),l=n(38)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e,t){function n(e,t){var n=r.getSegmentHandler(t.segmentCoord),i=n?n.chunkManager:null;i&&i.getChunk(t.chunkIndex,function(n){n?e.onChunkFound(t,n):e.onChunkMissed()})}var r=e;t.eventBus.on(i.default.UploadQueue.CHUNK_REQUESTED,n)};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){window.Streamroot=window.Streamroot||{},window.Streamroot.Downloader=window.Streamroot.Downloader||e,window.Streamroot.peerAgents=window.Streamroot.peerAgents||{},window.Streamroot.uaHelper=c.default,Object.defineProperty(window.Streamroot,"p2pAvailable",{get:function(){var e=(0,u.default)(window.Streamroot.peerAgents);return e.length?window.Streamroot.peerAgents[e[0]].isP2PEnabled:(0,d.isP2PAvailable)()}})}function a(e,t){window.Streamroot.peerAgents&&(window.Streamroot.peerAgents[e]=t.PublicAPI)}function o(e){window.Streamroot.peerAgents[e]&&delete window.Streamroot.peerAgents[e]}Object.defineProperty(t,"__esModule",{value:!0});var s=n(42),u=r(s),l=n(40),c=r(l),d=n(93);t.default={setup:i,addToPeerAgentList:a,removeFromPeerAgentList:o},e.exports=t.default},function(e,t,n){"use strict";function r(e){var t=e.version,n={version:t,get isP2PEnabled(){return e.isP2PEnabled},get stats(){return e.stats},get p2pDownloadOn(){return e.p2pDownloadOn},set p2pDownloadOn(t){e.p2pDownloadOn=t},get p2pUploadOn(){return e.p2pUploadOn},set p2pUploadOn(t){e.p2pUploadOn=t}};return n}Object.defineProperty(t,"__esModule",{value:!0}),t.default={get:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(68),l=r(u),c=n(2),d=r(c),f=n(99),h=r(f),_=function(){function e(t){var n=this;(0,a.default)(this,e),this._alreadySent=!1,this._state=e.Status.UNKNOWN,this._onDistributorTimedOut=function(){n._state=e.Status.NO_DISTRIBUTOR,n.sendConfig()},this._onTrackerNotInit=function(t){switch(t.reason){case h.default.Status.CONTENT_DEACTIVATED:n._state=e.Status.CONTENT_DEACTIVATED;break;case h.default.Status.ERROR:n._state=e.Status.TRACKER_ERROR;break;case h.default.Status.RAMP_UP_DEACTIVATED:n._state=e.Status.RAMP_UP_DEACTIVATED;break;case h.default.Status.QOS_TESTER:n._state=e.Status.QOS_TESTER;break;default:n._state=e.Status.UNKNOWN}n.sendConfig()},this._onTrackerReady=function(){n._state=e.Status.TRACKER_READY,n.sendConfig()},this._sharedState=t,this._analyticsClient=new l.default(t,"p2pconfig"),this._sharedState.eventBus.once(d.default.Distributor.TIMED_OUT,this._onDistributorTimedOut),this._sharedState.eventBus.once(d.default.Tracker.BLOCKED,this._onTrackerNotInit),this._sharedState.eventBus.once(d.default.Tracker.FAILED,this._onTrackerNotInit),this._sharedState.eventBus.once(d.default.Tracker.READY,this._onTrackerReady)}return(0,s.default)(e,null,[{key:"Status",get:function(){return{NO_DISTRIBUTOR:"no_distributor",TRACKER_READY:"tracker_ready",TRACKER_ERROR:"tracker_error",RAMP_UP_DEACTIVATED:"ramp_up_deactivated",CONTENT_DEACTIVATED:"content_deactivated",QOS_TESTER:"qos_tester",UNKNOWN:"unknown"}}}]),(0,s.default)(e,[{key:"sendConfig",value:function(){if(!this._alreadySent&&this._state!==e.Status.CONTENT_DEACTIVATED){var t={};t.activateP2P=this._sharedState.conf.ALLOW_P2P,t.debug=this._sharedState.p2pConfig.debug||!1,t.deviceInfo=this._sharedState.conf.DEVICE_INFO,t.trackerUrl=this._sharedState.conf.TRACKER_URL,t.backendUrl=this._sharedState.conf.DISTRIBUTOR.URL,t.signalingUrl=this._sharedState.conf.SIGNALING_URL,t.analyticsUrl=this._sharedState.conf.ANALYTICS.KLARA_URL,t.vodCacheSize=this._sharedState.conf.P2P_CACHE_MAX_SIZE/1048576,t.liveCacheSize=this._sharedState.conf.LIVE.P2P_CACHE_MAX_SIZE/1048576,t.rangeRequestEnabled=this._sharedState.conf.RANGE_REQUEST_DETECTION,t.mobileBrowserEnabled=this._sharedState.conf.ENABLE_MOBILE_BROWSER,t.enableStunServers=this._sharedState.conf.ENABLE_STUN;var n={live:this._sharedState.moduleState.isLive(),confLabel:this._sharedState.conf.CONF_LABEL,origin:"",referrer:"",href:"",p2pConfig:t,rampUpActivated:this._sharedState.conf.RAMP_UP_ACTIVATED,statsSender:this._sharedState.conf.ANALYTICS.ENABLE_STATS_SENDER,controlSender:this._sharedState.conf.ANALYTICS.ENABLE_CONTROL_SENDER,trackerId:this._sharedState.status.getTrackerId()||"",state:this._state};document&&document.referrer&&(n.referrer=document.referrer),window&&(window.origin&&(n.origin=window.origin),window.location&&window.location.href&&(n.href=window.location.href)),this._analyticsClient.send(n),this._alreadySent=!0}}},{key:"dispose",value:function(){this._sharedState.eventBus.removeListener(d.default.Distributor.TIMED_OUT,this._onDistributorTimedOut),this._sharedState.eventBus.removeListener(d.default.Tracker.BLOCKED,this._onTrackerNotInit),this._sharedState.eventBus.removeListener(d.default.Tracker.FAILED,this._onTrackerNotInit),this._sharedState.eventBus.removeListener(d.default.Tracker.READY,this._onTrackerReady)}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(5),d=100,f=function(){function e(t,n){(0,a.default)(this,e),this._tickInterval=null,this._sharedState=n,null===t.mediaElement||this._sharedState.moduleState.isLive()||(this._mediaElement=t.mediaElement,this._tickInterval=(0,c.createInterval)(this._tick.bind(this),d))}return(0,s.default)(e,[{key:"_tick",value:function(){if(null!==this._mediaElement){var e=this._mediaElement.duration,t=this._mediaElement.currentTime;e&&e-t<.3&&(null!==this._tickInterval&&(this._tickInterval.clear(),this._tickInterval=null),this._sharedState.eventBus.emit(l.default.Media.ENDED))}}},{key:"dispose",value:function(){null!==this._tickInterval&&this._tickInterval.clear()}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(51),l=r(u),c=n(4),d=r(c),f=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,null,[{key:"send",value:function(e,t,n){var r=n.conf,i=n.status,a={timeout:r.ANALYTICS.TIMEOUT_DELAY,retry:r.ANALYTICS.RETRY_NUMBER,retryDelay:r.ANALYTICS.RETRY_DELAY,headers:{Authorization:i.getBearerToken(),"Content-Type":"application/json;charset=UTF-8"}},o=new l.default(l.default.Methods.POST,e,a);o.isStreamroot=!0,o.send(t).catch(function(e){d.default.notifyError(new Error("Could not send analytics payload: "+e.message+". Status: "+e.status))})}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._sharedState=t,this._init()}return(0,s.default)(e,[{key:"_init",value:function(){var e=this;this.reset(),this._sharedState.eventBus.on("p2pUploadToggle",function(t){t||(e._p2pUploadAlwaysOn=!1)}),this._sharedState.eventBus.on("p2pDownloadToggle",function(t){t||(e._p2pDownloadAlwaysOn=!1)})}},{key:"reset",value:function(){this._p2pDownloadAlwaysOn=this._sharedState.isP2PDownloadOn,this._p2pUploadAlwaysOn=this._sharedState.isP2PUploadOn}},{key:"p2pDownloadAlwaysOn",get:function(){return this._p2pDownloadAlwaysOn}},{key:"p2pUploadAlwaysOn",get:function(){return this._p2pUploadAlwaysOn}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(73),l=r(u),c=n(25),d=n(2),f=r(d),h=function(){function e(t){(0,a.default)(this,e),this._peerCountStaircaseFunctionIntegral=new l.default,this._sameTrackPeerCountStaircaseFunctionIntegral=new l.default,this._abovePeerPoolLimitPeerCount=new l.default,this._abovePeerPoolLimitTime=new l.default,this._sharedState=t,t.eventBus.on(f.default.PeerPool.PEER_STATS_UPDATE,this._processPeerPoolStats,this),t.eventBus.on(f.default.PeerPool.PEER_OPEN,this._trackPeerCount,this),t.eventBus.on(f.default.PeerPool.PEER_DESTROYED,this._trackPeerCount,this)}return(0,s.default)(e,[{key:"_trackPeerCount",value:function(e){var t=e.peerCount,n=Math.max(0,t-this._sharedState.conf.PEER_POOL_LIMIT);this._abovePeerPoolLimitPeerCount.updateMetric(n),this._abovePeerPoolLimitTime.updateMetric(n>0?1:0)}},{key:"_processPeerPoolStats",value:function(e){var t=e.peerCount,n=e.sameTrackPeerCount;this._peerCountStaircaseFunctionIntegral.updateMetric(t),this._sameTrackPeerCountStaircaseFunctionIntegral.updateMetric(n)}},{key:"getAveragePeerCount",value:function(){return(0,c.toDecimal)(this._peerCountStaircaseFunctionIntegral.getAverage(),2)}},{key:"getSameTrackPeerCount",value:function(){return(0,c.toDecimal)(this._sameTrackPeerCountStaircaseFunctionIntegral.getAverage(),2)}},{key:"getUncorrectedAverageAboveLimitPeerCount",value:function(){return this._abovePeerPoolLimitPeerCount.getAverage()}},{key:"getAbovePeerPoolLimitTime",value:function(){return this._abovePeerPoolLimitTime.getIntegral().value}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(68),d=r(c),f=n(174),h=r(f),_=n(173),p=r(_),v=n(19),E=n(25),m=n(178),S=r(m),g=function(){function e(t,n){(0,s.default)(this,e);var r=n.conf,i=n.moduleState,a=n.status,o=n.transferStats,u=n.efficiencyStats,l=n.controlStats,c=n.bufferStats,f=n.abrStats;this._conf=r,this._status=a,this._transferStats=o,this._efficiencyStats=u,this._controlStats=l,this._abrStats=f,this._moduleState=i,this._bufferStats=c,this._analyticsClient=new d.default(n,"stats"),this._peerStats=n.peerStats,this._mediaStats=n.mediaStats,this._sessionStartTime=Date.now(),this._p2pUseful=new v.Delta,this._cdnDownloaded=new v.Delta,this._p2pConsumed=new v.Delta,this._cdnConsumed=new v.Delta,this._p2pMediaDownloaded=new v.Delta,this._p2pMessagesDownloaded=new v.Delta,this._p2pHeadersDownloaded=new v.Delta,this._p2pMessagesCount=new v.Delta,this._p2pUploaded=new v.Delta,this._PP=new v.Delta,this._PC=new v.Delta,this._CP=new v.Delta,this._CC=new v.Delta,this._HP=new v.Delta,this._HD=new v.Delta,this._M=new v.Delta,this._total=new v.Delta,this._concurrentP2pDownloaded=new v.Delta,this._concurrentP2pDownloadCount=new v.Delta,this._cdnEstimationCount=new v.Delta,this._p2pSpeedWindowsCount=new v.Delta,this._zeroP2pSpeedWindowsCount=new v.Delta,this._peerPoolObserver=new h.default(n),this._optionsObserver=new p.default(n),this._receivedChunkRequest=new v.Delta,this._missedDequeuedChunkRequest=new v.Delta,this._dequeuedReceivedChunkRequest=new v.Delta,this._sentSafeChunkRequest=new v.Delta,this._sentUnsafeChunkRequest=new v.Delta,this._timeoutSentSafeChunkRequest=new v.Delta,this._timeoutSentUnsafeChunkRequest=new v.Delta,this._gracedChunk=new v.Delta,this._expiredGraceChunk=new v.Delta,this._openedMatch=new v.Delta,this._openedOffer=new v.Delta,this._match=new v.Delta,this._excessMatch=new v.Delta,this._unansweredOffer=new v.Delta,this._offer=new v.Delta,this._active=new v.Delta,this._transfer=new v.Delta,this._denied=new v.Delta,this._droppedSameTrack=new v.Delta,this._droppedOtherTrack=new v.Delta,this._offerTimeout=new v.Delta,this._answerTimeout=new v.Delta,this._timeoutNewConnection=new v.Delta,this._timeoutCheckingConnection=new v.Delta,this._timeoutFailedConnection=new v.Delta,this._timeoutNewIce=new v.Delta,this._timeoutGatheringIce=new v.Delta,this._timeoutCompleteIce=new v.Delta,this._disconnected=new v.Delta,this._lateMessage=new v.Delta,this._timeoutLocalSdp=new v.Delta,this._timeoutRemoteSdp=new v.Delta,this._timeoutLocalSdpWithStun=new v.Delta,this._timeoutRemoteSdpWithStun=new v.Delta,this._timeoutWithLocalStunIce=new v.Delta,this._timeoutWithRemoteStunIce=new v.Delta,this._missedIceCandidate=new v.Delta,this._gatheredIceCandidate=new v.Delta,this._iceCandidatesBucket=new v.Delta,this._earlyIceGatheringFinished=new v.Delta,this._p2pSgtCheckSuccess=new v.Delta,this._p2pSgtCheckFail=new v.Delta,this._hybridSgtCheckSuccess=new v.Delta,this._hybridSgtCheckFail=new v.Delta,this._checkHeartbeatFailed=new v.Delta,this._getSegmentSuccess=new v.Delta,this._getSegmentFallback=new v.Delta,this._counterControl=0,this._sentOfferSdpVolume=new v.Delta,this._sentAnswerSdpVolume=new v.Delta,this._sentIceCandidatesVolune=new v.Delta,this._signalingMessageCount=new v.Delta,this._sentDistributorRootCount=new v.Delta,this._sentTrackerInitCount=new v.Delta,this._sentTrackerPeersCount=new v.Delta,this._sentTrackerTracksCount=new v.Delta,this._timeSpentOnEdge=new v.Delta,this._timeSpentStatic=new v.Delta,this._timeSpentLow=new v.Delta,this._timeSpentHigh=new v.Delta,this._bufferedAmount=new v.Delta,this._bufferRefill=new v.Delta,this._abortFragmentCount=new v.Delta,this._playbackErrorCount=new v.Delta,this._emergencyTrackSwitchCount=new v.Delta,this._qosAnalyticsHandler=new S.default(t,n),this._feebackCount=new v.Delta,this._zeroDurationFeedbackCount=new v.Delta,this._lastPayloadTimestamps={},this._trackSwitchWithPeers=new v.Delta,this._sharedState=n}return(0,l.default)(e,[{key:"_getSessionDuration",value:function(){return Date.now()-this._sessionStartTime}},{key:"_getTimespanSinceLastPayload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return isNaN(this._lastPayloadTimestamps[e])?this._getSessionDuration():Date.now()-this._lastPayloadTimestamps[e]}},{key:"_updateLastPayloadTimestamp",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";this._lastPayloadTimestamps[e]=Date.now()}},{key:"_getPeerStats",value:function(){var e=this._peerPoolObserver.getUncorrectedAverageAboveLimitPeerCount(),t=this._peerPoolObserver.getAbovePeerPoolLimitTime(),n=this._peerStats.dataChannelBufferEmptyingStats.fetchSample();e=t>0?e*this._getTimespanSinceLastPayload()/t:0;var r=this._peerStats.sampledPeerStats.fetchSample();return{count:this._peerPoolObserver.getAveragePeerCount(),sameTrackCount:this._peerPoolObserver.getSameTrackPeerCount(),match:this._match.calcDelta(this._peerStats.match),excessMatch:this._excessMatch.calcDelta(this._peerStats.excessMatch),openedMatch:this._openedMatch.calcDelta(this._peerStats.openedMatch),openedOffer:this._openedOffer.calcDelta(this._peerStats.openedOffer),unansweredOffer:this._unansweredOffer.calcDelta(this._peerStats.unansweredOffer),offer:this._offer.calcDelta(this._peerStats.offer),locked:this._peerStats.locked.getAverage(),loosers:this._peerStats.loosers.getAverage(),active:this._active.calcDelta(this._peerStats.active),transfer:this._transfer.calcDelta(this._peerStats.transfer),denied:this._denied.calcDelta(this._peerStats.denied),droppedSameTrack:this._droppedSameTrack.calcDelta(this._peerStats.droppedSameTrack),droppedOtherTrack:this._droppedOtherTrack.calcDelta(this._peerStats.droppedOtherTrack),offerTimeout:this._offerTimeout.calcDelta(this._peerStats.offerTimeout),answerTimeout:this._answerTimeout.calcDelta(this._peerStats.answerTimeout),timeoutNewConnection:this._timeoutNewConnection.calcDelta(this._peerStats.timeoutNewConnection),timeoutCheckingConnection:this._timeoutCheckingConnection.calcDelta(this._peerStats.timeoutCheckingConnection),timeoutFailedConnection:this._timeoutFailedConnection.calcDelta(this._peerStats.timeoutFailedConnection),timeoutNewIce:this._timeoutNewIce.calcDelta(this._peerStats.timeoutNewIce),timeoutGatheringIce:this._timeoutGatheringIce.calcDelta(this._peerStats.timeoutGatheringIce),timeoutCompleteIce:this._timeoutCompleteIce.calcDelta(this._peerStats.timeoutCompleteIce),disconnected:this._disconnected.calcDelta(this._peerStats.disconnected),lateMessage:this._lateMessage.calcDelta(this._peerStats.lateMessage),sampledPUC:this._peerStats.sampledPUC,peerPoolUploadCapacity:this._peerStats.peerPoolUploadCapacity.getAverage(),exclusionSize:this._peerStats.exclusionSize,successPeerConnectionAttemptDuration:this._peerStats.successPeerConnectionAttemptDuration.fetchSample()||0,failedPeerConnectionAttemptDuration:this._peerStats.failedPeerConnectionAttemptDuration.fetchSample()||0,sampledConnectionDuration:r?Math.round(r.connectionDuration):0,sampledTimeSpentOnSameTrack:r?Math.round(r.sameTrackTime):0,totalConnectionDuration:Math.round(this._peerStats.totalConnectionDuration),dataChannelBufferEmptyingTime:n?n.time:0,dataChannelBufferEmptyingAmount:n?n.amount:0,timeSpentAbovePeerLimit:t,averageOverLimitPeerCount:e,timeoutLocalSdp:this._timeoutLocalSdp.calcDelta(this._peerStats.timeoutLocalSdp),timeoutRemoteSdp:this._timeoutRemoteSdp.calcDelta(this._peerStats.timeoutRemoteSdp),timeoutLocalSdpWithStun:this._timeoutLocalSdpWithStun.calcDelta(this._peerStats.timeoutLocalSdpWithStun),timeoutRemoteSdpWithStun:this._timeoutRemoteSdpWithStun.calcDelta(this._peerStats.timeoutRemoteSdpWithStun),timeoutWithLocalStunIce:this._timeoutWithLocalStunIce.calcDelta(this._peerStats.timeoutWithLocalStunIce),timeoutWithRemoteStunIce:this._timeoutWithRemoteStunIce.calcDelta(this._peerStats.timeoutWithRemoteStunIce),sampledP2pMeanRtt:this._peerStats.sampledP2pMeanRtt}}},{key:"_getBufferStats",value:function(){if(this._bufferStats){var e=(0,E.toDecimal)(this._bufferStats.getTimeSpentOnEdgeRatio(),2),t=(0,E.toDecimal)(this._bufferStats.getTimeSpentWithoutPeerRatio(),2),n=(0,E.toDecimal)(this._bufferStats.getTimeSpentTopSeederRatio(),2),r=this._bufferStats.getTimeSpentDynamicIntegral(),i=r.intervalLength?(0,E.toDecimal)(r.value/r.intervalLength,2):(0,E.toDecimal)(r.value,2),a=(0,E.toDecimal)(1e3*this._bufferRefill.calcDelta(this._bufferStats.bufferRefill)/(r.value+this._bufferStats.bufferedAmount),2),o=this._bufferStats.alwaysDynamicBuffer,s=(0,E.toDecimal)(this._bufferStats.lowerBufferTargetNetChangePerRebound,2),u=this._bufferStats.sampledHighLowBufferTargetGap,l=(0,E.toDecimal)(this._bufferStats.timeLowerTargetAboveLiveEdgeStaircase.getAverage(),2);return{bufferState:this._bufferStats.bufferState,alwaysDynamicBuffer:o,timeSpentOnEdgeRatio:e,timeSpentWithoutPeerRatio:t,timeSpentDynamicRatio:i,timeSpentTopSeederRatio:n,bufferRefillRatio:a,lowerBufferTargetNetChangePerRebound:s,timeLowerTargetAboveLiveEdgeRatio:l,sampledHighLowBufferTargetGap:u}}}},{key:"_getAbrStats",value:function(){var e=this._abrStats.p2pUsefulEstimate,t=this._concurrentP2pDownloaded.calcDelta(this._abrStats.concurrentP2pDownloaded),n=this._concurrentP2pDownloadCount.calcDelta(this._abrStats.concurrentP2pDownloadCount),r=this._cdnEstimationCount.calcDelta(this._abrStats.cdnEstimationCount),i=this._p2pSpeedWindowsCount.calcDelta(this._abrStats.p2pSpeedWindowsCount),a=this._zeroP2pSpeedWindowsCount.calcDelta(this._abrStats.zeroP2pSpeedWindowsCount),o=this._abrStats.bandwidthEstimateCV,s=this._feebackCount.calcDelta(this._abrStats.feebackCount),u=this._zeroDurationFeedbackCount.calcDelta(this._abrStats.zeroDurationFeedbackCount),l=this._trackSwitchWithPeers.calcDelta(this._abrStats.trackSwitchWithPeers);return this._abrStats.flushBandwidthEstimates(),{p2pUsefulEstimate:e,concurrentP2pDownloaded:t,concurrentP2pDownloadCount:n,cdnEstimationCount:r,p2pSpeedWindowsCount:i,zeroP2pSpeedWindowsCount:a,bandwidthEstimateCV:o,feebackCount:s,zeroDurationFeedbackCount:u,trackSwitchWithPeers:l}}},{key:"_calculateStatsPayload",value:function(){var e=this._status.getConnectedToSignalingServer(),t=this._status.getConnected(),n=this._status.getTrackerVersion(),r=this._status.getTrackerId(),i={PP:this._transferStats.multipleDlPP,PC:this._transferStats.multipleDlPC,CP:this._transferStats.multipleDlCP,CC:this._transferStats.multipleDlCC,HP:this._transferStats.multipleDlHP,HD:this._transferStats.multipleDlHD,M:this._transferStats.multipleDlM},o=i.PP+i.PC+i.CP+i.CC+i.HP+i.HD+i.M,s=this._cdnDownloaded.calcDelta(this._transferStats.cdnDownloaded),u=s,l=this._p2pUseful.calcDelta(this._transferStats.p2pUseful),c=this._p2pConsumed.calcDelta(this._transferStats.p2pConsumed),d=this._cdnConsumed.calcDelta(this._transferStats.cdnConsumed),f=this._p2pMediaDownloaded.calcDelta(this._transferStats.p2pMediaDownloaded),h=this._p2pHeadersDownloaded.calcDelta(this._transferStats.p2pHeadersDownloaded),_=this._p2pMessagesDownloaded.calcDelta(this._transferStats.p2pMessagesDownloaded),p=this._p2pMessagesCount.calcDelta(this._transferStats.p2pMessagesCount),v=this._p2pUploaded.calcDelta(this._transferStats.p2pUploaded),m={p2pMediaDownloaded:f,p2pHeadersDownloaded:h,p2pMessagesDownloaded:_,p2pMessagesCount:p,cdnDownloaded:s,p2pUseful:l,cdnUseful:u,p2pConsumed:c,cdnConsumed:d,p2pUploaded:v,multipleDl:{PP:this._PP.calcDelta(i.PP),PC:this._PC.calcDelta(i.PC),CP:this._CP.calcDelta(i.CP),CC:this._CC.calcDelta(i.CC),HP:this._HP.calcDelta(i.HP),HD:this._HD.calcDelta(i.HD),M:this._M.calcDelta(i.M),total:this._total.calcDelta(o)}},S=this._receivedChunkRequest.calcDelta(this._efficiencyStats.receivedChunkRequestCount),g=this._dequeuedReceivedChunkRequest.calcDelta(this._efficiencyStats.dequeuedReceivedChunkRequestCount),T=this._missedDequeuedChunkRequest.calcDelta(this._efficiencyStats.missedDequeuedChunkRequestCount),y=this._sentSafeChunkRequest.calcDelta(this._efficiencyStats.safeChunkRequestCount),C=this._sentUnsafeChunkRequest.calcDelta(this._efficiencyStats.unsafeChunkRequestCount),D=this._timeoutSentSafeChunkRequest.calcDelta(this._efficiencyStats.safeChunkRequestTimeoutCount),A=this._timeoutSentUnsafeChunkRequest.calcDelta(this._efficiencyStats.unsafeChunkRequestTimeoutCount),w=this._getTimespanSinceLastPayload(),R=w>0?Math.round(S*this._conf.CHUNK_SIZE*8/w):0,P=w>0?Math.round((y+C)*this._conf.CHUNK_SIZE*8/w):0,b=this._gracedChunk.calcDelta(this._efficiencyStats.gracedChunksCount),k=this._expiredGraceChunk.calcDelta(this._efficiencyStats.expiredGraceChunksCount),I={receivedChunkRequestBitrate:R,sentChunkRequestBitrate:P,receivedChunkRequestsMissedRatio:g>0?(0,E.toDecimal)(T/g,2):0,sentSafeChunkRequests:y,sentUnsafeChunkRequests:C,sentSafeChunkRequestsTimeout:D,sentUnsafeChunkRequestsTimeout:A,uploadQueueExpirationRatio:S>0?(0,E.toDecimal)(1-g/S,2):0,gracedChunks:b,expiredGraceChunks:k},O=this._abortFragmentCount.calcDelta(this._mediaStats.abortFragmentCount),N=this._emergencyTrackSwitchCount.calcDelta(this._mediaStats.emergencyTrackSwitchCount),L={emergencyTrackSwitchCPM:N/(w/6e4)};this._qosAnalyticsHandler.initialized&&(L=(0,a.default)(L,this._qosAnalyticsHandler.getQoSAnalytics()));var M=this._moduleState.isAlwaysDvr&&this._moduleState.isLive();this._moduleState.resetIsAlwaysDvr();var U={transfers:m,efficiency:I,qos:L,peers:this._getPeerStats(),buffer:this._getBufferStats(),abr:this._getAbrStats(),live:this._moduleState.isLive(),signalingServerConnected:e,trackerConnected:t,trackerVersion:n,trackerId:r,sessionDuration:this._getSessionDuration(),timespan:w,options:{p2pDownloadAlwaysOn:this._optionsObserver.p2pDownloadAlwaysOn,p2pUploadAlwaysOn:this._optionsObserver.p2pUploadAlwaysOn},confLabel:this._conf.CONF_LABEL,qosTester:this._conf.QOS_P2P_DISABLED,mediaDuration:Math.round(this._mediaStats.duration),videoTrackCount:this._mediaStats.videoTrackCount,minBitrate:this._mediaStats.minBitrate,maxBitrate:this._mediaStats.maxBitrate,aggPlaybackErrorCount:this._mediaStats.playbackErrorCount,playbackErrorCount:this._playbackErrorCount.calcDelta(this._mediaStats.playbackErrorCount),abortFragmentCount:O,isAlwaysDvr:M,rampUpActivated:this._conf.RAMP_UP_ACTIVATED,mediaElementSet:this._mediaStats.mediaElementSet,mediaElementChanged:this._mediaStats.mediaElementChanged};return this._updateLastPayloadTimestamp(),this._optionsObserver.reset(),U}},{key:"_calculateControlPayload",value:function(){var e=this._missedIceCandidate.calcDelta(this._controlStats.missedIceCandidateCount),t=this._gatheredIceCandidate.calcDelta(this._controlStats.gatheredIceCandidateCount),n=this._iceCandidatesBucket.calcDelta(this._controlStats.iceCandidatesBucketCount),r=this._earlyIceGatheringFinished.calcDelta(this._controlStats.earlyIceGatheringFinishedCount),i=n>0?(0,E.toDecimal)(e/n,2):0,a=n>0?(0,E.toDecimal)(t/n,2):0,o=n>0?r/n:0,s=this._controlStats.getSampledIceGatheringDuration(),u=this._p2pSgtCheckSuccess.calcDelta(this._controlStats.nbRightHashP2P),l=this._p2pSgtCheckFail.calcDelta(this._controlStats.nbWrongHashP2P),c=this._hybridSgtCheckSuccess.calcDelta(this._controlStats.nbRightHashDLM),d=this._hybridSgtCheckFail.calcDelta(this._controlStats.nbWrongHashDLM),f=this._checkHeartbeatFailed.calcDelta(this._controlStats.checkHeartbeatFailed),h=this._getSegmentSuccess.calcDelta(this._controlStats.getSegmentSuccess),_=this._getSegmentFallback.calcDelta(this._controlStats.getSegmentFallback),p=this._sentOfferSdpVolume.calcDelta(this._controlStats.sentOfferSdpVolume),v=this._sentAnswerSdpVolume.calcDelta(this._controlStats.sentAnswerSdpVolume),m=this._sentIceCandidatesVolune.calcDelta(this._controlStats.sentIceCandidatesVolume),S=this._signalingMessageCount.calcDelta(this._controlStats.signalingMessagesCount),g=this._sentDistributorRootCount.calcDelta(this._controlStats.sentDistributorRootCount),T=this._sentTrackerInitCount.calcDelta(this._controlStats.sentTrackerInitCount),y=this._sentTrackerPeersCount.calcDelta(this._controlStats.sentTrackerPeersCount),C=this._sentTrackerTracksCount.calcDelta(this._controlStats.sentTrackerTracksCount),D={
live:this._moduleState.isLive(),meanMissedIceCandidate:i,meanGatheredIceCandidate:a,earlyIceCandidateGatheringRatio:o,sampledIceGatheringDuration:s,p2pSgtCheckSuccess:u,p2pSgtCheckFail:l,hybridSgtCheckSuccess:c,hybridSgtCheckFail:d,checkHeartbeatFailed:f,getSegmentSuccess:h,getSegmentFallback:_,sessionDuration:this._getSessionDuration(),timespan:this._getTimespanSinceLastPayload("control"),confLabel:this._conf.CONF_LABEL,sentOfferSdpVolume:p,sentAnswerSdpVolume:v,sentIceCandidatesVolume:m,signalingMessagesCount:S,sentDistributorRootCount:g,sentTrackerInitCount:T,sentTrackerPeersCount:y,sentTrackerTracksCount:C,rampUpActivated:this._conf.RAMP_UP_ACTIVATED,rangeRequestStatus:this._moduleState.rangeRequestStatus.status};return this._updateLastPayloadTimestamp("control"),D}},{key:"sendStats",value:function(){var e=this._calculateStatsPayload();e.timespan<2*this._conf.ANALYTICS.STATS_INTERVAL&&(this._analyticsClient.send(e),this._sharedState.lastStatPayloadTimestamp=Date.now())}},{key:"sendControl",value:function(){var e=this._calculateControlPayload();e.timespan<2*this._conf.ANALYTICS.CONTROL_INTERVAL&&this._analyticsClient.send(e,"control")}},{key:"dispose",value:function(){this._qosAnalyticsHandler.dispose()}}]),e}();t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(68),l=r(u),c=n(19),d=n(2),f=r(d),h=function(){function e(t){var n=this;(0,a.default)(this,e),this._sharedState=t,this._analyticsClient=new l.default(t,"traffic"),this._p2p=new c.Delta,this._cdn=new c.Delta,this._upload=new c.Delta,this._lastPayloadTimestamp=Date.now(),this._sharedState.eventBus.on(f.default.TrafficAnalytics.STOP_SENDING_USAGE,function(){n._disconnected=!0}),this._sharedState.eventBus.on(f.default.TrafficAnalytics.RESTART_SENDING_USAGE,function(){n._disconnected=!1})}return(0,s.default)(e,[{key:"_calculateUsagePayload",value:function(){var e=this._p2p.calcDelta(this._sharedState.transferStats.p2pUseful),t=this._cdn.calcDelta(this._sharedState.transferStats.cdnDownloaded),n=this._upload.calcDelta(this._sharedState.transferStats.p2pUploaded),r=this._getTimespanSinceLastPayload(),i={live:this._sharedState.moduleState.isLive(),cdn:t,p2p:e,upload:n,timespan:r};return this._updateLastPayloadTimestamp(),i}},{key:"_getTimespanSinceLastPayload",value:function(){return Date.now()-this._lastPayloadTimestamp}},{key:"_updateLastPayloadTimestamp",value:function(){this._lastPayloadTimestamp=Date.now()}},{key:"sendUsage",value:function(){if(!this._disconnected){var e=this._calculateUsagePayload();this._analyticsClient.send(e,"usage")}}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(19),l=n(25),c=function(){function e(){(0,a.default)(this,e),this._timeSpentPlayingDelta=new u.Delta,this._timeSpentPausedDelta=new u.Delta,this._timeSpentRebufferingDelta=new u.Delta,this._timeSpentRebufferingWithBufferDelta=new u.Delta,this._timeSpentSeekingDelta=new u.Delta,this._timeSpentEndedDelta=new u.Delta,this._rebufferingCountDelta=new u.Delta,this._rebufferingWithBufferCountDelta=new u.Delta,this._lastTimeDelta=new u.Delta(Date.now()),this._droppedFrameCountDelta=new u.Delta,this._trackSwitchCountDelta=new u.Delta}return(0,s.default)(e,[{key:"_normalizePerMinute",value:function(e,t,n,r){var i=this._lastTimeDelta.calcDelta(Date.now()),a=this._rebufferingCountDelta.calcDelta(e),o=a/(i/6e4),s=this._rebufferingWithBufferCountDelta.calcDelta(t),u=s/(i/6e4),c=this._droppedFrameCountDelta.calcDelta(n),d=c/(i/6e4),f=this._trackSwitchCountDelta.calcDelta(r),h=f/(i/6e4);return{rebufferingCPM:(0,l.toDecimal)(o,2),rebufferingWithBufferCPM:(0,l.toDecimal)(u,2),droppedFrameCPM:(0,l.toDecimal)(d,2),trackSwitchCPM:(0,l.toDecimal)(h,2)}}},{key:"format",value:function(e,t){e.droppedFrameCount<this._droppedFrameCountDelta.lastValue&&this._droppedFrameCountDelta.override(e.droppedFrameCount);var n=this._normalizePerMinute(e.rebufferingCount,e.rebufferingCountWithBuffer,e.droppedFrameCount,t);return{rebufferingCPM:n.rebufferingCPM,rebufferingWithBufferCPM:n.rebufferingWithBufferCPM,droppedFrameCPM:n.droppedFrameCPM,trackSwitchCPM:n.trackSwitchCPM,timeSpentPlaying:(0,l.toDecimal)(this._timeSpentPlayingDelta.calcDelta(e.timeSpentPlaying),2),timeSpentPaused:(0,l.toDecimal)(this._timeSpentPausedDelta.calcDelta(e.timeSpentPaused),2),timeSpentEnded:(0,l.toDecimal)(this._timeSpentEndedDelta.calcDelta(e.timeSpentEnded),2),timeSpentRebuffering:(0,l.toDecimal)(this._timeSpentRebufferingDelta.calcDelta(e.timeSpentRebuffering),2),timeSpentRebufferingWithBuffer:(0,l.toDecimal)(this._timeSpentRebufferingWithBufferDelta.calcDelta(e.timeSpentRebufferingWithBuffer),2),timeSpentSeeking:(0,l.toDecimal)(this._timeSpentSeekingDelta.calcDelta(e.timeSpentSeeking),2),startupTime:e.startupTime,endedOnce:e.endedOnce}}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(138),l=r(u),c=n(177),d=r(c),f=n(5),h=n(2),_=r(h),p=function(){function e(t,n){(0,a.default)(this,e),this._trackSwitchCount=-1,this._eventBus=n.eventBus,this._onTS=this._onTrackSwitch.bind(this),n.eventBus.on(_.default.Metrics.TRACK_SWITCH,this._onTS),null!==t.mediaElement&&(this._initialized=!0,this._qosAnalytics=new l.default(t.mediaElement,f.createInterval),this._qoSAnalyticsFormatter=new d.default)}return(0,s.default)(e,[{key:"_onTrackSwitch",value:function(){this._trackSwitchCount++}},{key:"getQoSAnalytics",value:function(){if(!this._initialized)throw new Error("getQoSAnalytics was called on non-initialized QoSAnalyticsHandler");var e=this._qosAnalytics.getQoSAnalytics();return this._qoSAnalyticsFormatter.format(e,this._trackSwitchCount)}},{key:"dispose",value:function(){this._qosAnalytics&&this._qosAnalytics.dispose(),this._eventBus.removeListener(_.default.Metrics.TRACK_SWITCH,this._onTS)}},{key:"initialized",get:function(){return this._initialized}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(95),d=r(c),f=function(){function e(){(0,s.default)(this,e),this._scriptOrigin=null,this._metadata={}}return(0,l.default)(e,[{key:"_onErrorListener",value:function(e){e.filename&&e.filename===this._scriptOrigin&&this.notifyError(new d.default(e))}},{key:"notify",value:function(e,t){throw arguments.length>2&&void 0!==arguments[2]&&arguments[2],new Error("AbstractError#notify should be implemented")}},{key:"notifyError",value:function(e,t){throw new Error("AbstractError#notifyError should be implemented")}},{key:"_getAppVersion",value:function(){return"4.12.0".split("-")[0]}},{key:"setMetadata",value:function(e){(0,a.default)(this._metadata,e)}},{key:"setScriptOrigin",value:function(e){this._scriptOrigin=e}},{key:"setCustomer",value:function(e){}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(43),h=r(f),_=n(7),p=r(_),v=n(179),E=r(v),m=n(181),S=r(m),g=n(94),T=r(g),y=n(95),C=(r(y),function(e){function t(){(0,s.default)(this,t);var e=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return window.addEventListener("error",e._onErrorListener.bind(e)),S.default.apiKey=T.default.ERRORS.API_KEY,S.default.notifyHandler=T.default.ERRORS.HANDLER,S.default.notifyReleaseStages=T.default.ERRORS.STAGES,S.default.disableLog=!0,S.default.releaseStage="production",S.default.autoNotify=!1,S.default.appVersion=e._getAppVersion(),e}return(0,p.default)(t,e),(0,l.default)(t,[{key:"notify",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"warning",r=n;r.match(/^(warning|info|error)$/)||(r="warning"),S.default.notify(e,t,this._metadata,r)}},{key:"notifyError",value:function(e,t){S.default.notifyException(e,{groupingHash:t||e.message})}},{key:"setMetadata",value:function(e){(0,h.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"setMetadata",this).call(this,e),S.default.metaData=this._metadata}},{key:"setCustomer",value:function(e){S.default.userId=e}}]),t}(E.default));t.default=new C,e.exports=t.default},function(e,t,n){"use strict";var r,i,a=n(26),o=function(e){return e&&e.__esModule?e:{default:e}}(a);!function(n){function a(){R=!1}function s(){var e=document.currentScript||y;if(!e&&R){var t=document.scripts||document.getElementsByTagName("script");e=t[t.length-1]}return e}function u(e){var t=s();t&&(e.script={src:t.src,content:_("inlineScript",!0)?t.innerHTML:""})}function l(e){var t=_("disableLog"),n=window.console;void 0===n||void 0===n.log||t||n.log("[Bugsnag] "+e)}function c(e,t,n){if(n>=_("maxDepth",w))return encodeURIComponent(t)+"=[RECURSIVE]";n=n+1||1;try{if(window.Node&&e instanceof window.Node)return encodeURIComponent(t)+"="+encodeURIComponent(g(e));var r=[];for(var i in e)if(e.hasOwnProperty(i)&&null!=i&&null!=e[i]){var a=t?t+"["+i+"]":i,s=e[i];r.push("object"===(void 0===s?"undefined":(0,o.default)(s))?c(s,a,n):encodeURIComponent(a)+"="+encodeURIComponent(s))}return r.join("&")}catch(e){return encodeURIComponent(t)+"="+encodeURIComponent(""+e)}}function d(e,t,n){if(null==t)return e;if(n>=_("maxDepth",w))return"[RECURSIVE]";e=e||{};for(var r in t)if(t.hasOwnProperty(r))try{t[r].constructor===Object?e[r]=d(e[r],t[r],n+1||1):e[r]=t[r]}catch(n){e[r]=t[r]}return e}function f(e,t){if(e+="?"+c(t)+"&ct=img&cb="+(new Date).getTime(),"undefined"!=typeof BUGSNAG_TESTING&&D.testRequest)D.testRequest(e,t);else if("xhr"===_("notifyHandler")){var n=new XMLHttpRequest;n.open("GET",e,!0),n.send()}else(new Image).src=e}function h(e){var t={},n=/^data\-([\w\-]+)$/;if(e)for(var r=e.attributes,i=0;i<r.length;i++){var a=r[i];if(n.test(a.nodeName)){var o=a.nodeName.match(n)[1];t[o]=a.value||a.nodeValue}}return t}function _(e,t){P=P||h(L);var n=void 0!==D[e]?D[e]:P[e.toLowerCase()];return"false"===n&&(n=!1),void 0!==n?n:t}function p(e){return!(!e||!e.match(b))||(l("Invalid API key '"+e+"'"),!1)}function v(e,t){var n=_("apiKey");if(p(n)&&A){A-=1;var r=_("releaseStage","production"),i=_("notifyReleaseStages");if(i){for(var a=!1,o=0;o<i.length;o++)if(r===i[o]){a=!0;break}if(!a)return}var s=[e.name,e.message,e.stacktrace].join("|");if(s!==C){C=s,T&&(t=t||{},t["Last Event"]=S(T));var u={notifierVersion:O,apiKey:n,projectRoot:_("projectRoot")||window.location.protocol+"//"+window.location.host,context:_("context")||window.location.pathname,userId:_("userId"),user:_("user"),metaData:d(d({},_("metaData")),t),releaseStage:r,appVersion:_("appVersion"),url:window.location.href,userAgent:navigator.userAgent,language:navigator.language||navigator.userLanguage,severity:e.severity,name:e.name,message:e.message,stacktrace:e.stacktrace,file:e.file,lineNumber:e.lineNumber,columnNumber:e.columnNumber,payloadVersion:"2"},c=D.beforeNotify;if("function"==typeof c&&!1===c(u,u.metaData))return;if(0===u.lineNumber&&/Script error\.?/.test(u.message))return l("Ignoring cross-domain script error. See https://bugsnag.com/docs/notifiers/js/cors");f(_("endpoint")||I,u)}}}function E(){var e,t;try{throw new Error("")}catch(n){e="<generated>\n",t=m(n)}if(!t){e="<generated-ie>\n";var n=[];try{for(var r=arguments.callee.caller.caller;r&&n.length<10;){var i=k.test(r.toString())?RegExp.$1||"[anonymous]":"[anonymous]";n.push(i),r=r.caller}}catch(e){l(e)}t=n.join("\n")}return e+t}function m(e){return e.stack||e.backtrace||e.stacktrace}function S(e){return{millisecondsAgo:new Date-e.timeStamp,type:e.type,which:e.which,target:g(e.target)}}function g(e){if(e){var t=e.attributes;if(t){for(var n="<"+e.nodeName.toLowerCase(),r=0;r<t.length;r++)t[r].value&&"null"!==t[r].value.toString()&&(n+=" "+t[r].name+'="'+t[r].value+'"');return n+">"}return e.nodeName}}var T,y,C,D={},A=10,w=5;D.noConflict=function(){return window.Bugsnag=n,void 0===n&&delete window.Bugsnag,D},D.refresh=function(){A=10},D.notifyException=function(e,t,n,r){e&&(t&&"string"!=typeof t&&(n=t,t=void 0),n||(n={}),u(n),v({name:t||e.name,message:e.message||e.description,stacktrace:m(e)||E(),file:e.fileName||e.sourceURL,lineNumber:e.lineNumber||e.line,columnNumber:e.columnNumber?e.columnNumber+1:void 0,severity:r||"warning"},n))},D.notify=function(e,t,n,r){v({name:e,message:t,stacktrace:E(),file:window.location.toString(),lineNumber:1,severity:r||"warning"},n)};var R="complete"!==document.readyState;document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!0),window.addEventListener("load",a,!0)):window.attachEvent("onload",a);var P,b=/^[0-9a-f]{32}$/i,k=/function\s*([\w\-$]+)?\s*\(/i,I="https://notify.bugsnag.com/js",O="2.5.0",N=document.getElementsByTagName("script"),L=N[N.length-1];if(window.atob&&window.ErrorEvent)try{0===new window.ErrorEvent("test").colno&&!1}catch(e){}window.Bugsnag=D,r=[],void 0!==(i=function(){return D}.apply(t,r))&&(e.exports=i)}(window.Bugsnag)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(118),a=r(i),o=n(42),s=r(o),u=n(6),l=r(u),c=n(0),d=r(c),f=n(1),h=r(f),_=n(8),p=r(_),v=n(7),E=r(v),m=n(96),S=r(m),g=n(5),T=n(97),y=r(T),C=n(183),D=r(C),A=function(e){function t(e,n,r){(0,d.default)(this,t);var i=(0,p.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e,n,r));return i._init(),i}return(0,E.default)(t,e),(0,h.default)(t,[{key:"_init",value:function(){this._xhr=new XMLHttpRequest,this._xhr.open(this._method,this._url,!0),this._xhr.responseType=this._options.responseType,this._xhr.withCredentials=this._options.withCredentials;for(var e=(0,s.default)(this._options.headers),t=0,n=e.length;t<n;t++){var r=e[t];this._xhr.setRequestHeader(r,this._options.headers[r])}this._aborted=!1}},{key:"abort",value:function(){this._aborted=!0,this._xhr.abort()}},{key:"_send",value:function(e){var n=this;return new a.default(function(r,i){n._aborted?i(new y.default(t.Errors.REQUEST_ABORTED)):n._options.timeout&&(n._retryTimer=(0,g.createTimeout)(function(){n.abort(),i(new y.default(t.Errors.REQUEST_TIMEOUT))},n._options.timeout)),n._xhr.onloadend=function(){n._aborted?i(new y.default(t.Errors.REQUEST_ABORTED)):n._xhr.readyState===t.ReadyStates.DONE?n._options.validStatusCodes.indexOf(n._xhr.status)>-1?r(n._xhr.response):i(new y.default(t.Errors.INVALID_STATUS,n._xhr.status)):i(new y.default(t.Errors.REQUEST_ERROR))},n._xhr.onprogress=function(e){var t=new D.default(e.lengthComputable,e.loaded,e.total);n._options.events.onprogress(t)},n._xhr.onerror=function(){i(new y.default(t.Errors.REQUEST_ERROR))},n._xhr.send(e)})}}]),t}(S.default);t.default=A,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t,n,r){(0,a.default)(this,e),this._lengthComputable=t,this._loaded=n,this._total=r}return(0,s.default)(e,[{key:"lengthComputable",get:function(){return this._lengthComputable}},{key:"loaded",get:function(){return this._loaded}},{key:"total",get:function(){return this._total}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(185),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(e){var t=[],n=e,r=function(){for(var e=-1,r=Date.now(),i=0;i<t.length&&r-t[i].timestamp()>n;i++)e=i;return e},a=function(){var e=r();e>-1&&t.splice(0,e+1)},o=function(e){a();var n=new i.default(e);t.push(n)},s=function(){if(a(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e/t.length},u=function(){if(a(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e};this.addPoint=o,this.compute=s,this.computeSum=u};t.default=a,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){var t=e,n=Date.now();this.timestamp=function(){return n},this.value=function(){return t}};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){if(n.USE_COMBINED_ABR_FEEDBACK){var r=e.cdnDownloaded+e.p2pDownloaded,i=e.cdnDownloaded/r,a=void 0;if(i<n.ABR_SEGMENT_CDN_RATIO_THRESHOLD||e.cdnDownloaded<n.ABR_CDN_DL_THRESHOLD){var o=void 0;if(null!==t.cdnTimestamp){var s=Date.now()-t.cdnTimestamp,u=Math.max(0,1-s/n.ABR_CDN_DL_DECAY_TIME);o=(1-u)*t.p2pSpeed+u*t.cdnSpeed}else o=t.p2pSpeed;a=8*r/o}else a=8*e.cdnDownloaded/t.cdnSpeed/i;e.p2pDuration=(1-i)*a,e.cdnDuration=i*a}else t.p2pSpeed>0?e.p2pDuration=8*e.p2pDownloaded/t.p2pSpeed:e.p2pDuration=0,null!==t.cdnSpeed?e.cdnDuration=8*e.cdnDownloaded/t.cdnSpeed:e.cdnDuration=0},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),a=r(i),o=n(10),s=r(o),u=n(6),l=r(u),c=n(0),d=r(c),f=n(1),h=r(f),_=n(8),p=r(_),v=n(7),E=r(v),m=n(110),S=r(m),g=n(2),T=r(g),y=n(4),C=r(y),D=n(5),A=function(e){function t(e,n){(0,d.default)(this,t);var r=[],i=(0,p.default)(this,(t.__proto__||(0,l.default)(t)).call(this,r));return i._peerIds=r,i._peerConnector=e,i._sharedState=n,i._onTS=i._onTrackSwitch.bind(i),i._sharedState.eventBus.on(T.default.Metrics.TRACK_SWITCH,i._onTS),i}return(0,E.default)(t,e),(0,h.default)(t,[{key:"dispose",value:function(){this._tryDequeueTimer&&this._tryDequeueTimer.clear(),this._sharedState.eventBus.removeListener(T.default.Metrics.TRACK_SWITCH,this._onTS)}},{key:"flush",value:function(){this._sharedState.peerStats.excessMatch+=this._peerIds.length,this._peerIds.length=0}},{key:"onPeersFromTracker",value:function(e,t){if(null!==e)return void C.default.notify("Error asking peers from tracker:",e.message);var n=[],r=!0,i=!1,o=void 0;try{for(var u,l=(0,s.default)(t);!(r=(u=l.next()).done);r=!0){var c=u.value,d=c.peers;n.push.apply(n,(0,a.default)(d))}}catch(e){i=!0,o=e}finally{try{!r&&l.return&&l.return()}finally{if(i)throw o}}if(!(n.length<1)){this.flush(),this._sharedState.peerStats.match+=n.length;var f=!0,h=!1,_=void 0;try{for(var p,v=(0,s.default)(n);!(f=(p=v.next()).done);f=!0){var E=p.value;this.push(E)}}catch(e){h=!0,_=e}finally{try{!f&&v.return&&v.return()}finally{if(h)throw _}}void 0===this._tryDequeueTimer&&this._createTryDequeueTimer()}}},{key:"_onTrackSwitch",value:function(e){e.isVideo&&this.flush()}},{key:"_createTryDequeueTimer",value:function(){this._tryDequeueTimer=(0,D.createInterval)(this._onTryDequeueTimer.bind(this),this._sharedState.conf.CANDIDATE_PEERS_TRY_DEQUEUE_INTERVAL)}},{key:"_onTryDequeueTimer",value:function(){var e=Math.min(this._peerIds.length,this._peerConnector.getOpenConnectorSlotsCount());e>0&&this.tryDequeueN(e)}},{key:"_canDequeue",value:function(){return this._peerIds.length>0&&this._peerConnector.getOpenConnectorSlotsCount()>this._sharedState.conf.RESERVED_OFFER_SLOTS}},{key:"_dequeuedCallback",value:function(e){this._peerConnector.createPeerConnection(e)}}]),t}(S.default);t.default=A,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=r(u),c=n(194),d=r(c),f=n(100),h=r(f),_=n(2),p=r(_),v=n(109),E=r(v),m={PENDING:"pending",DOWNLOADING:"downloading",DOWNLOADED:"downloaded",CDN_DOWNLOADED:"CDNdownloaded",FAILED:"failed"},S=function(){function e(t,n,r,i,o){(0,a.default)(this,e),this._sharedState=o,this._conf=o.conf,this._transferStats=o.transferStats,this._efficiencyStats=o.efficiencyStats,this._controlStats=o.controlStats,this._workerHelper=o.workerHelper,this._p2pCache=n,this._dataLocked=!1,this._downloadStatus=[],this._writeLock=!1,this._isEmpty=!0,this._partialSegmentRequested=!1,this._broadcastedSegmentInfoCalled=!1,this._segmentCoord=t,this._peerPool=r,this._segmentInfoMap=i,this._ee=new l.default}return(0,s.default)(e,[{key:"getEE",value:function(){return this._ee}},{key:"_initChunkStatus",value:function(e){var t=Math.ceil(e/this._conf.CHUNK_SIZE);E.default.clear(this._downloadStatus);for(var n=0;n<t;n++)this._downloadStatus.push(m.PENDING)}},{key:"setSegmentSize",value:function(e){this.size||(this.size=e,this.segment=new h.default(e,this._segmentCoord,this._sharedState.eventBus),this._initChunkStatus(e))}},{key:"getNumberOfChunks",value:function(){return this._downloadStatus.length}},{key:"getChunk",value:function(e,t){if(!this._dataLocked&&this._isChunkP2POrCDNDownloaded(e)){var n=this._conf.CHUNK_SIZE,r=e*this._conf.CHUNK_SIZE;r+n>this.size&&(n=this.size-r),this.segment.getBinaryData(r,n,t)}else this._dataLocked,t(null)}},{key:"_getConsecutiveChunksCount",value:function(e,t,n){for(var r=1,i=1===t?0:e.length-1,a=1===t?e.length-1:0,o=i;o!==a;o+=t){var s=o+t;if(s>=0&&s<=e.length-1){if(1!==Math.abs(e[o]-e[s])||r===n)break;r++}}return r}},{key:"_getRemainingChunks",value:function(){for(var e=[],t=0,n=this._downloadStatus.length;t<n;t++)this._downloadStatus[t]!==m.FAILED&&this._downloadStatus[t]!==m.PENDING||e.push(t);return e}},{key:"_encodePartialBatchStr",value:function(e,t){var n=e;return e&&(n+=","),n+=""+t[0],t.length>1&&(n+="-"+t[t.length-1]),n}},{key:"getNextChunks",value:function(e,t){for(var n="",r=t,i=this._getRemainingChunks();i.length>0&&r>0;){var a=i[0],o=i[i.length-1],s=void 0,u=void 0;if(this._downloadStatus.length-1-o===a){var l=this._getConsecutiveChunksCount(i,1,r),c=this._getConsecutiveChunksCount(i,-1,r);u=Math.max(l,c),s=u===l?1:-1}else s=this._downloadStatus.length-1-o>a?1:-1,u=this._getConsecutiveChunksCount(i,s,r);var d=1===s?0:i.length-u,f=i.splice(d,u);f=1===s?f:f.reverse(),n=this._encodePartialBatchStr(n,f),r-=f.length;for(var h=0,_=f.length;h<_;h++)this._downloadStatus[f[h]]=m.DOWNLOADING}return{encoded:n,size:t-r}}},{key:"chunkDownloaded",value:function(e,t){if(!this.segment||t>=this._downloadStatus.length)return void(this._transferStats.multipleDlM+=e.byteLength);if(this._isEmpty=!1,this._isChunkP2POrCDNDownloaded(t)||this._writeLock){var n=this._downloadStatus[t];n===m.DOWNLOADED?this._transferStats.multipleDlPP+=e.byteLength:(n===m.CDN_DOWNLOADED||this._writeLock)&&(this._transferStats.multipleDlCP+=e.byteLength)}else if(this._downloadStatus[t]=m.DOWNLOADED,this.segment.setBinaryData(e,t*this._conf.CHUNK_SIZE),(this._sharedState.moduleState.isLive()&&this._conf.ALLOW_LIVE_PUSH_SEGMENT||!this._sharedState.moduleState.isLive()&&this._conf.ALLOW_VOD_PUSH_SEGMENT)&&this._broadcastSegmentInfo(),this.isSegmentDownloaded()){var r=this._p2pCache.getSegmentHandler(this._segmentCoord);r&&r.seeders.clear(),this.lockSegmentData(),this._checkHashP2P(this.segment)}this._sharedState.eventBus.emit(p.default.ChunkManager.CHUNK_DOWNLOADED)}},{key:"timeout",value:function(e){this._downloadStatus[e]===m.DOWNLOADING&&(this._downloadStatus[e]=m.FAILED)}},{key:"isSegmentDownloaded",value:function(){var e=this;return!!this.size&&this._downloadStatus.every(function(t,n){return e._isChunkP2POrCDNDownloaded(n)})}},{key:"shouldDownloadSegment",value:function(){return!this.isSegmentDownloaded()&&!this.partialSegment&&!this._partialSegmentRequested}},{key:"getPartialSegment",value:function(){var e=this;return this._partialSegmentRequested=!0,!(this._isEmpty||!this.size)&&(function(){e.partialSegment||e._dataLocked||(e.partialSegment=new d.default(e._segmentCoord,e._p2pCache,e.segment,e._downloadStatus,e.size,e,e.isSegmentDownloaded(),e._segmentInfoMap,e._sharedState))}(),this._dataLocked||(this._writeLock=!0),this.partialSegment)}},{key:"getPercentageOfChunksDownloaded",value:function(){var e=this;return this._downloadStatus.reduce(function(t,n,r){return t+(e._isChunkP2POrCDNDownloaded(r)?1/e.getNumberOfChunks()*100:0)},0)}},{key:"storeSegment",value:function(e){this._isEmpty=!1,this.segment=e,this.size||(this._initChunkStatus(e.byteLength),this.size=e.byteLength),this._updateDownloadStatus(),this._transferStats.p2pUseful+=this.getP2PAndCDNDownloads().p2pDownloaded}},{key:"_broadcastSegmentInfo",value:function(){var e=this.getPercentageOfChunksDownloaded();!this._broadcastedSegmentInfoCalled&&e>=this._conf.MIN_CHUNK_PERCENTAGE_DOWNLOADED_FOR_HAS_SEGMENT_ANSWER&&(this._broadcastedSegmentInfoCalled=!0,this._peerPool.broadcastSegmentInfo(this._segmentCoord))}},{key:"_updateDownloadStatus",value:function(){var e=void 0;e={start:0,end:this.getNumberOfChunks()},this.partialSegment&&this.partialSegment.getCDNIndexRange()&&(e=this.partialSegment.getCDNIndexRange());for(var t=e.start;t<e.end;t++){if(this._isChunkP2POrCDNDownloaded(t)){var n=this._conf.CHUNK_SIZE;t===this.getNumberOfChunks()-1&&(n=this.size-(this.getNumberOfChunks()-1)*this._conf.CHUNK_SIZE),this._downloadStatus[t]===m.DOWNLOADED?this._transferStats.multipleDlPC+=n:this._downloadStatus[t]===m.CDN_DOWNLOADED&&(this._transferStats.multipleDlCC+=n)}this._downloadStatus[t]=m.CDN_DOWNLOADED}}},{key:"getP2PAndCDNDownloads",value:function(){var e=0,t=0,n=this.getNumberOfChunks()-1;if(this.size)for(var r=0;r<this._downloadStatus.length;r++){var i=void 0,a=this._downloadStatus[r];i=r<n?this._conf.CHUNK_SIZE:this.size-n*this._conf.CHUNK_SIZE,a===m.DOWNLOADED?e+=i:a===m.CDN_DOWNLOADED&&(t+=i)}return{p2pDownloaded:e,cdnDownloaded:t}}},{key:"lockSegmentData",value:function(){this._dataLocked=!0}},{key:"unlockSegmentData",value:function(){this._dataLocked=!1}},{key:"removePartialSegment",value:function(){delete this.partialSegment}},{key:"_checkHashP2P",value:function(e){var t=this,n=this._segmentInfoMap.getSegmentInfo(this._segmentCoord),r=function(e,r){n.hash===r?(t._controlStats.nbRightHashP2P++,t.segment.setBinaryData(e),t.segment.setComplete(),t._transferStats.p2pUseful+=t.size,t.unlockSegmentData()):(t._controlStats.nbWrongHashP2P++,t._p2pCache.removeSegmentHandler(n.segmentCoord),t._transferStats.multipleDlHP+=t.size)};e.getBinaryData(0,e.byteLength,function(e){t._workerHelper.callHashWorker(e,r)})}},{key:"_isChunkP2POrCDNDownloaded",value:function(e){var t=this._downloadStatus[e];return t===m.DOWNLOADED||t===m.CDN_DOWNLOADED}},{key:"dispose",value:function(){this.segment&&this.segment.destroy()}},{key:"hasChunksToDownload",get:function(){return this._downloadStatus.indexOf(m.FAILED)>=0||this._downloadStatus.indexOf(m.PENDING)>=0}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(98),p=r(_),v=n(5),E=n(55),m=r(E),S=n(4),g=r(S),T=function(e){function t(e,n,r,i,o,u){(0,s.default)(this,t);var l=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,u));l._chunkManager=o,l._peer=r,l._sharedState=i;var c=i.moduleState.isLive()?i.conf.LIVE.CHUNK_TIMEOUT:i.conf.CHUNK_TIMEOUT;return l._timeoutTimer=(0,v.createTimeout)(function(){l._chunkTimedOut()},c),l._timedOut=!1,l}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isEqual",value:function(e){return this.id===e.id}},{key:"_chunkTimedOut",value:function(){this._timedOut=!0,this._chunkManager.timeout(this._chunkIndex,this._bandwidthSafety),this._bandwidthSafety===m.default.SAFE?(this._sharedState.efficiencyStats.safeChunkRequestCount++,this._sharedState.efficiencyStats.safeChunkRequestTimeoutCount++):this._bandwidthSafety===m.default.UNSAFE&&(this._sharedState.efficiencyStats.unsafeChunkRequestCount++,this._sharedState.efficiencyStats.unsafeChunkRequestTimeoutCount++),this._peer.timeoutChunk(this)}},{key:"dataDownloaded",value:function(e){this._chunkManager.chunkDownloaded(e,this._chunkIndex),this._timedOut||(this._bandwidthSafety===m.default.SAFE?this._sharedState.efficiencyStats.safeChunkRequestCount++:this._bandwidthSafety===m.default.UNSAFE&&this._sharedState.efficiencyStats.unsafeChunkRequestCount++,this._timeoutTimer?this._timeoutTimer.clear():g.default.notifyError(new Error("clear() call on undefined DownloadChunkRequest.timeoutTimer.")))}},{key:"id",get:function(){return t.getIdOf(this._segmentCoord,this._chunkIndex)}},{key:"timestamp",get:function(){return this._timestamp}}],[{key:"getIdOf",value:function(e,t){return e.viewToString()+"C"+t}}]),t}(p.default);t.default=T,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),a=r(i),o=n(34),s=r(o),u=n(57),l=r(u),c=n(10),d=r(c),f=n(15),h=r(f),_=n(0),p=r(_),v=n(1),E=r(v),m=function(){function e(t,n,r){(0,p.default)(this,e),this._peerPool=t,this._peerConnector=n,this._secondOrderExclusions=new h.default,this._sharedState=r}return(0,E.default)(e,[{key:"addSecondOrderExclusion",value:function(e,t,n,r){this._secondOrderExclusions.set(e,{rank:t,releaseTimestamp:Date.now()+n,tag:r})}},{key:"_clearExpiredExclusions",value:function(){var e=Date.now(),t=!0,n=!1,r=void 0;try{for(var i,a=(0,d.default)(this._secondOrderExclusions.entries());!(t=(i=a.next()).done);t=!0){var o=(0,l.default)(i.value,2),s=o[0];o[1].releaseTimestamp<=e&&this._secondOrderExclusions.delete(s)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"exclusionList",get:function(){this._clearExpiredExclusions();var e=this._peerConnector.getPendingConnectionPeers(),t=!0,n=!1,r=void 0;try{for(var i,o=(0,d.default)(this._peerPool.getPeerArray());!(t=(i=o.next()).done);t=!0){var u=i.value;e.push(u.getId())}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}var c=this._sharedState.conf.MAX_TRACKER_EXCLUSION_LENGTH-e.length;if(c>=this._secondOrderExclusions.size)return[].concat((0,s.default)(e),(0,s.default)(this._secondOrderExclusions.keys()));var f=Date.now(),h=(0,a.default)(this._secondOrderExclusions.entries());h.sort(function(e,t){var n=(0,l.default)(e,2),r=(n[0],n[1]),i=(0,l.default)(t,2),a=(i[0],i[1]);return(a.releaseTimestamp-f)*a.rank-(r.releaseTimestamp-f)*r.rank});var _=h.map(function(e){var t=(0,l.default)(e,2),n=t[0];return t[1],n});return[].concat((0,s.default)(e),(0,s.default)(_.slice(0,c)))}},{key:"secondOrderExclusions",get:function(){return this._clearExpiredExclusions(),this._secondOrderExclusions}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";e.exports={TRACK_CHANGE_EVENT:"onTrackChange",EMERGENCY_FRAG_LOAD_ABORT:"onEmergencyFragLoadAborted"}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(71),d=n(38),f=n(4),h=r(f),_=n(66),p=r(_),v=function(){function e(t,n){(0,s.default)(this,e),this._mediaMap=t,this._sharedState=n,this._cachedSegmentList=new a.default,this._cachedSegmentTime=new a.default}return(0,l.default)(e,[{key:"getSegmentListAfterEdge",value:function(e,t,n){var r=t.viewToString(),i=this._cachedSegmentList.get(e.viewToString());if(i&&i.edgeString===r&&i.duration===n)return i.cachedSegmentList;var a=this.getSegmentTime(t),o=void 0;return null===a?(h.default.notifyError(new Error("Unexpected getSegmentTime error: track edge timestamp is not supposed to be unreliable")),o=[]):o=this._mediaMap.getSegmentList(e,a,n),(this._sharedState.conf.ENABLE_PREBUFFER_FEEDBACK||this._sharedState.conf.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME)&&(o=this._filterGreaterThanTrackEdge(o,t)),this._cachedSegmentList.set(e.viewToString(),{edgeString:r,cachedSegmentList:o,duration:n}),o}},{key:"_filterGreaterThanTrackEdge",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].getId()>t.getId())return e.slice(n);return[]}},{key:"getSegmentTime",value:function(e){if(e.fromPeer&&this._sharedState.moduleState.streamType===d.StreamTypes.HLS&&this._sharedState.conf.ENABLE_FIX_UNRELIABLE_SEGMENT_TIME)return null;var t=this._cachedSegmentTime.get(e.viewToString());if(void 0!==t)return t;
var n=this._mediaMap.getSegmentTime(e);if(this._cachedSegmentTime.set(e.viewToString(),n),this._cachedSegmentTime.size>this._sharedState.conf.GETSEGMENTTIME_CACHE_MAX_SIZE){var r=this._cachedSegmentTime.keys(),i=r.next().value,a=(0,c.unwrap)(i);this._cachedSegmentTime.delete(a)}return n}},{key:"dispose",value:function(){this._mediaMap=new p.default}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(65),l=(r(u),n(197)),c=r(l),d=n(239),f=function(){function e(t,n,r){(0,a.default)(this,e),this._peerAgentDisposed=!1,this._isNearEdge=!0,this.isAlwaysDvr=!1,this.currentTracks=new d.CurrentTracks(t.eventBus),this._playerInterface=n,this._streamType=r,this.nextSegmentPrebuffered={video:!1,audio:!1},this.rangeRequestStatus=new c.default(t)}return(0,s.default)(e,[{key:"isLive",value:function(){return this._playerInterface.isLive()}},{key:"resetIsAlwaysDvr",value:function(){this.isAlwaysDvr=this.isLive()&&!this._isNearEdge}},{key:"dispose",value:function(){this._peerAgentDisposed=!0}},{key:"peerAgentDisposed",get:function(){return this._peerAgentDisposed}},{key:"isNearEdge",get:function(){return this._isNearEdge},set:function(e){this._isNearEdge!==e&&(this._isNearEdge=e,this.isAlwaysDvr=!1)}},{key:"streamType",get:function(){return this._streamType}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(264),a=r(i),o=n(6),s=r(o),u=n(0),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(4),p=r(_),v=n(69),E=r(v),m=function(e){function t(e,n,r,i,o,u,c,f,h){function _(e,t,r,i){function a(a,o){t.hash===o?(U.nbRightHashDLM++,e.response=a,v(e),r(e,N)):(U.nbWrongHashDLM++,M.multipleDlHD+=j,M.multipleDlHP+=x,n.removeSegmentHandler(N),i(e,N))}R.callHashWorker(e.response,a)}function v(e){H=e.response,n.fillSegment(N,e.response),u.unlockSegmentData(),u.removePartialSegment()}function E(){O?x=o:(x=B.start*D.CHUNK_SIZE,B.end<G.length&&(x+=(G.length-B.end-1)*D.CHUNK_SIZE,x+=o-(G.length-1)*D.CHUNK_SIZE))}function m(){for(var e=0;e<G.length;e++)if("downloaded"!==G[e]&&"CDNdownloaded"!==G[e])return e}function S(){for(var e=G.length-1;e>=0;e--)if("downloaded"!==G[e]&&"CDNdownloaded"!==G[e])return e+1}function g(){B=h.conf.ENABLE_RANGE_REQUEST_DETECTION&&k.rangeRequestStatus.canDoRR||h.conf.RANGE_REQUEST_DETECTION?{start:m(),end:S()}:{start:0,end:G.length}}function T(e){if(h.conf.ENABLE_RANGE_REQUEST_DETECTION){if(!k.rangeRequestStatus.canDoRR)return e}else if(!h.conf.RANGE_REQUEST_DETECTION)return e;var t=void 0;if(void 0===B.start||void 0===B.end)throw new Error("PartialSegmentP2P: getUpdatedRange called with complete segment");var n=e?e.start+B.start*D.CHUNK_SIZE:B.start*D.CHUNK_SIZE;return B.end===G.length&&e?t=e.end:B.end<G.length&&(t=e?e.start+B.end*D.CHUNK_SIZE-1:B.end*D.CHUNK_SIZE-1),{start:n,end:t}}function y(e){if(void 0===B)throw new Error("assertion: _cdnIndexRange is not defined");if(void 0===H)throw new Error("assertion: _segmentData is not defined");try{H.setBinaryData(e,B.start*D.CHUNK_SIZE)}catch(e){throw p.default.notifyError(e),new Error("Invalid configuration: The current stream has no range request enabled and the p2p configuration has range request set to true.")}return H}function C(e){h.transferStats.cdnDownloaded+=e.byteLength}(0,l.default)(this,t);var D=h.conf,A=h.status,w=h.eventBus,R=h.workerHelper,P=h.controlStats,b=h.transferStats,k=h.moduleState,I=(0,d.default)(this,(t.__proto__||(0,s.default)(t)).call(this)),O=c,N=e,L=f,M=b,U=P,B=void 0,x=void 0,F=void 0,H=void 0,G=void 0,j=0;return I.getFullSegment=function(e,t,n){if(this.isComplete())H.getBinaryData(0,H.byteLength,function(n){e.response=n,u.removePartialSegment(),t(e,null)});else{w.emit("CDNSegmentDownloaded",N);var r=e.response;C(r),j=r.byteLength,y(r).getBinaryData(0,H.byteLength,function(r){if(e.response=r,0!==x){u.lockSegmentData();var i=L.getSegmentInfo(N);_(e,i,t,n)}else v(e),t(e,N)})}},I.getUpdatedRange=T,I.getCDNIndexRange=function(){return B},I.isComplete=function(){return O},I.isLocked=function(){return u.dataLocked},function(){if(H=r,!i.length)throw new Error("PartialSegmentP2P should not be instantiated with an empty segment");G=i.slice(),g(),E(),F=A.getMeanInstantSpeed()}(),(0,a.default)(I,{p2pSpeed:{get:function(){return F},set:void 0},p2pAmount:{get:function(){return x},set:void 0},byteLength:{get:function(){return o},set:void 0}}),I}return(0,h.default)(t,e),t}(E.default);t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=r(i),o=n(33),s=r(o),u=n(15),l=r(u),c=n(5),d=n(108),f=r(d),h=n(244),_=r(h),p=n(19),v=n(70),E=n(215),m=r(E),S=n(196),g=r(S),T=n(2),y=r(T),C=n(189),D=r(C),A=n(243),w=r(A),R=n(55),P=r(R),b=n(39),k=r(b),I=n(72),O=r(I),N=n(253),L=r(N),M=n(4),U=r(M),B=n(250),x=r(B),F=function(e,t,n,r,i){var o=r,u=r.conf,d=r.peerStats,h=new p.Delta,E=new p.Delta,S=new p.Delta,T=new p.Delta(Date.now()),C=r.eventBus,A=e,R=d,b=new _.default(n,r),I=this,N=k.default.fromHalfLife(0,u.PEER_UPLOAD_SPEED_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL),M=k.default.fromHalfLife(0,u.PEER_DOWNLOAD_SPEED_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL),B=Math.max(u.BLOCK_SEEDER_SCHEDULING_WINDOW,u.PEER_TIMEOUT_RATIO_WINDOW),F=new O.default(B),H=new O.default(B),G=Date.now(),j=new x.default,V=new L.default,W=0,K=0,q=!1,Y=void 0,Q=0,z=0,X=void 0,Z=0,J=0,$=0,ee=0,te=!1,ne=!1,re=void 0,ie=!1,ae=new l.default,oe=new l.default,se=s.default,ue=function(){var e=T.calcDelta(Date.now()),t=h.calcDelta(W),i=E.calcDelta(K),a=S.calcDelta(b.dataUploaded);Q=8*t/e,z=8*a/e;var o=8*i/e,s=Date.now()-r.moduleState.currentTracks.lastSwitchTimestamp;te?u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&s<u.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION?M.update(o,k.default.halfLifeToEMAWeight(u.PEER_DOWNLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL)):M.update(o):o>0&&(M.update(o,1),te=!0),ne?u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON&&s<u.POST_TRACK_SWITCH_PEER_SPEED_SENSITIVITY_DURATION?N.update(z,k.default.halfLifeToEMAWeight(u.PEER_UPLOAD_SPEED_SENSITIVE_EMA_HALF_LIFE,u.PEER_SPEED_MONITOR_INTERVAL)):N.update(z):z>0&&(N.update(z,1),ne=!0),F.push(Z),H.push(J);var l=n.getRtt();l>0&&j.addSample(l)},le=function(e){n.sendMessage("requestHasSegment",{segmentCoord:e})},ce=function(e,t){var r=t.pushed;n.sendMessage("hasSegment",{segmentInfo:e,pushed:!!r})},de=function(e){Z++,J++,oe.set(e.id,ae.get(e.id)),ae.delete(e.id),(0,c.createTimeout)(function(){var t=oe.get(e.id);t&&t.timestamp===e.timestamp&&oe.delete(e.id)},u.CHUNK_GRACE_DURATION),this.isBannedSeeder()||ye(u.BLOCK_SEEDER_SCHEDULING_WINDOW)>u.BLOCK_SEEDER_SCHEDULING_TIMEOUT_THRESHOLD&&Z>u.BLOCK_SEEDER_SCHEDULING_REQUEST_THRESHOLD&&(se=Date.now())},fe=function(e,t,r,i){var s=m.default.decode(t),u=!0,l=!1,c=void 0;try{for(var d,f=(0,a.default)(s);!(u=(d=f.next()).done);u=!0){var h=d.value,_=new D.default(e,h,this,o,i,r);ae.set(_.id,_)}}catch(e){l=!0,c=e}finally{try{!u&&f.return&&f.return()}finally{if(l)throw c}}n.sendMessage("requestChunks",{segmentCoord:e,ids:t,safe:r===P.default.SAFE})},he=function(){re?re.clear():U.default.notifyError(new Error("clear() call on undefined Peer.speedMonitorTimer")),n.close()},_e=function(){n.removeListener(y.default.PeerConnection.BINARY_DATA_RECEIVED,me),n.removeListener(y.default.PeerConnection.MESSAGE_RECEIVED,Ee),C.off("segmentInfo",Ce),C.off(y.default.Metrics.TRACK_SWITCH,pe),re?re.clear():U.default.notifyError(new Error("clear() call on undefined Peer.speedMonitorTimer")),b.dispose(),X.dispose(),n.destroy()},pe=function(){ge()?V.activate():V.deactivate()},ve=function(){return V.accumulatedActiveTime},Ee=function(e,n){var i=void 0;switch(e){case"heartbeat":Y=n.videoTrack,pe();break;case"requestHasSegment":C.emit("segmentRequested",I,new t(n.segmentCoord));break;case"hasSegment":i=new t(n.segmentInfo.segmentCoord),i.fromPeer=!0;var o=new f.default(i,n.segmentInfo.size,n.segmentInfo.hash),s=!!n.pushed;C.emit("hasSegment",I,o,{pushed:s});break;case"requestChunks":if(!r.isP2PUploadOn)return;i=new t(n.segmentCoord);var u=m.default.decode(n.ids),l=n.safe?P.default.SAFE:P.default.UNSAFE,c=!0,d=!1,h=void 0;try{for(var _,p=(0,a.default)(u);!(c=(_=p.next()).done);c=!0){var v=_.value;r.efficiencyStats.receivedChunkRequestCount++,b.push(new w.default(i,v,r,l))}}catch(e){d=!0,h=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw h}}break;default:return void U.default.notifyError(new Error("Invalid message "+e+" sent by peerConnection"))}ie||(R.active++,ie=!0)},me=function(e,t,n){W+=e.byteLength;var i=ae.get(D.default.getIdOf(n,t));i?(Z++,i.dataDownloaded(e),K+=e.byteLength,ae.delete(i.id)):(ee++,i=oe.get(D.default.getIdOf(n,t)),i?($++,r.efficiencyStats.gracedChunksCount++,i.dataDownloaded(e),oe.delete(i.id)):(r.efficiencyStats.expiredGraceChunksCount++,r.transferStats.multipleDlM+=e.byteLength)),Se()},Se=function(){q||(R.transfer++,q=!0)},ge=function(){return!Y||r.moduleState.currentTracks.video.viewToString()===Y},Te=function(){return Date.now()-G<u.PEER_INIT_LOCKED_DURATION},ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u.PEER_TIMEOUT_RATIO_WINDOW,t=F.subDelta(e),n=H.subDelta(e);return t>0?n/t:0},Ce=function(e){for(var t=0;t<e.length;t++)le(e[t])};I.getRtt=n.getRtt.bind(n),I.requestHasSegment=le,I.answerHasSegment=ce,I.requestChunks=fe,I.timeoutChunk=de,I.isOnSameTrack=ge,I.close=he,I.isConnected=function(){return n.connected},I.getDataDownloaded=function(){return W},I.getDataUploaded=function(){return b.dataUploaded},I.getId=function(){return A},I.getDlSpeed=function(){return Q},I.getUpSpeed=function(){return z},I.getUsefulDlSpeedEMA=function(){return M.value},I.getUpSpeedEMA=function(){return N.value},I.getChunkTimeoutCount=function(){return J},I.getChunkRequestedCount=function(){return Z},I.getLateChunksCount=function(){return ee},I.getGracedChunksCount=function(){return $},I.getUploadCapacity=function(){return X.value},I.isLooser=function(){var e=ye()>u.PEER_CRITICAL_CHUNK_TIMEOUT_THRESHOLD,t=N.value<u.LOOSER_UPLOAD_THRESHOLD;return e&&t},I.isBannedSeeder=function(){return Date.now()-se<u.BLOCK_SEEDER_SCHEDULING_DURATION},I.getChunksQuantityForInterval=function(e){var t=X.value*(e/1e3),n=Math.ceil(t*(1+u.PEER_UPLOAD_CAPACITY_EXTRA_RATIO)/(8*u.CHUNK_SIZE/1024)),r=Math.floor(n*u.PEER_UPLOAD_CAPACITY_SAFE_RATIO/(1+u.PEER_UPLOAD_CAPACITY_EXTRA_RATIO));return{safe:r,unsafe:n-r}},I.getCreationTimestamp=function(){return G},I.locked=function(){return(!!u.POST_TRACK_SWITCH_PEER_LOCK_SENSITIVITY_ON||ge())&&(Te()||N.value/r.abrStats.estimatedBitrate>u.PEER_LOCKED_UPLOAD_THRESHOLD||M.value/r.abrStats.estimatedBitrate>u.PEER_LOCKED_DOWNLOAD_THRESHOLD)},I.getHistoricalMeanRtt=function(){return j},I.getDebugInfos=function(){return{id:A.slice(-7),RawDownloadSpeed:new v.BitDataAmount(1e3*Q,"ps"),RawUploadSpeed:new v.BitDataAmount(1e3*z,"ps"),DataDownloaded:new v.ByteDataAmount(W),DataUploaded:new v.ByteDataAmount(b.dataUploaded),RTT:n.getRtt()>=0?n.getRtt():"unavailable",UploadCapacity:new v.BitDataAmount(1e3*X.value,"ps"),ConenctedDuration:Math.round((Date.now()-G)/1e3),OngoingRequests:ae.size,GracingRequests:oe.size,RequestedChunks:Z,GracedChunks:$,TimeoutChunks:J,LateChunks:ee,GracedRatio:(Z?$/Z:0).toFixed(2),TimeoutRatio:(Z?J/Z:0).toFixed(2),LateRatio:(Z?ee/Z:0).toFixed(2),SmoothedUsefulDownloadSpeed:new v.ByteDataAmount(1e3*this.getUsefulDlSpeedEMA()/8,"ps"),SmoothedUploadSpeed:new v.ByteDataAmount(1e3*this.getUpSpeedEMA()/8,"ps"),WindowedTimeoutRatio:ye().toFixed(2),PeerStatus:(this.locked()?"locked":"unlocked")+"-"+(this.isLooser()?"looser":"normal"),LastCRank:this.lastCRank?this.lastCRank.toFixed(2):"unavailable",SeederTimeoutRatio:ye(u.BLOCK_SEEDER_SCHEDULING_WINDOW).toFixed(2),SeederBanned:this.isBannedSeeder(),VideoTrack:Y,SameTrack:ge(),SameTrackTime:Math.round(ve()/1e3)}},function(){X=new g.default(r,I,i),re=(0,c.createInterval)(ue,u.PEER_SPEED_MONITOR_INTERVAL),b.onTransfering=Se,n.once(y.default.PeerConnection.DISCONNECTED,function(){R.disconnected++,j.count>0&&R.endedConnectionP2pRttSamples.addSample(j.mean),R.sampledPeerStats.addSample({connectionDuration:(Date.now()-G)/1e3,sameTrackTime:ve()/1e3}),R.residualDisconnectedPeerDuration+=(Date.now()-r.lastStatPayloadTimestamp)/1e3,C.emit(y.default.Peer.PEER_DISCONNECTED,I),_e()}),n.on(y.default.PeerConnection.BINARY_DATA_RECEIVED,me),n.on(y.default.PeerConnection.MESSAGE_RECEIVED,Ee),C.once("segmentInfo",Ce),C.on(y.default.Metrics.TRACK_SWITCH,pe),F.push(0),H.push(0)}()};t.default=F,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(39),l=r(u),c=n(72),d=r(c),f=n(19),h=n(5),_=function(){function e(t,n,r){var i=this;(0,a.default)(this,e);var o=t.conf,s=this._getTrimmedWindowTimeout(t),u=new f.Delta(n.getDataDownloaded()),c=new f.Delta(Date.now()),_=new d.default(s),p=new d.default(s);this._capacityEmwa=new l.default(r,o.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_UP),_.push(n.getChunkTimeoutCount()),p.push(n.getChunkRequestedCount()),this._timer=(0,h.createInterval)(function(){_.push(n.getChunkTimeoutCount()),p.push(n.getChunkRequestedCount());var e=p.delta,t=_.delta,r=u.calcDelta(n.getDataDownloaded()),a=c.calcDelta(Date.now());if(null!==t&&null!==e){var s=8*r/1024*1e3/a,l=e>0?t/e:0;s>=i._capacityEmwa.value?i._capacityEmwa.update(s):l>=o.MAX_PEER_UPLOAD_CAPACITY_TIMEOUT_RATIO&&(o.PUC_EMWA_WEIGHT_USE_TIMEOUT_RATIO?i._capacityEmwa.update(s,Math.min(l,o.PUC_EMWA_WEIGHT_CAP)):i._capacityEmwa.update(s,o.PEER_UPLOAD_CAPACITY_EWMA_WEIGHT_DOWN))}},o.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL)}return(0,s.default)(e,[{key:"_getTrimmedWindowTimeout",value:function(e){var t=e.conf,n=e.moduleState,r=t.PEER_UPLOAD_CAPACITY_COMPUTATION_INTERVAL,i=n.isLive()?t.LIVE.CHUNK_TIMEOUT:t.CHUNK_TIMEOUT;return r*Math.ceil(i/r)+100}},{key:"dispose",value:function(){this._timer.clear()}},{key:"value",get:function(){return this._capacityEmwa.value}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(65),l=(r(u),n(2)),c=r(l),d=n(4),f=r(d),h={TOGGLED_OFF:"toggledOff",WAITING_FOR_DISTRIBUTOR:"waitingForDistributor",UNKNOWN:"unknown",DISABLED_BY_P2P_CONFIG:"disabledByP2PConfig",DISABLED_BY_INJECTED_CONF:"disabledByInjectedConf",DISABLED_BECAUSE_NO_CORS:"disabledBecauseNoCors",DISABLED_BECAUSE_WRONG_RANGE:"disabledBecauseWrongRange",PROBABLY:"probably",ENABLED:"enabled"},_=function(){function e(t){var n=this;(0,a.default)(this,e),this._status=h.WAITING_FOR_DISTRIBUTOR,t.eventBus.on(c.default.Distributor.ANSWERED,function(){t.conf.ENABLE_RANGE_REQUEST_DETECTION?t.conf.RANGE_REQUEST_DETECTION?n._status=h.UNKNOWN:n._status=!1===t.p2pConfig.rangeRequestEnabled?h.DISABLED_BY_P2P_CONFIG:h.DISABLED_BY_INJECTED_CONF:n._status=h.TOGGLED_OFF})}return(0,s.default)(e,[{key:"setProbably",value:function(){return this._status!==h.UNKNOWN?void f.default.notifyError(new Error("Transition to `probably` state is possible only from `unknown`")):void(this._status=h.PROBABLY)}},{key:"setDisabledBecauseNoCors",value:function(){return this._status!==h.UNKNOWN?void f.default.notifyError(new Error("Transition to `disabledBecauseNoCors` state is possible only from `unknown`")):void(this._status=h.DISABLED_BECAUSE_NO_CORS)}},{key:"setDisabledBecauseWrongRange",value:function(){return this._status!==h.PROBABLY&&this._status!==h.ENABLED?void f.default.notifyError(new Error("Transition to `disabledBecauseWrongRange` state is possible only from `probably` or `enabled`")):void(this._status=h.DISABLED_BECAUSE_WRONG_RANGE)}},{key:"setEnabled",value:function(){return this._status!==h.PROBABLY?void f.default.notifyError(new Error("Transition to `enabled` state is possible only from `probably`")):void(this._status=h.ENABLED)}},{key:"status",get:function(){return this._status}},{key:"isUnknown",get:function(){return this._status===h.UNKNOWN}},{key:"isProbably",get:function(){return this._status===h.PROBABLY}},{key:"canDoRR",get:function(){return this.isProbably||this._status===h.ENABLED}}]),e}();_.States=h,t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(152),s=r(o),u=n(146),l=r(u),c=n(149),d=r(c),f=n(155),h=r(f),_=n(154),p=r(_),v=n(164),E=r(v),m=n(145),S=r(m),g=n(163),T=r(g),y=n(142),C=r(y),D=n(156),A=r(D),w=n(153),R=r(w),P=n(150),b=r(P),k=n(159),I=r(k),O=n(167),N=r(O),L=n(166),M=n(158),U=r(M),B=n(147),x=r(B),F=n(157),H=r(F),G=n(50),j=n(65),V=r(j),W=n(38),K=n(160),q=r(K),Y=n(4),Q=r(Y),z=n(143),X=r(z),Z=n(148),J=r(Z),$=n(93),ee=r($),te=n(168),ne=r(te),re=n(169),ie=r(re),ae=n(151),oe=r(ae),se=n(144),ue=r(se),le=n(161),ce=r(le),de=n(162),fe=r(de),he=n(67),_e=r(he),pe=n(66),ve=r(pe),Ee=n(165),me=r(Ee);Q.default.setScriptOrigin(window.document.currentScript&&window.document.currentScript.src?window.document.currentScript.src:null);var Se=function e(t,n,r,i,o,u,c){var f=this;if("string"!=typeof c||""===c||c.length>10)throw new Error("Unvalid argument in PeerAgent constructor: integration version must be a non-empty string of less than 10 characters");var _=new X.default,v=new V.default(i,n,c,t,_,r,u);Q.default.setCustomer(v.conf.ID_CLIENT),Q.default.setMetadata({stream:v.moduleState.content}),(0,G.checkInterface)(ve.default,r),(0,G.checkInterface)(_e.default,o.prototype),(0,W.assertStreamType)(u);var m=void 0,g=void 0,y=void 0,D=void 0,w=void 0,P=void 0,k=void 0,O=void 0,M=void 0,B=void 0,F=void 0,j=void 0,K=void 0,Y=void 0,z=void 0,Z=void 0,$=!1,te=void 0,re=void 0,ae=void 0,se=function(){M=(0,L.createScheduler)(r,D,P,v)},le=function(){F&&(j=new U.default,w=new oe.default,g=new A.default(t,w,o,j,v),y=new R.default(v),z=new S.default(_,v),t.isLive()?Z=new T.default(t,_,v):(0,fe.default)(v),D=new b.default(g,j,v),k=new I.default(j,D,v),O=new N.default(D,v),P=new x.default(r,v),se(),w.init(D,M),m=new l.default(D,M,v),Y=new C.default(_,v),(0,ue.default)(v),B=new J.default(v),B.connect(),s.default.listenEvents(M,D,j,P,v),re.listenEvents(ae),de()),$=!0},de=function(){v.conf.DEBUG&&(K=new E.default(g,Z,v))},he=function(e){return e.trackView&&e.trackView.type&&("audio"===e.trackView.type||"video"===e.trackView.type)},pe=function(e){if(!F)throw new Error("P2P is not activated, getP2PData can't be called");var t=void 0;return $?t=F?D.getPartialSegment(e)||new h.default(e,D,j,v):new p.default(e):(ae=he(e),le(),t=new p.default(e)),ae&&re.updateWithSegmentView(e),M.updateTrackEdge(e),t},Ee=function(e,t,n){return null!==n&&(0,G.checkInterface)(_e.default,n),H.default.getSegment(this,e,t,n,v)},Se=function(e){v.mediaStats.playbackErrorCount++,v.conf.ENABLE_PLAYBACK_ERROR_LOGGING&&"string"==typeof e&&""!==e&&(e=e.substring(0,125),Q.default.notifyError(new Error("Playback error: "+e)))},ge=function(){v.dispose(),F&&($&&(Y.dispose(),m.dispose(),D.dispose(),M.dispose(),g.dispose(),y.dispose(),B.dispose(),K&&K.dispose(),z.dispose(),Z&&Z.dispose()),te.removeAllExternalEventListener()),t&&(0,a.default)(t,new me.default),ne.default.removeFromPeerAgentList(v.peerToken)};!function(){(F=ee.default.isP2PEnabled(v.conf))&&(te=new d.default(t),re=new ce.default(te,v))}(),this.getSegment=Ee,this.getP2PData=pe,this.onPlaybackError=Se,this.dispose=ge,this.setMediaElement=function(e){f.mediaElement=e},Object.defineProperty(this,"mediaElement",{get:function(){return _.mediaElement},set:function(e){v.mediaStats.mediaElementSet++,_.mediaElement!==e&&v.mediaStats.mediaElementChanged++,_.mediaElement=e}}),Object.defineProperty(this,"p2pDownloadOn",{get:function(){return v.isP2PDownloadOn},set:function(e){e!==v.isP2PDownloadOn&&(v.isP2PDownloadOn=e,v.eventBus.emit("p2pDownloadToggle",e))}}),Object.defineProperty(this,"version",{get:function(){return e.version}}),Object.defineProperty(this,"p2pUploadOn",{get:function(){return v.isP2PUploadOn},set:function(e){e!==v.isP2PUploadOn&&(v.isP2PUploadOn=e,v.eventBus.emit("p2pUploadToggle",e))}}),Object.defineProperty(this,"isP2PEnabled",{get:function(){return ee.default.isP2PEnabled(v.conf)}}),Object.defineProperty(this,"stats",{get:function(){return q.default.get(g,v,Z,_)}}),Object.defineProperty(this,"nextSegmentPrebuffered",{get:function(){return v.moduleState.nextSegmentPrebuffered}}),Object.defineProperty(this,"PublicAPI",{get:function(){return ie.default.get(f)}}),ne.default.addToPeerAgentList(v.peerToken,this)};Object.defineProperty(Se,"StreamTypes",{get:function(){return W.StreamTypes}}),Object.defineProperty(Se,"version",{get:function(){return"4.12.0"}}),ne.default.setup(Se),t.default=Se,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){var n=this;(0,a.default)(this,e),this._conf=t,this._peers=[],this._peerUpoadCapacityComparator=function(e,t){var r=e.getChunksQuantityForInterval(n._conf.CHUNK_BATCHING_INTERVAL).safe;return t.getChunksQuantityForInterval(n._conf.CHUNK_BATCHING_INTERVAL).safe-r}}return(0,s.default)(e,[{key:"add",value:function(e){this.remove(e),this._peers.push(e)}},{key:"remove",value:function(e){var t=e.getId();this._peers=this._peers.filter(function(e){return e.getId()!==t})}},{key:"all",value:function(){return this._peers.sort(this._peerUpoadCapacityComparator)}},{key:"allNotBanned",value:function(){return this._peers.filter(function(e){return!e.isBannedSeeder()}).sort(this._peerUpoadCapacityComparator)}},{key:"clear",value:function(){this._peers.length=0}},{key:"length",get:function(){return this._peers.length}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(18),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function(){var e=!1,t=void 0,n=0,r=0,a=0,o=0,s=0,u=0,l=0,c=0,d="",f=!1,h="",_=this,p=void 0,v=void 0,E=new i.default,m=null,S=function(){var e=void 0,t=void 0,i=void 0,l=void 0;n&&(n>a&&(a=n),e=r?(r*p+n)/(p+1):n,t=p?p+1:1,p=t,r=e),o&&(o>u&&(u=o),i=s?(s*v+o)/(v+1):o,l=v?v+1:1,v=l,s=i)};_.getMyPeerId=function(){return t},_.setMyPeerId=function(e){t!==e&&(t=e)},_.getDlSpeed=function(){return n},_.setDlSpeed=function(e){n=e},_.getAvgDlSpeed=function(){return r},_.getMaxDlSpeed=function(){return a},_.getUpSpeed=function(){return o},_.setUpSpeed=function(e){o=e},_.getAvgUpSpeed=function(){return s},_.getMaxUpSpeed=function(){return u},_.getCdnCancelled=function(){return c},_.increaseCdnCancelledBy=function(e){c+=e},_.getConnected=function(){return e},_.setTrackerVersion=function(e){d=e},_.getTrackerVersion=function(){return d},_.setTrackerId=function(e){h=e},_.getTrackerId=function(){return h},_.setConnected=function(t){t!==e&&(e=t,!0===t?E.emit("tracker_ready"):E.emit("tracker_disconnected"))},_.getEE=function(){return E},_.setConnectedToSignalingServer=function(){f=!0,E.emit("signaling_ready")},_.setDisconnectedToSignalingServer=function(){f=!1,E.emit("signaling_disconnected")},_.getConnectedToSignalingServer=function(){return f},_.computeMaxAndAvgSpeed=S,_.setMeanInstantSpeed=function(e){l=e},_.getMeanInstantSpeed=function(){return l},_.setBearerToken=function(e){m=e},_.getBearerToken=function(){return m}};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(15),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=function(){function e(t){(0,s.default)(this,e),this._collection=new a.default,this._computationInterval=t}return(0,l.default)(e,[{key:"getOrCreate",value:function(e){var t=e.getId(),n=this._collection.get(t);return n||(n=e.getChunksQuantityForInterval(this._computationInterval),this._collection.set(t,n)),n}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"getBinaryData",value:function(e,t,n){throw new Error("must be implemented")}},{key:"setBinaryData",value:function(e,t){throw new Error("must be implemented")}},{key:"setComplete",value:function(){}},{key:"destroy",value:function(){}},{key:"byteLength",get:function(){return this._byteLength},set:function(e){this._byteLength=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=ArrayBuffer,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(203),p=r(_),v=n(202),E=r(v),m=function(e){function t(e){(0,s.default)(this,t);var n=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this));if("number"==typeof e)n._binaryData=new p.default(e);else{if(!(e instanceof p.default))throw new Error(t.ERR_WRONG_PARAM_TYPE);n._binaryData=e}return n}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getBinaryData",value:function(e,t,n){n(this._binaryData.slice(e,e+t))}},{key:"setBinaryData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0===t&&e.byteLength===this._binaryData.byteLength?this._binaryData=e:this._binaryData=this._appendBuffer(e,t)}},{key:"_appendBuffer",value:function(e,t){var n=new Uint8Array(this._binaryData);return n.set(new Uint8Array(e),t),n.buffer}},{key:"byteLength",get:function(){return this._binaryData.byteLength},set:function(e){throw new TypeError(t.ERR_CANNOT_SET_BYTE_LENGTH)}}]),t}(E.default);m.ERR_CANNOT_SET_BYTE_LENGTH="Cannot manually set the byteLength",m.ERR_WRONG_PARAM_TYPE="Wrong parameter in Segment Constructor",t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(101),d=r(c),f=function(){function e(t){(0,a.default)(this,e),this._ee=t,this.gotoIdle()}return(0,s.default)(e,[{key:"_setState",value:function(e){this._state!==e&&(this._prevState=this._state,this._state=e,this._prevState&&this._ee.emit(l.default.BufferManager.STATE_CHANGED,this._prevState,this._state))}},{key:"gotoIdle",value:function(){this._setState(d.default.IDLE)}},{key:"gotoNoPeer",value:function(){this._setState(d.default.NO_PEER)}},{key:"gotoRandom",value:function(){this._setState(d.default.RANDOM)}},{key:"gotoDynamic",value:function(){this._setState(d.default.DYNAMIC)}},{key:"gotoTopSeeder",value:function(){this._setState(d.default.TOP_SEEDER)}},{key:"getState",value:function(){return this._state}},{key:"isIdle",value:function(){return this._state===d.default.IDLE}},{key:"isNoPeer",value:function(){return this._state===d.default.NO_PEER}},{key:"isRandom",value:function(){return this._state===d.default.RANDOM}},{key:"isDynamic",value:function(){return this._state===d.default.DYNAMIC}},{key:"isTopSeeder",value:function(){return this._state===d.default.TOP_SEEDER}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={ZERO:0,CRITICALLY_LOW:1,LOW:2,MODERATE:3,HIGH:4};t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={LOW:"target_low",HIGH:"target_high",RANDOM:"target_random",INIT:"target_init"};t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(19),l=n(5),c=n(39),d=r(c),f=1e3,h=function(){function e(t){(0,a.default)(this,e),this._uploadSpeedDelta=new u.Delta,this._uploadSpeedTimestampDelta=new u.Delta(Date.now()),this._sharedState=t,this._uploadCapacityEMWA=new d.default(0,this._sharedState.conf.LIVE.BUFFER_LEVEL_UPLOAD_SPEED_EMWA_WEIGHT),this._uploadSpeedInterval=(0,l.createInterval)(this._refreshUploadSpeed.bind(this),f)}return(0,s.default)(e,[{key:"_refreshUploadSpeed",value:function(){var e=this._sharedState.transferStats.p2pUploaded,t=this._uploadSpeedDelta.calcDelta(e),n=this._uploadSpeedTimestampDelta.calcDelta(Date.now()),r=8*t/n;r>0&&this._uploadCapacityEMWA.update(r)}},{key:"dispose",value:function(){this._uploadSpeedInterval.clear()}},{key:"uploadCapacityEMWA",get:function(){return this._uploadCapacityEMWA.value}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=r(u),c=n(31),d=r(c),f=n(2),h=r(f),_=n(4),p=r(_),v=n(5),E=function(){function e(t){(0,a.default)(this,e),this._isCommunicating=!0,this._isConnected=!0,this._rtt=-1,this._ee=new l.default,this._timerStore=new d.default,this._sharedState=t}return(0,s.default)(e,[{key:"_sendHeartbeat",value:function(){return this.sendMessage("heartbeat",{videoTrack:this._getVideoTrack()})}},{key:"_manageHeartbeat",value:function(){var e=this;this._sendHeartbeat();var t=(0,v.createInterval)(function(){e._isCommunicating||(e._sharedState.controlStats.checkHeartbeatFailed++,e._closeConnectionIfOpen()),e._isCommunicating=!1},this._sharedState.conf.CHECK_HEARTBEAT_INTERVAL),n=(0,v.createInterval)(this._sendHeartbeat.bind(this),this._sharedState.conf.SEND_HEARTBEAT_INTERVAL);this._timerStore.register(t),this._timerStore.register(n)}},{key:"_getVideoTrack",value:function(){var e="noTrack";return this._sharedState.moduleState.currentTracks.video&&(e=this._sharedState.moduleState.currentTracks.video.viewToString()),e}},{key:"_setDisconnected",value:function(){return this._isConnected?(this._isConnected=!1,void this._ee.emit(h.default.PeerConnection.DISCONNECTED)):void p.default.notifyError(new Error("Guarded attempt to trigger 'disconnected' event on PeerConnection more than once"))}},{key:"_closeConnectionIfOpen",value:function(){throw new Error("Cannot call abstract method")}},{key:"sendMessage",value:function(e,t){throw new Error("Cannot call abstract method")}},{key:"sendBinaryData",value:function(e,t){throw new Error("Cannot call abstract method")}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this._ee).emit.apply(t,[e].concat(r))}},{key:"on",value:function(e,t){this._ee.on(e,t)}},{key:"once",value:function(e,t){this._ee.once(e,t)}},{key:"removeListener",value:function(e,t){this._ee.removeListener(e,t)}},{key:"getRtt",value:function(){return this._rtt}},{key:"getBufferedAmount",value:function(){throw new Error("Cannot call abstract method")}},{key:"onbufferedamountlow",set:function(e){throw new Error("Cannot call abstract method")}},{key:"connected",get:function(){return this._isConnected}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=(r(u),n(2)),c=r(l),d=n(5),f=function(){function e(t,n){(0,a.default)(this,e),this._stoppedAskingPeers=!1,this._conf=t,this._eventBus=n,this._updateSegmentTransferToPlayerTimestamp(),this._initTickInerval(),this._onSegmentTransferred=this._updateSegmentTransferToPlayerTimestamp.bind(this),n.on(c.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE,this._onSegmentTransferred)}return(0,s.default)(e,[{key:"dispose",value:function(){this._tickInterval.clear(),this._eventBus.removeListener(c.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE,this._onSegmentTransferred)}},{key:"_initTickInerval",value:function(){var e=this;this._tickInterval=(0,
d.createInterval)(function(){e._checkTimeSinceLastSegmentTransferToPlayer()},1e3)}},{key:"_updateSegmentTransferToPlayerTimestamp",value:function(){this._lastSegmentToPlayerTransferTimestamp=Date.now(),this._stoppedAskingPeers&&this._startAskingPeers()}},{key:"_checkTimeSinceLastSegmentTransferToPlayer",value:function(){Date.now()-this._lastSegmentToPlayerTransferTimestamp>=Number(this._conf.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS)&&this._stopAskingPeers()}},{key:"_stopAskingPeers",value:function(){!1===this._stoppedAskingPeers&&(this._stoppedAskingPeers=!0,this._eventBus.emit(c.default.PeerPool.STOP_ASKING_PEERS),this._tickInterval.clear())}},{key:"_startAskingPeers",value:function(){this._stoppedAskingPeers&&(this._stoppedAskingPeers=!1,this._eventBus.emit(c.default.PeerPool.START_ASKING_PEERS),this._initTickInerval())}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=(r(u),n(2)),c=r(l),d=n(5),f=function(){function e(t,n){(0,a.default)(this,e),this._tempDisconnectedFromBackend=!1,this._conf=t,this._eventBus=n,this._updateTransferTimestamp(),this._initTickInerval(),this._onUpdate=this._updateTransferTimestamp.bind(this),n.on(c.default.UploadQueue.CHUNK_REQUESTED,this._onUpdate),n.on(c.default.ChunkManager.CHUNK_DOWNLOADED,this._onUpdate),n.on(c.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE,this._onUpdate)}return(0,s.default)(e,[{key:"dispose",value:function(){this._tickInterval.clear(),this._eventBus.removeListener(c.default.UploadQueue.CHUNK_REQUESTED,this._onUpdate),this._eventBus.removeListener(c.default.ChunkManager.CHUNK_DOWNLOADED,this._onUpdate),this._eventBus.removeListener(c.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE,this._onUpdate)}},{key:"_initTickInerval",value:function(){var e=this;this._tickInterval=(0,d.createInterval)(function(){e._checkTimeSinceLastTransfer()},1e3)}},{key:"_updateTransferTimestamp",value:function(){this._lastTransferTimestamp=Date.now(),this._tempDisconnectedFromBackend&&this._reconnectToBackend()}},{key:"_checkTimeSinceLastTransfer",value:function(){Date.now()-this._lastTransferTimestamp>=Number(this._conf.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND)&&this._temporarilyDisconnectFromBackend()}},{key:"_temporarilyDisconnectFromBackend",value:function(){!1===this._tempDisconnectedFromBackend&&(this._tempDisconnectedFromBackend=!0,this._eventBus.emit(c.default.Tracker.TEMP_TRACKER_DISCONNECTION_REQUEST),this._eventBus.emit(c.default.Signaling.TEMP_SIGNALING_DISCONNECTION_REQUEST),this._eventBus.emit(c.default.TrafficAnalytics.STOP_SENDING_USAGE),this._tickInterval.clear())}},{key:"_reconnectToBackend",value:function(){this._tempDisconnectedFromBackend&&(this._tempDisconnectedFromBackend=!1,this._eventBus.emit(c.default.Tracker.TRACKER_RECONNECTION_REQUEST),this._eventBus.emit(c.default.Signaling.SIGNALING_RECONNECTION_REQUEST),this._eventBus.emit(c.default.TrafficAnalytics.RESTART_SENDING_USAGE),this._initTickInerval())}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=(r(u),n(211)),c=r(l),d=n(210),f=r(d),h=n(2),_=r(h),p=function(){function e(t,n){(0,a.default)(this,e),this._conf=t,this._eventBus=n,this._onInit=this._init.bind(this),this._eventBus.on(_.default.Config.CONFIG_UPDATED,this._onInit),this._init()}return(0,s.default)(e,[{key:"dispose",value:function(){this._backendConnectionManager&&this._backendConnectionManager.dispose(),this._askPeersManager&&this._askPeersManager.dispose(),this._eventBus.removeListener(_.default.Config.CONFIG_UPDATED,this._onInit)}},{key:"_init",value:function(){this._conf.TRANSFER_ACTIVITY_TIMEOUT_TO_DISCONNECT_FROM_BACKEND&&!this._backendConnectionManager&&(this._backendConnectionManager=new c.default(this._conf,this._eventBus)),this._conf.SEGMENT_REQUEST_TIMEOUT_TO_STOP_ASKING_PEERS&&!this._askPeersManager&&(this._askPeersManager=new f.default(this._conf,this._eventBus))}}]),e}();t.default=p,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(14),a=r(i),o=n(41),s=r(o),u=n(26),l=r(u),c=n(6),d=r(c),f=n(0),h=r(f),_=n(1),p=r(_),v=n(8),E=r(v),m=n(7),S=r(m),g=n(209),T=r(g),y=n(217),C=r(y),D=n(4),A=r(D),w=n(113),R=r(w),P=n(2),b=r(P),k=n(216),I=r(k),O=n(5),N=n(248),L=function(e){function t(e,n,r,i){(0,h.default)(this,t);var a=(0,E.default)(this,(t.__proto__||(0,d.default)(t)).call(this,i));return a._rtcPeerConnection=e,a._rtcDataChannel=n,a._segmentCoord=r,a._initialize(),a}return(0,S.default)(t,e),(0,p.default)(t,[{key:"_initialize",value:function(){var e=this;this._rtcDataChannel.bufferedAmountLowThreshold=this._sharedState.conf.UP_BUFFERED_AMOUNT_LOW_THRESHOLD,this._rtcDataChannel.onclose=function(){e._closeConnectionIfOpen()},this._rtcDataChannel.onerror=function(t){e._closeConnectionIfOpen()},this._rtcDataChannel.onmessage=this._messageHandler.bind(this),this._rtcPeerConnection.oniceconnectionstatechange=function(){switch(e._rtcPeerConnection.iceConnectionState){case"failed":case"closed":e._rtcPeerConnection.oniceconnectionstatechange=function(){},e._closeConnectionIfOpen()}},this._manageHeartbeat();var t=(0,O.createInterval)(this._updateRTT.bind(this),this._sharedState.conf.PEER_COMPUTE_RTT_INTERVAL);this._timerStore.register(t)}},{key:"_messageHandler",value:function(e){switch(this._isCommunicating=!0,(0,l.default)(e.data)){case"string":this._messageDataHandler(e.data);break;default:this._binaryDataHandler(e.data)}}},{key:"_messageDataHandler",value:function(e){this._sharedState.transferStats.p2pMessagesDownloaded+=e.length,this._sharedState.transferStats.p2pMessagesCount++;var t=C.default.decode(JSON.parse(e));this.emit(b.default.PeerConnection.MESSAGE_RECEIVED,t.type,t.args)}},{key:"_binaryDataHandler",value:function(e){var t=(0,N.parseMetaData)(e,this._segmentCoord.fromArrayBuffer);this._sharedState.transferStats.p2pHeadersDownloaded+=e.byteLength-t.data.byteLength,this._sharedState.transferStats.p2pMediaDownloaded+=t.data.byteLength,this.emit(b.default.PeerConnection.BINARY_DATA_RECEIVED,t.data,t.chunkIndex,t.segmentCoord)}},{key:"_closeConnectionIfOpen",value:function(){"closing"!==this._rtcDataChannel.readyState&&"closed"!==this._rtcDataChannel.readyState&&this._rtcDataChannel.close(),"closed"!==this._rtcPeerConnection.signalingState&&this._rtcPeerConnection.close(),this._setDisconnected()}},{key:"_handleSendFailure",value:function(e){var t=new Error(e);A.default.notifyError(t),this._closeConnectionIfOpen()}},{key:"_updateRTT",value:function(){var e=this;R.default.getPeerConnectionRTT(this._rtcPeerConnection,function(t){e._rtt=t})}},{key:"sendMessage",value:function(e,t){if("open"===this._rtcDataChannel.readyState){var n=C.default.encode(e,t),r=(0,s.default)(n);try{this._rtcDataChannel.send(r)}catch(e){return this._handleSendFailure("sendMessage failed while data channel open"),!1}return!0}return this._handleSendFailure("sendMessage failed: DataChannel readyState is not open but "+this._rtcDataChannel.readyState),!1}},{key:"sendBinaryData",value:function(e,t){var n=(0,N.encodeMetaData)(e,t);if("open"===this._rtcDataChannel.readyState){try{this._rtcDataChannel.send(n)}catch(e){return this._handleSendFailure("sendBinaryData failed while data channel open"),!1}return!0}return this._handleSendFailure("sendBinaryData failed: DataChannel readyState is not open but "+this._rtcDataChannel.readyState),!1}},{key:"close",value:function(){this._closeConnectionIfOpen(),this.destroy()}},{key:"destroy",value:function(){this._timerStore.clearAll(),(0,a.default)(this,new I.default)}},{key:"getBufferedAmount",value:function(){return this._rtcDataChannel.bufferedAmount}},{key:"onbufferedamountlow",set:function(e){this._rtcDataChannel.onbufferedamountlow=e}}]),t}(T.default);e.exports=L},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){w.default.notifyError(e)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(32),o=r(a),s=n(75),u=r(s),l=n(14),c=r(l),d=n(10),f=r(d),h=n(74),_=r(h),p=n(15),v=r(p),E=n(0),m=r(E),S=n(1),g=r(S),T=n(219),y=r(T),C=n(213),D=r(C),A=n(4),w=r(A),R=n(113),P=r(R),b=n(31),k=r(b),I=n(5),O=n(40),N=r(O),L=/typ srflx/,M={ordered:!1,maxRetransmits:1},U=function(){function e(t,n,r,i){(0,m.default)(this,e),this._sharedState=i,this._conf=i.conf,this._controlStats=i.controlStats,this._signalingClient=new y.default(i),this._myPeerId=t,this._peerPool=n,this._peerStats=i.peerStats,this._signalingClient.connect(this._conf.SIGNALING_URL,t),this._signalingClient.on("webrtc_offer",this._onOffer.bind(this)),this._signalingClient.on("webrtc_answer",this._onAnswer.bind(this)),this._peerConnectionCollection=new v.default,this.SegmentCoord=r,this._timerStore=new k.default}return(0,g.default)(e,[{key:"_autoSelectDataChannelType",value:function(){var e=N.default.getUAObject().browser;return"Firefox"===e.name&&"53"===e.major?"limited-retransmits":"limited-lifetime"}},{key:"_getDataChannelOptions",value:function(){var e=this._conf.DATACHANNEL_TYPE;switch("auto"===e&&(e=this._autoSelectDataChannelType()),e){case"reliable":return{ordered:!0};case"limited-lifetime":return{ordered:!1,maxPacketLifeTime:this._conf.DATACHANNEL_MAX_PACKET_LIFETIME};case"limited-retransmits":return{ordered:!1,maxRetransmits:this._conf.DATACHANNEL_MAX_RETRANSMITS};default:return w.default.notifyError(new Error("Invalid data channel type in injected config.")),M}}},{key:"createPeerConnection",value:function(e){var t=Math.round(Math.random()*_.default).toString(16),n=P.default.createPeerConnection(this._conf),r=n.createDataChannel("comm",this._getDataChannelOptions());r.binaryType="arraybuffer";var a=Date.now(),o=this._createOpenDataChannelHandler(n,r,e,t,!0);r.onopen=o;var s={connexionId:t,remotePeerId:e,rtcPeerConnection:n,connectionAttemptTimestamp:a,rtcDataChannel:r,connectionProgress:{hasLocalDescription:!1,hasRemoteDescription:!1,hasLocalDescriptionWithStun:!1,hasRemoteDescriptionWithStun:!1,hasLocalStunIceCandidate:!1,hasRemoteStunIceCandidate:!1}};this._peerConnectionCollection.set(t,s),n.createOffer(function(e){n.setLocalDescription(e,function(){s.connectionProgress.hasLocalDescription=!0},i)},i),s.connectionTimeout=this._manageConnectionTimeout(s,!0),this._manageIceCandidate(s)}},{key:"_manageIceCandidate",value:function(e){var t=this;e.iceGatheringStartTimestamp=Date.now(),e.rtcPeerConnection.onicecandidate=function(n){if(null===n.candidate){var r=Date.now()-e.iceGatheringStartTimestamp;r<t._conf.ICECANDIDATES_TIMEOUT&&(t._controlStats.earlyIceGatheringFinishedCount++,t._controlStats.setSampledIceGatheringDuration(r)),void 0!==e.connectionAttemptTimestamp?t._sendSdp(e,"offer"):void 0!==e.offeredAttemptTimestamp&&t._sendSdp(e,"answer")}}}},{key:"_onConnexionRefused",value:function(e,t){this._peerConnectionCollection.get(t).rtcPeerConnection.close(),this._peerConnectionCollection.delete(t),this._peerPool.offerDeclined(e)}},{key:"_onConnexionTimeout",value:function(e,t,n,r,i){e.oniceconnectionstatechange=function(){},this._timerStore.clear(i);var a=this._peerConnectionCollection.get(n);this._peerStats.incrementTimeout(e.iceConnectionState,e.iceGatheringState,r,a.connectionProgress),"have-local-offer"===e.signalingState&&this._peerStats.unansweredOffer++,e.close();var o=this._peerConnectionCollection.get(n);void 0!==o.connectionAttemptTimestamp&&this._peerStats.failedPeerConnectionAttemptDuration.addSample(Date.now()-o.connectionAttemptTimestamp),this._peerConnectionCollection.delete(n),this._peerPool.connectionAttemptTimeout(t)}},{key:"_manageConnectionTimeout",value:function(e,t){var n=this,r=e.rtcPeerConnection,i=e.remotePeerId,a=e.connexionId,o=(0,I.createTimeout)(function(){n._onConnexionTimeout(r,i,a,t,o)},this._conf.PEER_CONNECTION_TIMEOUT);return this._timerStore.register(o),r.oniceconnectionstatechange=function(){switch(r.iceConnectionState){case"failed":n._onConnexionTimeout(r,i,a,t,o)}},o}},{key:"_sendSdp",value:function(e,t){var n=e.rtcPeerConnection.localDescription.sdp;L.test(n)&&(e.connectionProgress.hasLocalDescriptionWithStun=!0),this._conf.ENCODE_SDP&&(n=P.default.encodeFullSdp(n,t));var r={type:"webrtc_"+t,connexion_id:e.connexionId,sender_id:this._myPeerId,receiver_id:e.remotePeerId,sdp:n};"answer"===t&&(r.accepted=!0),this._signalingClient.send(r)}},{key:"_onOffer",value:function(e){var t=this;this._peerStats.offer++;var n=e.sender_id,r=e.connexion_id;if(this.getOpenConnectorSlotsCount()<=0){var a={type:"webrtc_answer",connexion_id:r,sender_id:this._myPeerId,receiver_id:n,accepted:!1};return void this._signalingClient.send(a)}var o=P.default.createPeerConnection(this._conf),s={connexionId:r,remotePeerId:n,rtcPeerConnection:o,offeredAttemptTimestamp:Date.now(),connectionProgress:{hasLocalDescription:!1,hasRemoteDescription:!1,hasLocalDescriptionWithStun:!1,hasRemoteDescriptionWithStun:!1,hasLocalStunIceCandidate:!1,hasRemoteStunIceCandidate:!1}};this._peerConnectionCollection.set(r,s),this._manageIceCandidate(s),this._conf.ENCODE_SDP&&(e.sdp=P.default.decodeSdp(e.sdp));var u={sdp:e.sdp,type:"offer"},l=new P.default.SessionDescription(u);o.setRemoteDescription(l,function(){o.createAnswer(function(e){o.setLocalDescription(e,function(){s.connectionProgress.hasLocalDescription=!0},i)},i),s.connectionProgress.hasRemoteDescription=!0,L.test(l.sdp)&&(s.connectionProgress.hasRemoteDescriptionWithStun=!0)},i),s.connectionTimeout=this._manageConnectionTimeout(s,!1),o.ondatachannel=function(e){var a=e.channel||e;a.binaryType="arraybuffer";var s=t._createOpenDataChannelHandler(o,a,n,r,!1);"connecting"===a.readyState?a.onopen=s:s(),a.onerror=i}}},{key:"_createOpenDataChannelHandler",value:function(e,t,n,r,i){var a=this;return function(){if(!a._peerConnectionCollection.get(r))return void a._peerStats.lateMessage++;var o=a._peerConnectionCollection.get(r);void 0!==o.connectionAttemptTimestamp&&a._peerStats.successPeerConnectionAttemptDuration.addSample(Date.now()-o.connectionAttemptTimestamp),a._peerConnectionCollection.delete(r),o.connectionTimeout&&a._timerStore.clear(o.connectionTimeout);var s=new D.default(e,t,a.SegmentCoord,a._sharedState);a._peerPool.addPeerConnection(n,s,i)}}},{key:"_onAnswer",value:function(e){var t=e.sender_id,n=e.connexion_id;if(!this._peerConnectionCollection.get(n))return void this._peerStats.lateMessage++;var r=this._peerConnectionCollection.get(n),a=r.rtcPeerConnection,o=r.connectionTimeout,s=r.connectionProgress;if(a)if(e.accepted){this._conf.ENCODE_SDP&&(e.sdp=P.default.decodeSdp(e.sdp));var u={sdp:e.sdp,type:"answer"},l=new P.default.SessionDescription(u);a.setRemoteDescription(l,function(){s.hasRemoteDescription=!0,L.test(l.sdp)&&(s.hasRemoteDescriptionWithStun=!0)},i)}else this._timerStore.clear(o),this._onConnexionRefused(t,n)}},{key:"getPeerConnectionCount",value:function(){return this._peerConnectionCollection.size}},{key:"getOpenConnectorSlotsCount",value:function(){return Math.max(Math.round(this._peerPool.openSlotsCount()-this.getPeerConnectionCount()*this._conf.EXPECTED_CONNECTION_SUCCESS_RATE),0)}},{key:"dispose",value:function(){this._signalingClient.close(),this._timerStore.clearAll();var e=!0,t=!1,n=void 0;try{for(var r,i=(0,f.default)(this._peerConnectionCollection.values());!(e=(r=i.next()).done);e=!0)r.value.rtcPeerConnection.close()}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"getPendingConnectionDebugInfos",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=(0,f.default)(this._peerConnectionCollection.values());!(t=(i=a.next()).done);t=!0){var o=i.value,s=o.rtcPeerConnection,u=s.iceGatheringState,l=s.signalingState,d=s.iceConnectionState,h=o.rtcDataChannel?o.rtcDataChannel.readyState:"offered",_=o.connectionAttemptTimestamp||o.offeredAttemptTimestamp,p=_?Math.round((_+this._conf.PEER_CONNECTION_TIMEOUT-Date.now())/1e3):"unavailable",v={id:o.remotePeerId.slice(-7),timestamp:_,remainingTimeout:p,iceGatheringState:u,signalingState:l,iceConnectionState:d,readyState:h};e.push((0,c.default)(v,o.connectionProgress))}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return e}},{key:"getPendingConnectionPeers",value:function(){var e=new u.default,t=!0,n=!1,r=void 0;try{for(var i,a=(0,f.default)(this._peerConnectionCollection.values());!(t=(i=a.next()).done);t=!0){var s=i.value;e.add(s.remotePeerId)}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return(0,o.default)(e)}}]),e}();t.default=U,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=[],n=e.split(","),r=!0,i=!1,a=void 0;try{for(var s,c=(0,u.default)(n);!(r=(s=c.next()).done);r=!0){var d=s.value,f=d.split("-"),h=""!==f[0]?Number(f[0]):NaN,_=""!==f[1]?Number(f[1]):NaN;if(1===f.length&&(0,o.default)(h))t.push(h);else{if(2!==f.length||!(0,o.default)(h)||!(0,o.default)(_))throw new Error("P2P protocol error: could not decode chunk batch");t=t.concat((0,l.range)(h,_))}}}catch(e){i=!0,a=e}finally{try{!r&&c.return&&c.return()}finally{if(i)throw a}}return t}Object.defineProperty(t,"__esModule",{value:!0});var a=n(262),o=r(a),s=n(10),u=r(s),l=n(25);t.default={decode:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"sendMessage",value:function(){throw new Error("One should not call sendMessage on a PeerConnection that has already been destroyed")}},{key:"sendBinaryData",value:function(){throw new Error("One should not call sendBinaryData on a PeerConnection that has already been destroyed")}},{key:"getRtt",value:function(){throw new Error("One should not call getRtt on a PeerConnection that has already been destroyed")}},{key:"getBufferedAmount",value:function(){throw new Error("One should not call getBufferedAmount on a PeerConnection that has already been destroyed")}},{key:"destroy",value:function(){throw new Error("One should not call destroy on a PeerConnection that has already been destroyed")}},{key:"close",value:function(){throw new Error("One should not call close on a PeerConnection that has already been destroyed")}},{key:"on",value:function(){throw new Error("One should not call on on a PeerConnection that has already been destroyed")}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n={a:v[e]},r=l(e),i=o(t,r);return(0,p.default)(n,i),n}function a(e){var t=s(e.a);return{type:t,args:u(e,l(t))}}function o(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=(0,h.default)((0,d.default)(t));!(r=(o=s.next()).done);r=!0){var u=o.value;if(void 0===e[u])throw new Error("P2P protocol error: missing mandatory property "+u+" from message to encode");var l=t[u];void 0!==l&&(n[l]=e[u])}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function s(e){var t=!0,n=!1,r=void 0;try{for(var i,a=(0,h.default)((0,d.default)(v));!(t=(i=a.next()).done);t=!0){var o=i.value;if(v[o]===e)return o}}catch(e){n=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw r}}return null}function u(e,t){var n={},r=!0,i=!1,a=void 0;try{for(var o,s=(0,h.default)((0,d.default)(t));!(r=(o=s.next()).done);r=!0){var u=o.value,l=t[u],c=e[l];if(void 0===c)throw new Error("P2P protocol error: could not decode property "+u+" from encoded payload");n[u]=c}}catch(e){i=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}function l(e){switch(e){case"info":return E;case"heartbeat":return T;case"requestHasSegment":return m;case"hasSegment":return S;case"requestChunks":return g;default:throw new Error("P2P protocol error: unhandled message type")}}Object.defineProperty(t,"__esModule",{value:!0});var c=n(42),d=r(c),f=n(10),h=r(f),_=n(14),p=r(_),v={info:"a",requestHasSegment:"b",hasSegment:"c",requestChunks:"d",heartbeat:"e"},E={city:"c",country:"d",latitude:"e",longitude:"f"},m={segmentCoord:"b"},S={segmentInfo:"b",pushed:"c"},g={segmentCoord:"b",ids:"c",safe:"d"},T={videoTrack:"b"};t.default={encode:i,decode:a},e.exports=t.default},function(e,t,n){"use strict";function r(e,t,r,i){return new(n(214))(e,t,r,i)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(41),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(54),d=r(c),f=n(4),h=r(f),_=n(2),p=r(_),v=n(5),E=function(){function e(t){var n=this;(0,s.default)(this,e),this._conf=t.conf,this._status=t.status,this._controlStats=t.controlStats,t.eventBus.on(p.default.Signaling.SIGNALING_RECONNECTION_REQUEST,function(){n._createConnection()}),t.eventBus.on(p.default.Signaling.TEMP_SIGNALING_DISCONNECTION_REQUEST,function(){n.close()}),t.eventBus.on(p.default.Signaling.PERM_SIGNALING_DISCONNECTION_REQUEST,function(){n.close(!0)}),this._init()}return(0,l.default)(e,[{key:"connect",value:function(e,t){this._url=e,this._id=t,""!==this._url&&this._createConnection()}},{key:"send",value:function(e){if(this._connection&&this._connection.readyState===WebSocket.OPEN){var t=e.receiver_id+","+(0,a.default)(d.default.omit(e,"receiver_id"));switch(this._connection.send(t),this._controlStats.signalingMessagesCount++,e.type){case"webrtc_answer":this._controlStats.sentAnswerSdpVolume+=t.length;break;case"webrtc_offer":this._controlStats.sentOfferSdpVolume+=t.length;break;case"webrtc_icecandidate":this._controlStats.sentIceCandidatesVolume+=t.length;break;default:h.default.notifyError(new Error("Invalid signaling message type sent."))}}else this._msgBuffer.push(e)}},{key:"on",value:function(e,t){this._handlers[e]=t}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isPermanentlyDisconnected=e,this._disposing=!0,this._status.setDisconnectedToSignalingServer(),this._stopReconnectionLoop(),this._connection&&(this._connection.close(),this._connection.onopen=function(){},this._connection.onclose=function(){},this._connection.onmessage=function(){},this._connection.onerror=function(){}),void 0!==this._connectionTimeout&&(this._connectionTimeout.clear(),delete this._connectionTimeout),void 0!==this._nextReconnectAttempt&&(this._nextReconnectAttempt.clear(),delete this._nextReconnectAttempt),this._init()}},{key:"_createConnection",value:function(){if(!this._isPermanentlyDisconnected){this._disposing=!1,!this._connection||this._connection.readyState!==WebSocket.CONNECTING&&this._connection.readyState!==WebSocket.OPEN||this.close(),this._connection=new WebSocket(this._url+"?id="+this._id+"&p2pVersion=4.12.0&client_id="+this._conf.ID_CLIENT);var e=this._connection;this._connectionTimeout=(0,v.createTimeout)(function(){e.close()},1e4),this._handleConnectionSuccess(),this._handleErrorAndClose(),this._handleMessages()}}},{key:"_handleErrorAndClose",value:function(){var e=this,t=this._connection,n=function(n){t===e._connection&&(n&&!n.wasClean&&h.default.notify("Connection to signaling unexpectedly closed - code "+n.code),e._status.setDisconnectedToSignalingServer(),e._tryReconnect())},r=function(){t===e._connection&&(h.default.notify("Unexpected error on signaling connection"),e._status.setDisconnectedToSignalingServer(),e._tryReconnect())};this._connection.onerror=r,this._connection.onclose=n}},{key:"_tryReconnect",value:function(){var e=this,t=function(){delete e._nextReconnectAttempt,e._createConnection(),e._updateDelay()};if(void 0===this._nextReconnectAttempt&&!this._disposing){var n=this._delayReconnection;0===n&&(n=Math.round(Math.random()*this._conf.SIGNALING_DELAY_MAX_INIT)),this._nextReconnectAttempt=(0,v.createTimeout)(t,n)}}},{key:"_updateDelay",value:function(){this._delayReconnection=Math.min(this._delayReconnection+this._conf.SIGNALING_DELAY_STEP,this._conf.SIGNALING_DELAY_MAX)}},{key:"_handleConnectionSuccess",value:function(){var e=this;this._connection.onopen=function(){e._status.setConnectedToSignalingServer(),e._connectionTimeout&&(e._connectionTimeout.clear(),delete e._connectionTimeout),e._stopReconnectionLoop(),e._sendMessagesInBuffer()}}},{key:"_handleMessages",value:function(){var e=this;this._connection.onmessage=function(t){var n=JSON.parse(t.data);if(e._handlers[n.type]){var r=d.default.omit(n,"type");e._handlers[n.type](r)}}}},{key:"_init",value:function(){this._handlers={},this._delayReconnection=0,this._msgBuffer=[]}},{key:"_stopReconnectionLoop",value:function(){this._delayReconnection=0}},{key:"_sendMessagesInBuffer",value:function(){for(var e=0;e<this._msgBuffer.length;e++)this.send(this._msgBuffer[e]);this._msgBuffer=[]}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(14),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(51),d=r(c),f=n(104),h=function(){function e(t,n,r,i,a){(0,s.default)(this,e),this._firstByteCdnTimestamp=null,this._sharedState=t,this._request=n,this._stats=r,this._resultCallback=i.result,this._progressCallback=i.progress,this._range=a}return(0,l.default)(e,[{key:"send",value:function(){var e=this;this._startDownloadCdn=Date.now(),this._p2pAmountOnStart=this._sharedState.transferStats.p2pMediaDownloaded;var t={headers:(0,f.getHttpRequestHeaders)(this._request,this._range),responseType:d.default.ResponseTypes.ARRAY_BUFFER,withCredentials:!!this._request.withCredentials,events:{onprogress:this._onCDNProgress.bind(this)}},n=new d.default(d.default.Methods.GET,this._request.url,t);return n.send().then(function(t){e._calculateAbrStats(t),e._resultCallback(null,t)}).catch(function(t){e._resultCallback(t,null)}),n}},{key:"_onCDNProgress",value:function(e){var t=Date.now();null===this._firstByteCdnTimestamp&&(this._firstByteCdnTimestamp=t,this._sharedState.conf.ENABLE_LATENCY_FEEDBACK&&(this._stats.latency=this._firstByteCdnTimestamp-this._startDownloadCdn)),this._stats.cdnDuration=t-this._startDownloadCdn,this._stats.cdnDownloaded=e.loaded;var n={};if((0,a.default)(n,this._stats),this._sharedState.conf.USE_CONTINOUS_PROGRESS_FEEDBACK)if(e.lengthComputable){var r=e.loaded/e.total;n.p2pDownloaded=Math.round(r*this._stats.p2pDownloaded),n.p2pDuration=Math.round(r*this._stats.p2pDuration)}else n.p2pDownloaded=0,n.p2pDuration=0;this._sharedState.conf.PROGRESS_ADD_TOTAL&&(n.lengthComputable=e.lengthComputable,n.total=e.lengthComputable?e.total+this._stats.p2pDownloaded:0),this._progressCallback(n,this._request)}},{key:"_calculateAbrStats",value:function(e){var t=Date.now();this._stats.cdnDownloaded=e.byteLength||0,this._stats.cdnDuration=t-this._startDownloadCdn;var n=this._sharedState.transferStats.p2pMediaDownloaded-this._p2pAmountOnStart;this._sharedState.abrStats.concurrentP2pDownloaded+=n,this._sharedState.abrStats.cdnEstimationCount++,0!==n&&this._sharedState.abrStats.concurrentP2pDownloadCount++;var r=this._stats.cdnDownloaded+this._stats.p2pDownloaded,i=this._stats.cdnDownloaded/r;if(i>=this._sharedState.conf.ABR_CDN_SPEED_UPDATE_RATIO_THRESHOLD&&this._stats.cdnDownloaded>=this._sharedState.conf.ABR_CDN_DL_THRESHOLD||r<this._sharedState.conf.ABR_CDN_DL_THRESHOLD&&i>=this._sharedState.conf.ABR_CDN_SMALL_SEGMENT_SPEED_UPDATE_RATIO_THRESHOLD){if(this._sharedState.conf.CDN_SPEED_ESTIMATE_CONSIDER_P2P){var a=Math.min(this._stats.cdnDownloaded+n,this._stats.cdnDownloaded*this._sharedState.conf.CDN_CONCURRENT_SCALING_CAP);this._sharedState.abrStats.cdnSpeed=8*a/this._stats.cdnDuration}else this._sharedState.abrStats.cdnSpeed=8*this._stats.cdnDownloaded/this._stats.cdnDuration;this._sharedState.abrStats.cdnTimestamp=Date.now()}}}]),e}();t.default=h,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(52),p=r(_),v=function(e){function t(e,n,r){(0,s.default)(this,t);var i=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,r));return e.controlStats.getSegmentFallback++,i}return(0,h.default)(t,e),(0,l.default)(t,[{key:"_incSuccessStats",value:function(){}}]),t}(p.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(43),h=r(f),_=n(7),p=r(_),v=n(102),E=r(v),m=n(103),S=r(m),g=n(2),T=r(g),y=n(5),C=function(e){function t(e,n,r,i){(0,s.default)(this,t);var o=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,r));return o._partialSegmentProvider=i,o._partialSegment=o._partialSegmentProvider(),o._stats={cdnDownloaded:0,cdnDuration:0,p2pDownloaded:o._partialSegment.p2pAmount,p2pDuration:0===o._partialSegment.p2pSpeed?0:Math.round(o._partialSegment.p2pAmount/o._partialSegment.p2pSpeed*1e3)},e.conf.ENABLE_LATENCY_FEEDBACK&&(o._stats.latency=Math.min(e.abrStats.latencyHistoricalValue,Math.ceil(o._stats.p2pDuration*e.conf.LATENCY_CAPPING_RATIO))),o._segmentFiller=new S.default(e,o._partialSegment),o._segmentFiller.once(T.default.SegmentFiller.SUCCESS,o._onRequestSuccess.bind(o)),o._segmentFiller.once(T.default.SegmentFiller.FALLBACK,o._onRequestFallback.bind(o)),r.onProgress(o._stats,n),o}return(0,p.default)(t,e),(0,l.default)(t,[{key:"_getSegmentImplementation",value:function(){var e=this;this._waitSegmentUnlocked(function(t){t?e._segmentFiller.fillSegment(null):e._onRequestFallback()})}},{key:"_waitSegmentUnlocked",value:function(e){var t=this;if(!this._partialSegment.isLocked())return void e(!0);var n=0,r=(0,y.createInterval)(function(){return t._partialSegment=t._partialSegmentProvider(),t._partialSegment.isLocked()?void((n+=t._sharedState.conf.LOCKED_RETRY_INTERVAL)>t._sharedState.conf.LOCKED_RETRY_TIMEOUT&&(r.clear(),e(!1))):(r.clear(),void e(!0))},this._sharedState.conf.LOCKED_RETRY_INTERVAL)}},{key:"_onRequestSuccess",value:function(e){var n=this;(0,y.createTimeout)(function(){(0,h.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"_onRequestSuccess",n).call(n,e)},0)}},{key:"_abort",value:function(){this._segmentFiller.removeAllListeners(),(0,h.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"_abort",this).call(this)}}]),t}(E.default);t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(52),p=r(_),v=function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"_incSuccessStats",value:function(){}},{key:"_incAbortStats",value:function(){}}]),t}(p.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(43),h=r(f),_=n(7),p=r(_),v=n(52),E=r(v),m=n(103),S=r(m),g=n(2),T=r(g),y=n(104),C=function(e){function t(e,n,r,i){(0,s.default)(this,t);var o=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,r));return o._partialSegment=i,o._stats={cdnDownloaded:0,cdnDuration:0,p2pDownloaded:o._partialSegment.p2pAmount,p2pDuration:0===o._partialSegment.p2pSpeed?0:Math.round(o._partialSegment.p2pAmount/o._partialSegment.p2pSpeed*1e3)},o._segmentFiller=new S.default(e,i),o._segmentFiller.once(T.default.SegmentFiller.SUCCESS,o._onRequestSuccess.bind(o)),o._segmentFiller.once(T.default.SegmentFiller.FALLBACK,o._onRequestFallback.bind(o)),e.eventBus.emit(T.default.SRModuleInterface.UNCOMPLETE_SEGMENT_REQUESTED),
o}return(0,p.default)(t,e),(0,l.default)(t,[{key:"_getRange",value:function(){var e=(0,y.getRangeFromRequest)(this._request);return this._rangeToDownload=this._partialSegment.getUpdatedRange(e),this._rangeToDownload}},{key:"_checkResponseSize",value:function(e){if(!this._rangeToDownload)return!0;var t=void 0;if(void 0===this._rangeToDownload.end){if(0===this._rangeToDownload.start)return!0;if(!this._partialSegment.byteLength)return!0;t=this._partialSegment.byteLength-this._rangeToDownload.start}else t=Number(this._rangeToDownload.end)-this._rangeToDownload.start+1;return t===e.byteLength?(this._sharedState.moduleState.rangeRequestStatus.setEnabled(),!0):(this._sharedState.moduleState.rangeRequestStatus.setDisabledBecauseWrongRange(),!1)}},{key:"_onHttpSuccess",value:function(e){this._sharedState.conf.ENABLE_RANGE_REQUEST_DETECTION?this._checkResponseSize(e)?this._segmentFiller.fillSegment(e):this._onRequestFallback(new Error("Mismatch in expected and received RR responce byteLength. Fallback to full CDN download.")):this._segmentFiller.fillSegment(e)}},{key:"_abort",value:function(){this._segmentFiller.removeAllListeners(),(0,h.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"_abort",this).call(this)}}]),t}(E.default);t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(43),h=r(f),_=n(7),p=r(_),v=n(52),E=r(v),m=n(97),S=(r(m),n(96)),g=r(S),T=function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,p.default)(t,e),(0,l.default)(t,[{key:"_getRange",value:function(){return{start:0}}},{key:"_onHttpError",value:function(e){e.message===g.default.Errors.REQUEST_ERROR&&this._sharedState.moduleState.rangeRequestStatus.setDisabledBecauseNoCors(),this._onRequestFallback()}},{key:"_onHttpSuccess",value:function(e){this._sharedState.moduleState.rangeRequestStatus.setProbably(),(0,h.default)(t.prototype.__proto__||(0,a.default)(t.prototype),"_onHttpSuccess",this).call(this,e)}}]),t}(E.default);t.default=T,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n,r,i){function a(e){o.default.notifyError(e)}var s=(0,m.default)(t,r,i);s.onFallback=function(e){e&&a(e),new c.default(t,n,s).getSegment()};try{if(null===i)return new u.default(t,n,s);if(t.conf.ENABLE_RANGE_REQUEST_DETECTION&&t.moduleState.rangeRequestStatus.isUnknown&&t.bufferStats.bufferedAmount>=t.conf.RR_DETECTION_MIN_BUFFER_LEVEL)return new v.default(t,n,s);var l=function(){return e.getP2PData(i)},d=l();return d.isComplete()?new f.default(t,n,s,l):new _.default(t,n,s,d)}catch(e){return a(e),new c.default(t,n,s)}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=r(a),s=n(223),u=r(s),l=n(221),c=r(l),d=n(222),f=r(d),h=n(224),_=r(h),p=n(225),v=r(p),E=n(227),m=r(E);t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return{onSuccess:function(n,r,i){if((0,c.default)(r,e.abrStats,e.conf),e.conf.ENABLE_LATENCY_FEEDBACK){var a=r.latency||e.abrStats.latencyHistoricalValue;r.latency=Math.min(a,Math.ceil((r.cdnDuration+r.p2pDuration)*e.conf.LATENCY_CAPPING_RATIO))}e.transferStats.p2pConsumed+=r.p2pDownloaded,e.transferStats.cdnConsumed+=r.cdnDownloaded;var s=n.slice(0),l=function(){t.onSuccess(s,r,i)};if(e.conf.ENABLE_FUNNEL_GETSEGMENT_CALLBACKS)try{l()}catch(e){o.default.notifyError(e)}else l();e.eventBus.emit(u.default.SRModuleInterface.ABR_FEEDBACK,r),e.eventBus.emit(u.default.SRModuleInterface.SEGMENT_TRANSFERED_TO_MEDIA_ENGINE)},onError:function(n,r){if(e.conf.ENABLE_FUNNEL_GETSEGMENT_CALLBACKS)try{t.onError(n,r)}catch(e){o.default.notifyError(e)}else t.onError(n,r)},onProgress:function(n,r){if(e.conf.ENABLE_FUNNEL_GETSEGMENT_CALLBACKS)try{t.onProgress(n,r)}catch(e){o.default.notifyError(e)}else t.onProgress(n,r)},onFallback:function(){throw new Error("Cannot call abstract method")}}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),o=r(a),s=n(2),u=r(s),l=n(186),c=r(l);t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e)}return(0,s.default)(e,[{key:"viewToString",value:function(){return""}},{key:"isEqual",value:function(e){return!1}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(105),p=r(_),v=function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.audio;t&&(e=this._getSegmentsToDownloadByTrack(t,"audio"),this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM&&(e=e.slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER)));var n=[],r=this._currentTracks.video;return r&&(n=this._getSegmentsToDownloadByTrack(r,"video"),this._sharedState.conf.ENABLE_P2P_SCHEDULER_OPTIM&&(n=n.slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER))),this._cachedSegmentToDownload=e.concat(n).sort(function(e,t){return e.getId()-t.getId()}).slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER),this._cachedSegmentToDownload}},{key:"updateTrackEdge",value:function(e){var t=this._findTrack(e);"audio"===t?this._edges.update({audio:e,video:null}):"video"===t&&this._edges.update({audio:null,video:e})}},{key:"_findTrack",value:function(e){var t=this._currentTracks.video;if(t&&e.isInTrack(t))return"video";var n=this._currentTracks.audio;return n&&e.isInTrack(n)?"audio":void 0}}]),t}(p.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(105),p=r(_),v=function(e){function t(){return(0,s.default)(this,t),(0,d.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,l.default)(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.video;return t&&(e=this._getSegmentsToDownloadByTrack(t,"video")),this._cachedSegmentToDownload=e.sort(function(e,t){return e.getId()-t.getId()}).slice(0,this._sharedState.conf.NB_SEGMENT_P2P_PREBUFFER),this._cachedSegmentToDownload}},{key:"updateTrackEdge",value:function(e){this._currentTracks.video&&e.isInTrack(this._currentTracks.video)&&this._edges.update({video:e,audio:null})}}]),t}(p.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(18),l=(r(u),n(2)),c=r(l),d=n(39),f=r(d),h=n(111),_=r(h),p=n(112),v=r(p),E=.1,m=10,S=function(){function e(t){var n=this;(0,a.default)(this,e),this._bandwidthEstimates=[],this._latencyHistory=new v.default(m),this.cdnSpeed=null,this.cdnTimestamp=null,this.p2pSpeed=0,this.estimatedBitrate=0,this.p2pUsefulEstimate=1,this.concurrentP2pDownloaded=0,this.concurrentP2pDownloadCount=0,this.cdnEstimationCount=0,this.zeroP2pSpeedWindowsCount=0,this.p2pSpeedWindowsCount=0,this.feebackCount=0,this.zeroDurationFeedbackCount=0,this.trackSwitchWithPeers=0,this._addBandwidthEstimate=function(e){n.feebackCount++;var t=e.p2pDuration+e.cdnDuration;if(0===t)return void n.zeroDurationFeedbackCount++;var r=e.p2pDownloaded+e.cdnDownloaded/t;n._bandwidthEWMA?n._bandwidthEWMA.update(r):n._bandwidthEWMA=new f.default(r,E),n._bandwidthEstimates.push(n._bandwidthEWMA.value),null!=e.latency&&e.cdnDownloaded>0&&n._latencyHistory.addSample(e.latency)},this._eventBus=t,this._eventBus.on(c.default.SRModuleInterface.ABR_FEEDBACK,this._addBandwidthEstimate)}return(0,s.default)(e,[{key:"flushBandwidthEstimates",value:function(){this._bandwidthEstimates=[]}},{key:"dispose",value:function(){this.flushBandwidthEstimates()}},{key:"bandwidthEstimateCV",get:function(){var e=_.default.meanAbsoluteDeviation(this._bandwidthEstimates),t=_.default.mean(this._bandwidthEstimates);return e&&t&&0!==t?e/t:0}},{key:"latencyHistoricalValue",get:function(){return 0===this._latencyHistory.length?50:Math.round(this._latencyHistory.mean)}}]),e}();t.default=S,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(2),l=r(u),c=n(101),d=r(c),f=n(73),h=r(f),_=function(){function e(t){(0,a.default)(this,e),this._alwaysDynamicBuffer=!0,this._lastLowBuffer=0,this.bufferRefill=0,this.bufferedAmount=0,this.lowerBufferTargetNetChangePerRebound=0,this.sampledHighLowBufferTargetGap=0,this._timeSpentOnEdgeStaircase=new h.default,this._timeSpentWithoutPeerStaircase=new h.default,this._timeSpentDynamicStaircase=new h.default,this._timeSpentTopSeederStaircase=new h.default,this.timeLowerTargetAboveLiveEdgeStaircase=new h.default,this._globalEventBus=t,this._globalEventBus.on(l.default.Scheduler.REACHED_LIVE_EDGE_STATE_CHANGED,this._onLiveEdgeChanged.bind(this)),this._globalEventBus.on(l.default.BufferManager.LOW_BUFFER,this._onLowBuffer.bind(this)),this._globalEventBus.on(l.default.BufferManager.HIGH_BUFFER,this._onHighBuffer.bind(this)),this._globalEventBus.on(l.default.BufferManager.STATE_CHANGED,this._onBufferStateChange.bind(this))}return(0,s.default)(e,[{key:"_onLiveEdgeChanged",value:function(e){var t=e?1:0;this._timeSpentOnEdgeStaircase.updateMetric(t)}},{key:"_onBufferStateChange",value:function(e,t){switch(e){case d.default.NO_PEER:this._timeSpentWithoutPeerStaircase.updateMetric(0);break;case d.default.DYNAMIC:this._timeSpentDynamicStaircase.updateMetric(0);break;case d.default.TOP_SEEDER:this._timeSpentTopSeederStaircase.updateMetric(0)}switch(t){case d.default.NO_PEER:this._timeSpentWithoutPeerStaircase.updateMetric(1),e!==d.default.IDLE&&(this._alwaysDynamicBuffer=!1);break;case d.default.DYNAMIC:this._timeSpentDynamicStaircase.updateMetric(1);break;case d.default.TOP_SEEDER:this._timeSpentTopSeederStaircase.updateMetric(1),this._alwaysDynamicBuffer=!1;break;case d.default.RANDOM:this._alwaysDynamicBuffer=!1}this.bufferState=t}},{key:"_onLowBuffer",value:function(e){this._lastLowBuffer=e}},{key:"_onHighBuffer",value:function(e){this.bufferRefill+=e-this._lastLowBuffer}},{key:"_resetDynamicFlag",value:function(){this._alwaysDynamicBuffer=this.bufferState===d.default.DYNAMIC}},{key:"getTimeSpentOnEdgeRatio",value:function(){return this._timeSpentOnEdgeStaircase.getAverage()}},{key:"getTimeSpentWithoutPeerRatio",value:function(){return this._timeSpentWithoutPeerStaircase.getAverage()}},{key:"getTimeSpentTopSeederRatio",value:function(){return this._timeSpentTopSeederStaircase.getAverage()}},{key:"getTimeSpentDynamicIntegral",value:function(){return this._timeSpentDynamicStaircase.getIntegral()}},{key:"alwaysDynamicBuffer",get:function(){var e=void 0;return e=this.bufferState!==d.default.NO_PEER&&this._alwaysDynamicBuffer,this._resetDynamicFlag(),e}}]),e}();t.default=_,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._sampledIceGatheringDuration=0,this.missedIceCandidateCount=0,this.gatheredIceCandidateCount=0,this.iceCandidatesBucketCount=0,this.earlyIceGatheringFinishedCount=0,this.newPeerConnectionCount=0,this.nbRightHashP2P=0,this.nbWrongHashP2P=0,this.nbRightHashDLM=0,this.nbWrongHashDLM=0,this.checkHeartbeatFailed=0,this.getSegmentSuccess=0,this.getSegmentFallback=0,this.signalingMessagesCount=0,this.sentOfferSdpVolume=0,this.sentAnswerSdpVolume=0,this.sentIceCandidatesVolume=0,this.sentDistributorRootCount=0,this.sentTrackerInitCount=0,this.sentTrackerPeersCount=0,this.sentTrackerTracksCount=0}return(0,s.default)(e,[{key:"getSampledIceGatheringDuration",value:function(){var e=this._sampledIceGatheringDuration;return this._sampledIceGatheringDuration=0,e}},{key:"setSampledIceGatheringDuration",value:function(e){0===this._sampledIceGatheringDuration&&(this._sampledIceGatheringDuration=e)}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r),a=function e(){(0,i.default)(this,e),this.receivedChunkRequestCount=0,this.dequeuedReceivedChunkRequestCount=0,this.missedDequeuedChunkRequestCount=0,this.safeChunkRequestCount=0,this.unsafeChunkRequestCount=0,this.safeChunkRequestTimeoutCount=0,this.unsafeChunkRequestTimeoutCount=0,this.gracedChunksCount=0,this.expiredGraceChunksCount=0};t.default=a,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(10),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(66),d=r(c),f=function(){function e(t,n,r){(0,s.default)(this,e),this.abortFragmentCount=0,this.emergencyTrackSwitchCount=0,this.maxBitrate=0,this.minBitrate=0,this.playbackErrorCount=0,this.mediaElementSet=0,this.mediaElementChanged=0,this._playerInterface=t,this._mediaElementPlaceholder=n,this._mediaMap=r}return(0,l.default)(e,[{key:"dispose",value:function(){this._mediaMap=new d.default}},{key:"duration",get:function(){return!this._playerInterface.isLive()&&this._mediaElementPlaceholder.mediaElement?this._mediaElementPlaceholder.mediaElement.duration:0}},{key:"videoTrackCount",get:function(){var e=this._mediaMap.getTrackList(),t=0,n=!0,r=!1,i=void 0;try{for(var o,s=(0,a.default)(e);!(n=(o=s.next()).done);n=!0){var u=o.value;if((!u.type||"video"===u.type)&&(t++,u.bitrate)){var l=u.bitrate;this.maxBitrate=Math.max(this.maxBitrate,l),this.minBitrate=0===this.minBitrate?l:Math.min(this.minBitrate,l)}}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return t}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(34),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(73),d=r(c),f=n(106),h=r(f),_=n(107),p=(r(_),n(112)),v=r(p),E=n(252),m=r(E),S=20,g=10,T=10,y=20,C=function(){function e(t){(0,s.default)(this,e),this.match=0,this.excessMatch=0,this.offer=0,this.openedMatch=0,this.openedOffer=0,this.unansweredOffer=0,this.active=0,this.transfer=0,this.denied=0,this.droppedSameTrack=0,this.droppedOtherTrack=0,this.offerTimeout=0,this.answerTimeout=0,this.timeoutNewConnection=0,this.timeoutCheckingConnection=0,this.timeoutFailedConnection=0,this.timeoutNewIce=0,this.timeoutGatheringIce=0,this.timeoutCompleteIce=0,this.disconnected=0,this.lateMessage=0,this.exclusionSize=0,this.timeoutLocalSdp=0,this.timeoutRemoteSdp=0,this.timeoutLocalSdpWithStun=0,this.timeoutRemoteSdpWithStun=0,this.timeoutWithLocalStunIce=0,this.timeoutWithRemoteStunIce=0,this.residualDisconnectedPeerDuration=0,this._statsProvider=t,this.peerPoolUploadCapacity=new d.default,this.locked=new d.default,this.loosers=new d.default,this.successPeerConnectionAttemptDuration=new v.default(S),this.failedPeerConnectionAttemptDuration=new v.default(S),this.dataChannelBufferEmptyingStats=new m.default(g),this.endedConnectionP2pRttSamples=new v.default(T),this.sampledPeerStats=new m.default(y)}return(0,l.default)(e,[{key:"incrementTimeout",value:function(e,t,n,r){switch(n?this.offerTimeout++:this.answerTimeout++,r.hasLocalDescription&&this.timeoutLocalSdp++,r.hasRemoteDescription&&this.timeoutRemoteSdp++,r.hasLocalDescriptionWithStun&&this.timeoutLocalSdpWithStun++,r.hasRemoteDescriptionWithStun&&this.timeoutRemoteSdpWithStun++,r.hasLocalStunIceCandidate&&this.timeoutWithLocalStunIce++,r.hasRemoteStunIceCandidate&&this.timeoutWithRemoteStunIce++,e){case"new":this.timeoutNewConnection++;break;case"checking":this.timeoutCheckingConnection++;break;case"failed":this.timeoutFailedConnection++}switch(t){case"new":this.timeoutNewIce++;break;case"gathering":this.timeoutGatheringIce++;break;case"complete":this.timeoutCompleteIce++}}},{key:"sampledPUC",get:function(){return this._statsProvider.getStat(h.default.PeerStats.SAMPLED_PUC)}},{key:"sampledP2pMeanRtt",get:function(){var e=this._statsProvider.getStat(h.default.PeerStats.SAMPLED_LIVE_CONNECTION_RTT),t=[].concat((0,a.default)(this.endedConnectionP2pRttSamples.sampleList),(0,a.default)(e));return t.length>0?t[Math.floor(Math.random()*t.length)]:0}},{key:"totalConnectionDuration",get:function(){var e=this._statsProvider.getStat(h.default.PeerStats.TOTAL_CONNECTION_DURATION)+this.residualDisconnectedPeerDuration;return this.residualDisconnectedPeerDuration=0,e}}]),e}();t.default=C,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._p2pUseful=0,this.cdnDownloaded=0,this.p2pConsumed=0,this.cdnConsumed=0,this.p2pMediaDownloaded=0,this.p2pHeadersDownloaded=0,this.p2pMessagesDownloaded=0,this.p2pMessagesCount=0,this.p2pUploaded=0,this.multipleDlPP=0,this.multipleDlPC=0,this.multipleDlCP=0,this.multipleDlCC=0,this.multipleDlHP=0,this.multipleDlHD=0,this.multipleDlM=0}return(0,s.default)(e,[{key:"p2pUseful",get:function(){return this._p2pUseful},set:function(e){if(e<this._p2pUseful)throw new TypeError("p2pUseful increment is not a positive number");this._p2pUseful=e}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CurrentTracks=void 0;var i=n(117),a=r(i),o=n(33),s=r(o),u=n(0),l=r(u),c=n(1),d=r(c),f=n(2),h=r(f);t.CurrentTracks=function(){function e(t){(0,l.default)(this,e),this.audio=void 0,this.video=void 0,this._globalEventBus=t,this._lastSwitchTimestamp=s.default,(0,a.default)(this)}return(0,d.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(!t&&!n)throw new Error("There must be at least one updated track");!t||this.audio&&this.audio.viewToString()===t.viewToString()||(this.audio=t,this._globalEventBus.emit(h.default.Metrics.TRACK_SWITCH,{isVideo:!1})),!n||this.video&&this.video.viewToString()===n.viewToString()||(this.video=n||this.video,this._lastSwitchTimestamp=Date.now(),this._globalEventBus.emit(h.default.Metrics.TRACK_SWITCH,{isVideo:!0}))}},{key:"lastSwitchTimestamp",get:function(){return this._lastSwitchTimestamp}}]),e}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(56),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(188),d=r(c),f=n(199),h=r(f),_=n(50),p=(n(229),n(67)),v=r(p),E=function(){function e(t,n,r,i,o){(0,s.default)(this,e),(0,_.checkInterface)(v.default,t),this.segmentCoord=t,this.chunkManager=new d.default(t,n,r,i,o),this.seeders=new h.default(o.conf),(0,a.default)(this)}return(0,l.default)(e,[{key:"dispose",value:function(){this.chunkManager.dispose(),this.seeders.clear()}},{key:"hasChunksToDownload",get:function(){return this.chunkManager.hasChunksToDownload}}]),e}();t.default=E,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(117),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(4),d=r(c),f=function(){function e(t,n){(0,s.default)(this,e),this.audio=void 0,this.video=void 0,this._mediaMapCache=t,this._moduleState=n.moduleState,(0,a.default)(this)}return(0,l.default)(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(void 0===t&&void 0===n)throw new Error("There must be at least one updated track edge");if(t&&(this.audio=t,this._moduleState.audioTrackEdge=t),n){this.video=n;var r=this._mediaMapCache.getSegmentTime(n);this._moduleState.videoTrackEdge=n,null!==r?this._moduleState.videoCurrentTime=r:d.default.notifyError(new Error("Unexpected getSegmentTime error: track edge timestamp is not supposed to be unreliable"))}}}]),e}();t.default=f,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=n(55),l=r(u),c=function(){function e(t){(0,a.default)(this,e),this._safeQueue=[],this._unsafeQueue=[],this._sharedState=t}return(0,s.default)(e,[{key:"push",value:function(e){this._sharedState.conf.SPLIT_UPLOAD_QUEUE&&e.bandwidthSafety!==l.default.SAFE?this._unsafeQueue.push(e):this._safeQueue.push(e)}},{key:"shift",value:function(){return this._safeQueue.length?this._safeQueue.shift():this._unsafeQueue.shift()}},{key:"dispose",value:function(){this._safeQueue=[],this._unsafeQueue=[]}},{key:"length",get:function(){return this._safeQueue.length+this._unsafeQueue.length}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(98),p=r(_),v=function(e){function t(e,n,r,i){(0,s.default)(this,t);var o=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,i));return o._sharedState=r,o}return(0,h.default)(t,e),(0,l.default)(t,[{key:"isExpired",get:function(){var e=this._sharedState.moduleState.isLive()?this._sharedState.conf.LIVE.CHUNK_UP_TIMEOUT:this._sharedState.conf.CHUNK_UP_TIMEOUT;return Date.now()-this._timestamp>e}}]),t}(p.default);t.default=v,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(242),p=r(_),v=n(110),E=r(v),m=n(2),S=r(m),g=function(e){function t(e,n){(0,s.default)(this,t);var r=new p.default(n),i=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,r));return i._dataUploaded=0,i._onTransfering=function(){},i._lastBufferedAmountMaxTimestamp=null,i._bufferedAmountAccumulator=0,i._peerConnection=e,i._sharedState=n,i._peerConnection.onbufferedamountlow=i._onBufferedAmountLow.bind(i),i._splittedQueue=r,i}return(0,h.default)(t,e),(0,l.default)(t,[{key:"_validateItem",value:function(e){return!e.isExpired}},{key:"_dequeuedCallback",value:function(e){this._sharedState.efficiencyStats.dequeuedReceivedChunkRequestCount++,this._sharedState.eventBus.emit(S.default.UploadQueue.CHUNK_REQUESTED,this,e)}},{key:"onChunkFound",value:function(e,t){var n=t.byteLength;this._lastBufferedAmountMaxTimestamp&&(this._bufferedAmountAccumulator+=n),this._peerConnection.sendBinaryData(t,e)&&(this._dataUploaded+=n,this._sharedState.transferStats.p2pUploaded+=n,this._onTransfering())}},{key:"onChunkMissed",value:function(){this._sharedState.efficiencyStats.missedDequeuedChunkRequestCount++,this._sharedState.conf.ENABLE_UPLOAD_DEQUEUE_ALL||this.tryDequeue()}},{key:"_canDequeue",value:function(){var e=this._peerConnection.getBufferedAmount()<=this._sharedState.conf.UP_MAX_BUFFERED_AMOUNT;return e||(this._lastBufferedAmountMaxTimestamp=Date.now(),this._bufferedAmountAccumulator=this._peerConnection.getBufferedAmount()),e}},{key:"_onBufferedAmountLow",value:function(){if(this._lastBufferedAmountMaxTimestamp){var e=Date.now()-this._lastBufferedAmountMaxTimestamp;e>0&&this._sharedState.peerStats.dataChannelBufferEmptyingStats.addSample({time:e,amount:this._bufferedAmountAccumulator}),this._lastBufferedAmountMaxTimestamp=null}this._sharedState.conf.ENABLE_UPLOAD_DEQUEUE_ALL?this.tryDequeueAll():this.tryDequeue()}},{key:"dispose",value:function(){this._onTransfering=function(){},this._peerConnection.onbufferedamountlow=function(){},this._splittedQueue.dispose()}},{key:"dataUploaded",get:function(){return this._dataUploaded}},{key:"onTransfering",set:function(e){this._onTransfering=e}}]),t}(E.default);t.default=g,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=void 0;u=n(247);var l=function(){function e(){(0,a.default)(this,e),this._disposed=!1}return(0,s.default)(e,[{key:"callHashWorker",value:function(e,t){var n=this;return u(e,function(){n._disposed||t.apply(void 0,arguments)})}},{key:"dispose",value:function(){this._disposed=!0}}]),e}();t.default=l,e.exports=t.default},function(e,t,n){"use strict";function r(){var e={mul32:function(e,t){var n=65535&t;return((t-n)*e|0)+(n*e|0)|0},hashBytes:function(e,t,n){for(var r=3432918353,i=461845907,a=n,o=-4&t,s=0;s<o;s+=4){var u=255&e[s]|(255&e[s+1])<<8|(255&e[s+2])<<16|(255&e[s+3])<<24;u=this.mul32(u,r),u=(131071&u)<<15|u>>>17,u=this.mul32(u,i),a^=u,a=(524287&a)<<13|a>>>19,a=5*a+3864292196|0}switch(u=0,t%4){case 3:u=(255&e[o+2])<<16;case 2:u|=(255&e[o+1])<<8;case 1:u|=255&e[o],u=this.mul32(u,r),u=(131071&u)<<15|u>>>17,u=this.mul32(u,i),a^=u}return a^=t,a^=a>>>16,a=this.mul32(a,2246822507),a^=a>>>13,a=this.mul32(a,3266489909),a^=a>>>16}};self.onmessage=function(t){var n=new Uint8Array(t.data.segmentData),r=e.hashBytes(n,n.length,0).toString();self.postMessage({segmentData:t.data.segmentData,jobIndex:t.data.jobIndex,hash:r},[t.data.segmentData])}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(e){var t=e.data,n=t.jobIndex,r=t.segmentData,i=t.hash,a=s[n];delete s[n],a(r,i)}function i(e,t){var n=s.push(t)-1;u.postMessage({segmentData:e,jobIndex:n},[e])}Object.defineProperty(t,"__esModule",{value:!0});var a=n(246),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=[],u=function(){try{var e=URL.createObjectURL(new Blob(["("+o.default.toString()+")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}catch(e){return{onerror:null,onmessage:null,postMessage:function(){},terminate:function(){}}}}();u.onmessage=r,t.default=i,e.exports=t.default},function(e,t,n){"use strict";function r(e,t){var n=t.chunkIndex,r=t.segmentCoord,i=r.toArrayBuffer(),o=(0,a.numToUint8Array4)(n),s=e.byteLength,u=(0,a.uint16ToUint8Array2)(s),l=new Uint8Array(o.byteLength+u.byteLength+s+i.byteLength);return l.set(o,0),l.set(u,4),l.set(new Uint8Array(e),6),l.set(new Uint8Array(i),6+s),l.buffer}function i(e,t){var n=e.slice(0,4),r=e.slice(4,6),i=new Uint16Array(r)[0],a=e.slice(6,6+i),o=e.slice(6+i),s=new Uint32Array(n)[0];return{segmentCoord:t(o),chunkIndex:s,data:a}}Object.defineProperty(t,"__esModule",{value:!0}),t.parseMetaData=t.encodeMetaData=void 0;var a=n(70);t.encodeMetaData=r,t.parseMetaData=i},function(e,t,n){"use strict";function r(e,t){if("string"!=typeof e||!e.length)throw new TypeError(t)}function i(e){var t=e.contentUrl,n=e.contentId;if(null!==n&&void 0!==n)return r(n,"Unvalid p2pConfig property: contentId needs to be a non-empty string"),n;r(t,"Unvalid PeerAgent constructor argument: contentUrl needs to be a non-empty string");var i=new o.default(t);return i.host+i.pathname}Object.defineProperty(t,"__esModule",{value:!0}),t.formatContentId=void 0;var a=n(357),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.formatContentId=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e),this._runningAverage=0,this._count=0}return(0,s.default)(e,[{key:"addSample",value:function(e){this._count++,this._runningAverage+=(e-this._runningAverage)/this._count}},{key:"mean",get:function(){return this._runningAverage}},{key:"count",get:function(){return this._count}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){if(null===e.mediaElement)return 0;for(var t=e.mediaElement.buffered,n=e.mediaElement.currentTime,r=n,a=0;a<t.length;a++)t.start(a)<r+i&&t.end(a)>r&&(r=t.end(a));return r-n}Object.defineProperty(t,"__esModule",{value:!0});var i=.3;t.default={getBufferedAmount:r},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(t){(0,a.default)(this,e),this._maxSize=t,this._internalQueue=[]}return(0,s.default)(e,[{key:"addSample",value:function(e){this._internalQueue.length>=this._maxSize&&this._internalQueue.shift(),this._internalQueue.push(e)}},{key:"fetchSample",value:function(){if(this._internalQueue.length>0){var e=Math.floor(Math.random()*this._internalQueue.length);return this._internalQueue.splice(e,1)[0]}}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),a=r(i),o=n(1),s=r(o),u=function(){function e(){(0,a.default)(this,e),this.reset()}return(0,s.default)(e,[{key:"reset",value:function(){this._startActiveTimestamp=null,this._accumulatedActiveTime=0}},{key:"activate",value:function(){this.isActive||(this._startActiveTimestamp=Date.now())}},{key:"deactivate",value:function(){this.isActive&&(this._accumulatedActiveTime+=Date.now()-this._startActiveTimestamp,this._startActiveTimestamp=null)}},{key:"accumulatedActiveTime",get:function(){var e=this.isActive?Date.now()-this._startActiveTimestamp:0;return this._accumulatedActiveTime+e}},{key:"isActive",get:function(){return null!==this._startActiveTimestamp}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),a=r(i),o=n(57),s=r(o),u=n(10),l=r(u),c=n(15),d=r(c),f=n(0),h=r(f),_=n(1),p=r(_),v=n(255),E=r(v),m=function(){function e(){(0,h.default)(this,e),this._activeBlockKey=null,this._blockList=new d.default}return(0,p.default)(e,[{key:"_cleanExpiredBlocks",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,l.default)(this._blockList.entries());!(e=(r=i.next()).done);e=!0){var a=(0,s.default)(r.value,2),o=a[0];a[1].active||(this._blockList.delete(o),o===this._activeBlockKey&&(this._activeBlockKey=null))}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"_updateActiveBlock",value:function(){var e=null,t=a.default,n=!0,r=!1,i=void 0;try{for(var o,u=(0,l.default)(this._blockList.entries());!(n=(o=u.next()).done);n=!0){var c=(0,s.default)(o.value,2),d=c[0],f=c[1];f.endTimestamp>t&&(e=d,t=f.endTimestamp)}}catch(e){r=!0,i=e}finally{try{!n&&u.return&&u.return()}finally{if(r)throw i}}this._activeBlockKey=e}},{key:"block",value:function(e,t){this._cleanExpiredBlocks();var n=this.lookupTimedBlock(t);n?n.extend(e):(n=new E.default(e),this._blockList.set(t,n)),(!this.activeBlock||n.endTimestamp>this.activeBlock.endTimestamp)&&(this._activeBlockKey=t)}},{key:"unblock",value:function(e){return this._cleanExpiredBlocks(),!!this._blockList.delete(e)&&(e===this._activeBlockKey&&this._updateActiveBlock(),!0)}},{key:"unblockAll",value:function(){this._activeBlockKey=null,this._blockList.clear()}},{key:"lookupTimedBlock",value:function(e){return this._blockList.get(e)}},{key:"blocked",get:function(){return!!this.activeBlock&&this.activeBlock.active}},{key:"activeBlock",get:function(){return this._activeBlockKey?this.lookupTimedBlock(this._activeBlockKey):null}}]),e}();t.default=m,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(33),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=function(){function e(t){(0,s.default)(this,e),this._endTimestamp=a.default,this.extend(t)}return(0,l.default)(e,[{key:"extend",
value:function(e){var t=Date.now()+e;t>this._endTimestamp&&(this._endTimestamp=t)}},{key:"active",get:function(){return Date.now()<this._endTimestamp}},{key:"endTimestamp",get:function(){return this._endTimestamp}},{key:"remainingTime",get:function(){var e=this._endTimestamp-Date.now();return e>0?e:0}}]),e}();t.default=c,e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){if(void 0!==t.backendUrl&&(e.DISTRIBUTOR.URL=t.backendUrl,e.DISTRIBUTOR.OVERRIDDEN=!0),t.cacheSize&&(e.P2P_CACHE_MAX_SIZE=1024*t.cacheSize*1024,e.LIVE.P2P_CACHE_MAX_SIZE=e.P2P_CACHE_MAX_SIZE),void 0!==t.activateP2P&&(e.ALLOW_P2P=!!t.activateP2P),void 0!==t.debug&&(e.DEBUG=!!t.debug),t.signalingUrl&&(e.SIGNALING_URL=t.signalingUrl),t.trackerUrl&&(e.TRACKER_URL=t.trackerUrl),t.analyticsUrl&&(e.ANALYTICS.KLARA_URL=t.analyticsUrl),t.deviceInfo&&(e.DEVICE_INFO=t.deviceInfo),void 0!==t.rangeRequestEnabled&&(e.RANGE_REQUEST_DETECTION=!!t.rangeRequestEnabled),void 0!==t.enableStunServers&&(e.ENABLE_STUN=!!t.enableStunServers),!t.streamrootKey)throw new Error("There must be a streamrootKey in the P2PConfig object");e.ID_CLIENT=t.streamrootKey,e.ENABLE_MOBILE_BROWSER=!!t.mobileBrowserEnabled,e.P2P_PROTOCOL_VERSION+="-"+n}function a(e){return e.substr(e.lastIndexOf(".")+1)}function o(e,t,n){if(m.has(n))E.default.notify("Attempt to inject non-injectable "+n+".");else{var r=a(n);e[r]=t[r]}}function s(e,t,n){/^MOBILE.*/.test(n)||E.default.notify("Conf-injecting key "+n+" not exist in default conf.")}function u(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";(0,h.default)(t).forEach(function(a){var o=""===i?a:i+"."+a;void 0!==e[a]?"object"!==(0,d.default)(t[a])||Array.isArray(t[a])?n(e,t,o):u(e[a],t[a],n,r,o):r(e,t,o)})}function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return void 0===t.CONF_LABEL?void E.default.notify("Received config from distributor, but no CONF_LABEL was present"):(u(e,t,o,s),n&&(e.P2P_PROTOCOL_VERSION+="-"+e.CONF_LABEL),void 0!==t.CHUNK_SIZE&&(e.P2P_PROTOCOL_VERSION+="-cz"+t.CHUNK_SIZE),void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.overloadConfigFromDistributor=t.overloadP2PConfig=void 0;var c=n(26),d=r(c),f=n(42),h=r(f),_=n(75),p=r(_),v=n(4),E=r(v),m=new p.default(["TRACKER_URL","SIGNALING_URL","FALLBACK_URLS.KLARA_URL","DISTRIBUTOR.URL","DISTRIBUTOR.OVERRIDDEN","DISTRIBUTOR.TIMEOUT_DELAY","DISTRIBUTOR.MAX_RETRY","SIGNALING_DELAY_STEP","SIGNALING_DELAY_MAX","SIGNALING_DELAY_MAX_INITIAL","TRACKER_DELAY_MAX","TRACKER_DELAY_INIT","SEND_TRACKS_INTERVAL","ANALYTICS.KLARA_URL","ANALYTICS.RETRY_NUMBER","ANALYTICS.RETRY_DELAY","ANALYTICS.TIMEOUT_DELAY","ANALYTICS.TRAFFIC_INTERVAL_ARRAY","ANALYTICS.STATS_INTERVAL","ANALYTICS.CONTROL_INTERVAL","QOS_P2P_DISABLED","ERRORS.API_KEY","ERRORS.HANDLER","ERRORS.STAGES","PEER_CONNECTION_TIMEOUT","SEND_HEARTBEAT_INTERVAL","CHECK_HEARTBEAT_INTERVAL","CLIENT_TRACKER_PROTOCOL_VERSION","P2P_PROTOCOL_VERSION","MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH","GETSEGMENTTIME_CACHE_MAX_SIZE","BUFFER_CHECK_INTERVAL","SPEED_MONITOR_INTERVAL","MEAN_SPEED_CALCULATION_INTERVAL","PEER_COMPUTE_RTT_INTERVAL","BITRATE_ESTIMATION_WINDOW","LATENCY_CAPPING_RATIO","LOCKED_RETRY_INTERVAL","LOCKED_RETRY_TIMEOUT","TIMEOUT_GET_FULL_SEGMENT","RETURN_COPY_SEGMENT","ALLOW_P2P","DEVICE_INFO","ID_CLIENT","ENABLE_MOBILE_BROWSER","CONTENT_ACTIVATED","RAMP_UP_ACTIVATED","DEBUG","ANALYTICS.ENABLE_STATS_SENDER","ANALYTICS.ENABLE_CONTROL_SENDER"]);t.overloadP2PConfig=i,t.overloadConfigFromDistributor=l},function(e,t,n){"use strict";function r(e){if(/Android.* Chrome\/[0-9.]+ /.test(e)){if(-1!==e.indexOf("wv"))return!0;if(/ Version\/[0-9]+\.[0.9]+ /.test(e))return!0}return!1}function i(){var e=o.default.getUAObject();return e.ua?-1!==e.ua.indexOf("CrKey")?"chromecast":(e.device,e.os,o.default.isMobile()?r(e.ua)?"android-webview":"web-mobile":"web-desktop"):"unknown"}Object.defineProperty(t,"__esModule",{value:!0});var a=n(40),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={get:i},e.exports=t.default},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(6),a=r(i),o=n(0),s=r(o),u=n(1),l=r(u),c=n(8),d=r(c),f=n(7),h=r(f),_=n(4),p=r(_),v=n(259),E=r(v),m=n(114),S=n(53),g=null,T={},y={},C=function(e){function t(e,n,r){(0,s.default)(this,t);var i=(0,d.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e,n,r));return i._createTimer(),i}return(0,h.default)(t,e),(0,l.default)(t,[{key:"_createTimer",value:function(){var e=this;if(g){var t=this._isRepeatable?"setInterval":"setTimeout";g.postMessage({command:t,id:this._id,time:this._time}),T[this._id]=this._callback}else if(this._isRepeatable){var n=function t(){y[e._id]=setTimeout(t,e._time),e._callback()};y[this._id]=setTimeout(n,this._time)}else{var r=function(){e._callback(),e._callback=S.noop};y[this._id]=setTimeout(r,this._time)}}},{key:"clear",value:function(){g?(delete T[this._id],g.postMessage({command:"clear",id:this._id})):(clearTimeout(y[this._id]),delete y[this._id]),this._callback=S.noop}}]),t}(m.AbstractTimer);try{window.Worker&&(g=new window.Worker(URL.createObjectURL(new Blob(["("+E.default.toString()+")()"],{type:"text/javascript"}))),g.onmessage=function(e){var t=e.data,n=t.id,r=t.command;T[n]&&(T[n](),"triggerTimeout"===r&&delete T[n])},g.onerror=function(e){p.default.notify("Error in TimerWorker",e.message)})}catch(e){}e.exports=C},function(e,t,n){"use strict";function r(){function e(e){return function(){self.postMessage({id:e,command:"triggerTimeout"}),delete n[e]}}function t(e,r){return function(){self.postMessage({id:e,command:"triggerInterval"}),n[e]=setTimeout(t(e,r),r)}}var n={};self.onmessage=function(r){var i=r.data,a=i.command,o=i.id,s=i.time;switch(a){case"setTimeout":n[o]=setTimeout(e(o),s);break;case"setInterval":n[o]=setTimeout(t(o,s),s);break;case"clear":clearTimeout(n[o]),delete n[o]}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r,e.exports=t.default},function(e,t,n){"use strict";function r(){String.prototype.endsWith=function(e){var t=this.toString();return t.lastIndexOf(e)===t.length-1}}function i(e){return e.endsWith("/")?e:e+"/"}Object.defineProperty(t,"__esModule",{value:!0}),t.polyfillEndsWith=r,t.formatUrl=i,String.prototype.endsWith||r()},function(e,t,n){e.exports={default:n(277),__esModule:!0}},function(e,t,n){e.exports={default:n(280),__esModule:!0}},function(e,t,n){e.exports={default:n(285),__esModule:!0}},function(e,t,n){e.exports={default:n(286),__esModule:!0}},function(e,t,n){e.exports={default:n(287),__esModule:!0}},function(e,t,n){e.exports={default:n(289),__esModule:!0}},function(e,t,n){e.exports={default:n(292),__esModule:!0}},function(e,t,n){e.exports={default:n(293),__esModule:!0}},function(e,t,n){e.exports={default:n(296),__esModule:!0}},function(e,t,n){e.exports={default:n(297),__esModule:!0}},function(e,t,n){e.exports={default:n(300),__esModule:!0}},function(e,t,n){e.exports={default:n(301),__esModule:!0}},function(e,t,n){"use strict";t.__esModule=!0;var r=n(14),i=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=i.default||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}},function(e,t,n){"use strict";function r(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function i(e){return 3*e.length/4-r(e)}function a(e){var t,n,i,a,o,s=e.length;a=r(e),o=new d(3*s/4-a),n=a>0?s-4:s;var u=0;for(t=0;t<n;t+=4)i=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],o[u++]=i>>16&255,o[u++]=i>>8&255,o[u++]=255&i;return 2===a?(i=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,o[u++]=255&i):1===a&&(i=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,o[u++]=i>>8&255,o[u++]=255&i),o}function o(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}function s(e,t,n){for(var r,i=[],a=t;a<n;a+=3)r=(e[a]<<16)+(e[a+1]<<8)+e[a+2],i.push(o(r));return i.join("")}function u(e){for(var t,n=e.length,r=n%3,i="",a=[],o=0,u=n-r;o<u;o+=16383)a.push(s(e,o,o+16383>u?u:o+16383));return 1===r?(t=e[n-1],i+=l[t>>2],i+=l[t<<4&63],i+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],i+=l[t>>10],i+=l[t>>4&63],i+=l[t<<2&63],i+="="),a.push(i),a.join("")}t.byteLength=i,t.toByteArray=a,t.fromByteArray=u;for(var l=[],c=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,_=f.length;h<_;++h)l[h]=f[h],c[f.charCodeAt(h)]=h;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(e,t,n){n(30),n(326),e.exports=n(3).Array.from},function(e,t,n){n(37),n(30),e.exports=n(324)},function(e,t,n){n(37),n(30),e.exports=n(325)},function(e,t,n){var r=n(3),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},function(e,t,n){n(64),n(30),n(37),n(328),n(349),e.exports=n(3).Map},function(e,t,n){n(329),e.exports=n(3).Number.isInteger},function(e,t,n){n(330),e.exports=9007199254740991},function(e,t,n){n(331),e.exports=-9007199254740991},function(e,t,n){n(332),e.exports=parseInt},function(e,t,n){n(333),e.exports=n(3).Object.assign},function(e,t,n){n(334);var r=n(3).Object;e.exports=function(e,t){return r.create(e,t)}},function(e,t,n){n(335);var r=n(3).Object;e.exports=function(e,t){return r.defineProperties(e,t)}},function(e,t,n){n(336);var r=n(3).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},function(e,t,n){n(337),e.exports=n(3).Object.freeze},function(e,t,n){n(338);var r=n(3).Object;e.exports=function(e,t){return r.getOwnPropertyDescriptor(e,t)}},function(e,t,n){n(339);var r=n(3).Object;e.exports=function(e){return r.getOwnPropertyNames(e)}},function(e,t,n){n(340),e.exports=n(3).Object.getPrototypeOf},function(e,t,n){n(341),e.exports=n(3).Object.isFrozen},function(e,t,n){n(342),e.exports=n(3).Object.is},function(e,t,n){n(343),e.exports=n(3).Object.keys},function(e,t,n){n(344),e.exports=n(3).Object.seal},function(e,t,n){n(345),e.exports=n(3).Object.setPrototypeOf},function(e,t,n){n(350),e.exports=n(3).Object.values},function(e,t,n){n(64),n(30),n(37),n(346),e.exports=n(3).Promise},function(e,t,n){n(64),n(30),n(37),n(347),n(351),e.exports=n(3).Set},function(e,t,n){n(348),n(64),n(352),n(353),e.exports=n(3).Symbol},function(e,t,n){n(30),n(37),e.exports=n(90).f("iterator")},function(e,t){e.exports=function(){}},function(e,t,n){var r=n(59);e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},function(e,t,n){var r=n(21),i=n(62),a=n(323);e.exports=function(e){return function(t,n,o){var s,u=r(t),l=i(u.length),c=a(o,l);if(e&&n!=n){for(;l>c;)if((s=u[c++])!=s)return!0}else for(;l>c;c++)if((e||c in u)&&u[c]===n)return e||c||0;return!e&&-1}}},function(e,t,n){var r=n(22),i=n(80),a=n(36),o=n(62),s=n(307);e.exports=function(e,t){var n=1==e,u=2==e,l=3==e,c=4==e,d=6==e,f=5==e||d,h=t||s;return function(t,s,_){for(var p,v,E=a(t),m=i(E),S=r(s,_,3),g=o(m.length),T=0,y=n?h(t,g):u?h(t,0):void 0;g>T;T++)if((f||T in m)&&(p=m[T],v=S(p,T,E),e))if(n)y[T]=v;else if(v)switch(e){case 3:return!0;case 5:return p;case 6:return T;case 2:y.push(p)}else if(c)return!1;return d?-1:l||c?c:y}}},function(e,t,n){var r=n(13),i=n(125),a=n(11)("species");e.exports=function(e){var t;return i(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?Array:t}},function(e,t,n){var r=n(306);e.exports=function(e,t){return new(r(e))(t)}},function(e,t,n){"use strict";var r=n(17),i=n(48);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},function(e,t,n){var r=n(28),i=n(83),a=n(47);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var o,s=n(e),u=a.f,l=0;s.length>l;)u.call(e,o=s[l++])&&t.push(o);return t}},function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},function(e,t,n){var r=n(13),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},function(e,t,n){"use strict";var r=n(61),i=n(48),a=n(49),o={};n(24)(o,n(11)("iterator"),function(){return this}),e.exports=function(e,t,n){e.prototype=r(o,{next:i(1,n)}),a(e,t+" Iterator")}},function(e,t,n){var r=n(28),i=n(21);e.exports=function(e,t){for(var n,a=i(e),o=r(a),s=o.length,u=0;s>u;)if(a[n=o[u++]]===t)return n}},function(e,t,n){var r=n(12),i=n(137).set,a=r.MutationObserver||r.WebKitMutationObserver,o=r.process,s=r.Promise,u="process"==n(44)(o);e.exports=function(){var e,t,n,l=function(){var r,i;for(u&&(r=o.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(u)n=function(){o.nextTick(l)};else if(a){var c=!0,d=document.createTextNode("");new a(l).observe(d,{characterData:!0}),n=function(){d.data=c=!c}}else if(s&&s.resolve){var f=s.resolve();n=function(){f.then(l)}}else n=function(){i.call(r,l)};return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},function(e,t,n){"use strict";var r=n(28),i=n(83),a=n(47),o=n(36),s=n(80),u=Object.assign;e.exports=!u||n(23)(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=o(e),u=arguments.length,l=1,c=i.f,d=a.f;u>l;)for(var f,h=s(arguments[l++]),_=c?r(h).concat(c(h)):r(h),p=_.length,v=0;p>v;)d.call(h,f=_[v++])&&(n[f]=h[f]);return n}:u},function(e,t,n){var r=n(28),i=n(21),a=n(47).f;e.exports=function(e){return function(t){for(var n,o=i(t),s=r(o),u=s.length,l=0,c=[];u>l;)a.call(o,n=s[l++])&&c.push(e?[n,o[n]]:o[n]);return c}}},function(e,t,n){var r=n(12).parseInt,i=n(322).trim,a=n(136),o=/^[\-+]?0[xX]/;e.exports=8!==r(a+"08")||22!==r(a+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(o.test(n)?16:10))}:r},function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},function(e,t,n){var r=n(13),i=n(20),a=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{r=n(22)(Function.call,n(82).f(Object.prototype,"__proto__").set,2),r(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return a(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:a}},function(e,t,n){var r=n(20),i=n(76),a=n(11)("species");e.exports=function(e,t){var n,o=r(e).constructor;return void 0===o||void 0==(n=r(o)[a])?t:i(n)}},function(e,t,n){var r=n(87),i=n(45);e.exports=function(e){return function(t,n){var a,o,s=String(i(t)),u=r(n),l=s.length;return u<0||u>=l?e?"":void 0:(a=s.charCodeAt(u),a<55296||a>56319||u+1===l||(o=s.charCodeAt(u+1))<56320||o>57343?e?s.charAt(u):a:e?s.slice(u,u+2):o-56320+(a-55296<<10)+65536)}}},function(e,t,n){var r=n(9),i=n(45),a=n(23),o=n(136),s="["+o+"]",u="âÂ",l=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),d=function(e,t,n){var i={},s=a(function(){return!!o[e]()||u[e]()!=u}),l=i[e]=s?t(f):o[e];n&&(i[n]=l),r(r.P+r.F*s,"String",i)},f=d.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(l,"")),2&t&&(e=e.replace(c,"")),e};e.exports=d},function(e,t,n){var r=n(87),i=Math.max,a=Math.min;e.exports=function(e,t){return e=r(e),e<0?i(e+t,0):a(e,t)}},function(e,t,n){var r=n(20),i=n(91);e.exports=n(3).getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},function(e,t,n){var r=n(58),i=n(11)("iterator"),a=n(35);e.exports=n(3).isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||a.hasOwnProperty(r(t))}},function(e,t,n){"use strict";var r=n(22),i=n(9),a=n(36),o=n(126),s=n(124),u=n(62),l=n(308),c=n(91);i(i.S+i.F*!n(127)(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,i,d,f=a(e),h="function"==typeof this?this:Array,_=arguments.length,p=_>1?arguments[1]:void 0,v=void 0!==p,E=0,m=c(f);if(v&&(p=r(p,_>2?arguments[2]:void 0,2)),void 0==m||h==Array&&s(m))for(t=u(f.length),n=new h(t);t>E;E++)l(n,E,v?p(f[E],E):f[E]);else for(d=m.call(f),n=new h;!(i=d.next()).done;E++)l(n,E,v?o(d,p,[i.value,E],!0):i.value);return n.length=E,n}})},function(e,t,n){"use strict";var r=n(302),i=n(128),a=n(35),o=n(21);e.exports=n(81)(Array,"Array",function(e,t){this._t=o(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):"keys"==t?i(0,n):"values"==t?i(0,e[n]):i(0,[n,e[n]])},"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},function(e,t,n){"use strict";var r=n(119);e.exports=n(121)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},function(e,t,n){var r=n(9);r(r.S,"Number",{isInteger:n(311)})},function(e,t,n){var r=n(9);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(e,t,n){var r=n(9);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(e,t,n){var r=n(9),i=n(317);r(r.S+r.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(e,t,n){var r=n(9);r(r.S+r.F,"Object",{assign:n(315)})},function(e,t,n){var r=n(9);r(r.S,"Object",{create:n(61)})},function(e,t,n){var r=n(9);r(r.S+r.F*!n(16),"Object",{defineProperties:n(129)})},function(e,t,n){var r=n(9);r(r.S+r.F*!n(16),"Object",{defineProperty:n(17).f})},function(e,t,n){var r=n(13),i=n(46).onFreeze;n(29)("freeze",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(21),i=n(82).f;n(29)("getOwnPropertyDescriptor",function(){return function(e,t){return i(r(e),t)}})},function(e,t,n){n(29)("getOwnPropertyNames",function(){return n(130).f})},function(e,t,n){var r=n(36),i=n(132);n(29)("getPrototypeOf",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(13);n(29)("isFrozen",function(e){return function(t){return!r(t)||!!e&&e(t)}})},function(e,t,n){var r=n(9);r(r.S,"Object",{is:n(318)})},function(e,t,n){var r=n(36),i=n(28);n(29)("keys",function(){return function(e){return i(r(e))}})},function(e,t,n){var r=n(13),i=n(46).onFreeze;n(29)("seal",function(e){return function(t){return e&&r(t)?e(i(t)):t}})},function(e,t,n){var r=n(9);r(r.S,"Object",{setPrototypeOf:n(319).set})},function(e,t,n){"use strict";var r,i,a,o=n(60),s=n(12),u=n(22),l=n(58),c=n(9),d=n(13),f=n(76),h=n(77),_=n(59),p=n(320),v=n(137).set,E=n(314)(),m=s.TypeError,S=s.process,g=s.Promise,S=s.process,T="process"==l(S),y=function(){},C=!!function(){try{var e=g.resolve(1),t=(e.constructor={})[n(11)("species")]=function(e){e(y,y)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(y)instanceof t}catch(e){}}(),D=function(e,t){return e===t||e===g&&t===a},A=function(e){var t;return!(!d(e)||"function"!=typeof(t=e.then))&&t},w=function(e){return D(g,e)?new R(e):new i(e)},R=i=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw m("Bad Promise constructor");t=e,n=r}),this.resolve=f(t),this.reject=f(n)},P=function(e){try{e()}catch(e){return{error:e}}},b=function(e,t){if(!e._n){e._n=!0;var n=e._c;E(function(){for(var r=e._v,i=1==e._s,a=0;n.length>a;)!function(t){var n,a,o=i?t.ok:t.fail,s=t.resolve,u=t.reject,l=t.domain;try{o?(i||(2==e._h&&O(e),e._h=1),!0===o?n=r:(l&&l.enter(),n=o(r),l&&l.exit()),n===t.promise?u(m("Promise-chain cycle")):(a=A(n))?a.call(n,s,u):s(n)):u(r)}catch(e){u(e)}}(n[a++]);e._c=[],e._n=!1,t&&!e._h&&k(e)})}},k=function(e){v.call(s,function(){var t,n,r,i=e._v;if(I(e)&&(t=P(function(){T?S.emit("unhandledRejection",i,e):(n=s.onunhandledrejection)?n({promise:e,reason:i}):(r=s.console)&&r.error&&r.error("Unhandled promise rejection",i)}),e._h=T||I(e)?2:1),e._a=void 0,t)throw t.error})},I=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,r=0;n.length>r;)if(t=n[r++],t.fail||!I(t.promise))return!1;return!0},O=function(e){v.call(s,function(){var t;T?S.emit("rejectionHandled",e):(t=s.onrejectionhandled)&&t({promise:e,reason:e._v})})},N=function(e){var t=this;t._d||(t._d=!0,t=t._w||t,t._v=e,t._s=2,t._a||(t._a=t._c.slice()),b(t,!0))},L=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw m("Promise can't be resolved itself");(t=A(e))?E(function(){var r={_w:n,_d:!1};try{t.call(e,u(L,r,1),u(N,r,1))}catch(e){N.call(r,e)}}):(n._v=e,n._s=1,b(n,!1))}catch(e){N.call({_w:n,_d:!1},e)}}};C||(g=function(e){h(this,g,"Promise","_h"),f(e),r.call(this);try{e(u(L,this,1),u(N,this,1))}catch(e){N.call(this,e)}},r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},r.prototype=n(84)(g.prototype,{then:function(e,t){var n=w(p(this,g));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&b(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),R=function(){var e=new r;this.promise=e,this.resolve=u(L,e,1),this.reject=u(N,e,1)}),c(c.G+c.W+c.F*!C,{Promise:g}),n(49)(g,"Promise"),n(135)("Promise"),a=n(3).Promise,c(c.S+c.F*!C,"Promise",{reject:function(e){var t=w(this);return(0,t.reject)(e),t.promise}}),c(c.S+c.F*(o||!C),"Promise",{resolve:function(e){if(e instanceof g&&D(e.constructor,this))return e;var t=w(this);return(0,t.resolve)(e),t.promise}}),c(c.S+c.F*!(C&&n(127)(function(e){g.all(e).catch(y)})),"Promise",{all:function(e){var t=this,n=w(t),r=n.resolve,i=n.reject,a=P(function(){var n=[],a=0,o=1;_(e,!1,function(e){var s=a++,u=!1;n.push(void 0),o++,t.resolve(e).then(function(e){u||(u=!0,n[s]=e,--o||r(n))},i)}),--o||r(n)});return a&&i(a.error),n.promise},race:function(e){var t=this,n=w(t),r=n.reject,i=P(function(){_(e,!1,function(e){t.resolve(e).then(n.resolve,r)})});return i&&r(i.error),n.promise}})},function(e,t,n){"use strict";var r=n(119);e.exports=n(121)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return r.def(this,e=0===e?0:e,e)}},r)},function(e,t,n){"use strict";var r=n(12),i=n(27),a=n(16),o=n(9),s=n(134),u=n(46).KEY,l=n(23),c=n(86),d=n(49),f=n(63),h=n(11),_=n(90),p=n(89),v=n(313),E=n(309),m=n(125),S=n(20),g=n(21),T=n(88),y=n(48),C=n(61),D=n(130),A=n(82),w=n(17),R=n(28),P=A.f,b=w.f,k=D.f,I=r.Symbol,O=r.JSON,N=O&&O.stringify,L=h("_hidden"),M=h("toPrimitive"),U={}.propertyIsEnumerable,B=c("symbol-registry"),x=c("symbols"),F=c("op-symbols"),H=Object.prototype,G="function"==typeof I,j=r.QObject,V=!j||!j.prototype||!j.prototype.findChild,W=a&&l(function(){return 7!=C(b({},"a",{get:function(){return b(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=P(H,t);r&&delete H[t],b(e,t,n),r&&e!==H&&b(H,t,r)}:b,K=function(e){var t=x[e]=C(I.prototype);return t._k=e,t},q=G&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},Y=function(e,t,n){return e===H&&Y(F,t,n),S(e),t=T(t,!0),S(n),i(x,t)?(n.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),n=C(n,{enumerable:y(0,!1)})):(i(e,L)||b(e,L,y(1,{})),e[L][t]=!0),W(e,t,n)):b(e,t,n)},Q=function(e,t){S(e);for(var n,r=E(t=g(t)),i=0,a=r.length;a>i;)Y(e,n=r[i++],t[n]);return e},z=function(e,t){return void 0===t?C(e):Q(C(e),t)},X=function(e){var t=U.call(this,e=T(e,!0));return!(this===H&&i(x,e)&&!i(F,e))&&(!(t||!i(this,e)||!i(x,e)||i(this,L)&&this[L][e])||t)},Z=function(e,t){if(e=g(e),t=T(t,!0),e!==H||!i(x,t)||i(F,t)){var n=P(e,t);return!n||!i(x,t)||i(e,L)&&e[L][t]||(n.enumerable=!0),n}},J=function(e){for(var t,n=k(g(e)),r=[],a=0;n.length>a;)i(x,t=n[a++])||t==L||t==u||r.push(t);return r},$=function(e){for(var t,n=e===H,r=k(n?F:g(e)),a=[],o=0;r.length>o;)!i(x,t=r[o++])||n&&!i(H,t)||a.push(x[t]);return a};G||(I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===H&&t.call(F,n),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),W(this,e,y(1,n))};return a&&V&&W(H,e,{configurable:!0,set:t}),K(e)},s(I.prototype,"toString",function(){return this._k}),A.f=Z,w.f=Y,n(131).f=D.f=J,n(47).f=X,n(83).f=$,a&&!n(60)&&s(H,"propertyIsEnumerable",X,!0),_.f=function(e){return K(h(e))}),o(o.G+o.W+o.F*!G,{Symbol:I});for(var ee="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),te=0;ee.length>te;)h(ee[te++]);for(var ee=R(h.store),te=0;ee.length>te;)p(ee[te++]);o(o.S+o.F*!G,"Symbol",{for:function(e){return i(B,e+="")?B[e]:B[e]=I(e)},keyFor:function(e){if(q(e))return v(B,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){V=!0},useSimple:function(){V=!1}}),o(o.S+o.F*!G,"Object",{create:z,defineProperty:Y,defineProperties:Q,getOwnPropertyDescriptor:Z,getOwnPropertyNames:J,getOwnPropertySymbols:$}),O&&o(o.S+o.F*(!G||l(function(){var e=I();return"[null]"!=N([e])||"{}"!=N({a:e})||"{}"!=N(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!q(e)){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);return t=r[1],"function"==typeof t&&(n=t),!n&&m(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!q(t))return t}),r[1]=t,N.apply(O,r)}}}),I.prototype[M]||n(24)(I.prototype,M,I.prototype.valueOf),d(I,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},function(e,t,n){var r=n(9);r(r.P+r.R,"Map",{toJSON:n(120)("Map")})},function(e,t,n){var r=n(9),i=n(316)(!1);r(r.S,"Object",{values:function(e){return i(e)}})},function(e,t,n){var r=n(9);r(r.P+r.R,"Set",{toJSON:n(120)("Set")})},function(e,t,n){n(89)("asyncIterator")},function(e,t,n){n(89)("observable")},function(e,t,n){"use strict";function r(e){return decodeURIComponent(e.replace(/\+/g," "))}function i(e){for(var t,n=/([^=?&]+)=?([^&]*)/g,i={};t=n.exec(e);i[r(t[1])]=r(t[2]));return i}function a(e,t){t=t||"";var n=[];"string"!=typeof t&&(t="?");for(var r in e)o.call(e,r)&&n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return n.length?t+n.join("&"):""}var o=Object.prototype.hasOwnProperty;t.stringify=a,t.parse=i},function(e,t,n){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,n){var r;!function(i,a){"use strict";var o="model",s="name",u="type",l="vendor",c="version",d="mobile",f="tablet",h={extend:function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},_={rgx:function(e,t){for(var n,r,i,a,o,s,u=0;u<t.length&&!o;){var l=t[u],c=t[u+1];for(n=r=0;n<l.length&&!o;)if(o=l[n++].exec(e))for(i=0;i<c.length;i++)s=o[++r],a=c[i],"object"==typeof a&&a.length>0?2==a.length?"function"==typeof a[1]?this[a[0]]=a[1].call(this,s):this[a[0]]=a[1]:3==a.length?"function"!=typeof a[1]||a[1].exec&&a[1].test?this[a[0]]=s?s.replace(a[1],a[2]):void 0:this[a[0]]=s?a[1].call(this,s,a[2]):void 0:4==a.length&&(this[a[0]]=s?a[3].call(this,s.replace(a[1],a[2])):void 0):this[a]=s||void 0;u+=2}},str:function(e,t){for(var n in t)if("object"==typeof t[n]&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(h.has(t[n][r],e))return"?"===n?void 0:n}else if(h.has(t[n],e))return"?"===n?void 0:n;return e}},p={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},v={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[s,c],[/(opios)[\/\s]+([\w\.]+)/i],[[s,"Opera Mini"],c],[/\s(opr)\/([\w\.]+)/i],[[s,"Opera"],c],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser)\/([\w\.-]+)/i],[s,c],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[s,"IE"],c],[/(edge)\/((\d+)?[\w\.]+)/i],[s,c],[/(yabrowser)\/([\w\.]+)/i],[[s,"Yandex"],c],[/(puffin)\/([\w\.]+)/i],[[s,"Puffin"],c],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[s,"UCBrowser"],c],[/(comodo_dragon)\/([\w\.]+)/i],[[s,/_/g," "],c],[/(micromessenger)\/([\w\.]+)/i],[[s,"WeChat"],c],[/(QQ)\/([\d\.]+)/i],[s,c],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[s,c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[c,[s,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[c,[s,"Facebook"]],[/(headlesschrome) ([\w\.]+)/i],[c,[s,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[s,/(.+)/,"$1 WebView"],c],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[s,/(.+(?:g|us))(.+)/,"$1 $2"],c],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[c,[s,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[s,c],[/(dolfin)\/([\w\.]+)/i],[[s,"Dolphin"],c],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[s,"Chrome"],c],[/(coast)\/([\w\.]+)/i],[[s,"Opera Coast"],c],[/fxios\/([\w\.-]+)/i],[c,[s,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[c,[s,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[c,s],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[s,[c,_.str,p.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[s,c],[/(navigator|netscape)\/([\w\.-]+)/i],[[s,"Netscape"],c],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[s,c]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",h.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",h.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",h.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[o,l,[u,f]],[/applecoremedia\/[\w\.]+ \((ipad)/],[o,[l,"Apple"],[u,f]],[/(apple\s{0,1}tv)/i],[[o,"Apple TV"],[l,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[l,o,[u,f]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[o,[l,"Amazon"],[u,f]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[o,_.str,p.device.amazon.model],[l,"Amazon"],[u,d]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[o,l,[u,d]],[/\((ip[honed|\s\w*]+);/i],[o,[l,"Apple"],[u,d]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[l,o,[u,d]],[/\(bb10;\s(\w+)/i],[o,[l,"BlackBerry"],[u,d]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[o,[l,"Asus"],[u,f]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[l,"Sony"],[o,"Xperia Tablet"],[u,f]],[/android.+\s([c-g]\d{4}|so[-l]\w+)\sbuild\//i],[o,[l,"Sony"],[u,d]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[l,o,[u,"console"]],[/android.+;\s(shield)\sbuild/i],[o,[l,"Nvidia"],[u,"console"]],[/(playstation\s[34portablevi]+)/i],[o,[l,"Sony"],[u,"console"]],[/(sprint\s(\w+))/i],[[l,_.str,p.device.sprint.vendor],[o,_.str,p.device.sprint.model],[u,d]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[l,o,[u,f]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[l,[o,/_/g," "],[u,d]],[/(nexus\s9)/i],[o,[l,"HTC"],[u,f]],[/d\/huawei([\w\s-]+)[;\)]/i,/(nexus\s6p)/i],[o,[l,"Huawei"],[u,d]],[/(microsoft);\s(lumia[\s\w]+)/i],[l,o,[u,d]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[o,[l,"Microsoft"],[u,"console"]],[/(kin\.[onetw]{3})/i],[[o,/\./g," "],[l,"Microsoft"],[u,d]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[o,[l,"Motorola"],[u,d]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[o,[l,"Motorola"],[u,f]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[l,h.trim],[o,h.trim],[u,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[o,/^/,"SmartTV"],[l,"Samsung"],[u,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[o,[l,"Sharp"],[u,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[l,"Samsung"],o,[u,f]],[/smart-tv.+(samsung)/i],[l,[u,"smarttv"],o],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[l,"Samsung"],o,[u,d]],[/sie-(\w+)*/i],[o,[l,"Siemens"],[u,d]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[l,"Nokia"],o,[u,d]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[o,[l,"Acer"],[u,f]],[/android.+([vl]k\-?\d{3})\s+build/i],[o,[l,"LG"],[u,f]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[l,"LG"],o,[u,f]],[/(lg) netcast\.tv/i],[l,o,[u,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i,/android.+lg(\-?[\d\w]+)\s+build/i],[o,[l,"LG"],[u,d]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[o,[l,"Lenovo"],[u,f]],[/linux;.+((jolla));/i],[l,o,[u,d]],[/((pebble))app\/[\d\.]+\s/i],[l,o,[u,"wearable"]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[l,o,[u,d]],[/crkey/i],[[o,"Chromecast"],[l,"Google"]],[/android.+;\s(glass)\s\d/i],[o,[l,"Google"],[u,"wearable"]],[/android.+;\s(pixel c)\s/i],[o,[l,"Google"],[u,f]],[/android.+;\s(pixel xl|pixel)\s/i],[o,[l,"Google"],[u,d]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[o,/_/g," "],[l,"Xiaomi"],[u,d]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[o,[l,"Meizu"],[u,f]],[/android.+a000(1)\s+build/i],[o,[l,"OnePlus"],[u,d]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[o,[l,"RCA"],[u,f]],[/android.+[;\/]\s*(Venue[\d\s]*)\s+build/i],[o,[l,"Dell"],[u,f]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[o,[l,"Verizon"],[u,f]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[l,"Barnes & Noble"],o,[u,f]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[o,[l,"NuVision"],[u,f]],[/android.+[;\/]\s*(zte)?.+(k\d{2})\s+build/i],[[l,"ZTE"],o,[u,f]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[o,[l,"Swiss"],[u,d]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[o,[l,"Swiss"],[u,f]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[o,[l,"Zeki"],[u,f]],[/(android).+[;\/]\s+([YR]\d{2}x?.*)\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(.+)\s+build/i],[[l,"Dragon Touch"],o,[u,f]],[/android.+[;\/]\s*(NS-?.+)\s+build/i],[o,[l,"Insignia"],[u,f]],[/android.+[;\/]\s*((NX|Next)-?.+)\s+build/i],[o,[l,"NextBook"],[u,f]],[/android.+[;\/]\s*(Xtreme\_?)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[l,"Voice"],o,[u,d]],[/android.+[;\/]\s*(LVTEL\-?)?(V1[12])\s+build/i],[[l,"LvTel"],o,[u,d]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[o,[l,"Envizen"],[u,f]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(.*\b)\s+build/i],[l,o,[u,f]],[/android.+[;\/]\s*(Trio[\s\-]*.*)\s+build/i],[o,[l,"MachSpeed"],[u,f]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[l,o,[u,f]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[o,[l,"Rotor"],[u,f]],[/android.+(KS(.+))\s+build/i],[o,[l,"Amazon"],[u,f]],[/android.+(Gigaset)[\s\-]+(Q.+)\s+build/i],[l,o,[u,f]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[u,h.lowerize],l,o],[/(android.+)[;\/].+build/i],[o,[l,"Generic"]]],
engine:[[/windows.+\sedge\/([\w\.]+)/i],[c,[s,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[s,c],[/rv\:([\w\.]+).*(gecko)/i],[c,s]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[s,c],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[s,[c,_.str,p.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[s,"Windows"],[c,_.str,p.os.windows.version]],[/\((bb)(10);/i],[[s,"BlackBerry"],c],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[s,c],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[s,"Symbian"],c],[/\((series40);/i],[s],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[s,"Firefox OS"],c],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[s,c],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[s,"Chromium OS"],c],[/(sunos)\s?([\w\.]+\d)*/i],[[s,"Solaris"],c],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[s,c],[/(haiku)\s(\w+)/i],[s,c],[/cfnetwork\/.+darwin/i,/ip[honead]+(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[c,/_/g,"."],[s,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[s,"Mac OS"],[c,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[s,c]]},E=function(e,t){this[s]=e,this[c]=t},m=function(e){this.architecture=e},S=function(e,t,n){this[l]=e,this[o]=t,this[u]=n},g=E,T=E,y=function(e,t){if("object"==typeof e&&(t=e,e=void 0),!(this instanceof y))return new y(e,t).getResult();var n=e||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:""),r=t?h.extend(v,t):v,a=new E,o=new m,s=new S,u=new g,l=new T;return this.getBrowser=function(){return _.rgx.call(a,n,r.browser),a.major=h.major(a.version),a},this.getCPU=function(){return _.rgx.call(o,n,r.cpu),o},this.getDevice=function(){return _.rgx.call(s,n,r.device),s},this.getEngine=function(){return _.rgx.call(u,n,r.engine),u},this.getOS=function(){return _.rgx.call(l,n,r.os),l},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,a=new E,o=new m,s=new S,u=new g,l=new T,this},this};y.VERSION="0.7.14",y.BROWSER={NAME:s,MAJOR:"major",VERSION:c},y.CPU={ARCHITECTURE:"architecture"},y.DEVICE={MODEL:o,VENDOR:l,TYPE:u,CONSOLE:"console",MOBILE:d,SMARTTV:"smarttv",TABLET:f,WEARABLE:"wearable",EMBEDDED:"embedded"},y.ENGINE={NAME:s,VERSION:c},y.OS={NAME:s,VERSION:c},void 0!==t?(void 0!==e&&e.exports&&(t=e.exports=y),t.UAParser=y):n(360)?void 0!==(r=function(){return y}.call(t,n,t,e))&&(e.exports=r):i&&(i.UAParser=y);var C=i&&(i.jQuery||i.Zepto);if(void 0!==C){var D=new y;C.ua=D.getResult(),C.ua.get=function(){return D.getUA()},C.ua.set=function(e){D.setUA(e);var t=D.getResult();for(var n in t)C.ua[n]=t[n]}}}("object"==typeof window?window:this)},function(e,t,n){"use strict";(function(t){function r(e){e=e||t.location||{};var n,r={},i=typeof e;if("blob:"===e.protocol)r=new o(unescape(e.pathname),{});else if("string"===i){r=new o(e,{});for(n in _)delete r[n]}else if("object"===i){for(n in e)n in _||(r[n]=e[n]);void 0===r.slashes&&(r.slashes=f.test(e.href))}return r}function i(e){var t=d.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function a(e,t){for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,i=n[r-1],a=!1,o=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),o++):o&&(0===r&&(a=!0),n.splice(r,1),o--);return a&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var s,u,d,f,_,p,v=h.slice(),E=typeof t,m=this,S=0;for("object"!==E&&"string"!==E&&(n=t,t=null),n&&"function"!=typeof n&&(n=c.parse),t=r(t),u=i(e||""),s=!u.protocol&&!u.slashes,m.slashes=u.slashes||s&&t.slashes,m.protocol=u.protocol||t.protocol||"",e=u.rest,u.slashes||(v[2]=[/(.*)/,"pathname"]);S<v.length;S++)f=v[S],d=f[0],p=f[1],d!==d?m[p]=e:"string"==typeof d?~(_=e.indexOf(d))&&("number"==typeof f[2]?(m[p]=e.slice(0,_),e=e.slice(_+f[2])):(m[p]=e.slice(_),e=e.slice(0,_))):(_=d.exec(e))&&(m[p]=_[1],e=e.slice(0,_.index)),m[p]=m[p]||(s&&f[3]?t[p]||"":""),f[4]&&(m[p]=m[p].toLowerCase());n&&(m.query=n(m.query)),s&&t.slashes&&"/"!==m.pathname.charAt(0)&&(""!==m.pathname||""!==t.pathname)&&(m.pathname=a(m.pathname,t.pathname)),l(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(f=m.auth.split(":"),m.username=f[0]||"",m.password=f[1]||""),m.origin=m.protocol&&m.host&&"file:"!==m.protocol?m.protocol+"//"+m.host:"null",m.href=m.toString()}function s(e,t,n){var r=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||c.parse)(t)),r[e]=t;break;case"port":r[e]=t,l(t,r.protocol)?t&&(r.host=r.hostname+":"+t):(r.host=r.hostname,r[e]="");break;case"hostname":r[e]=t,r.port&&(t+=":"+r.port),r.host=t;break;case"host":r[e]=t,/:\d+$/.test(t)?(t=t.split(":"),r.port=t.pop(),r.hostname=t.join(":")):(r.hostname=t,r.port="");break;case"protocol":r.protocol=t.toLowerCase(),r.slashes=!n;break;case"pathname":r.pathname=t.length&&"/"!==t.charAt(0)?"/"+t:t;break;default:r[e]=t}for(var i=0;i<h.length;i++){var a=h[i];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.origin=r.protocol&&r.host&&"file:"!==r.protocol?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function u(e){e&&"function"==typeof e||(e=c.stringify);var t,n=this,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var i=r+(n.slashes?"//":"");return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.host+n.pathname,t="object"==typeof n.query?e(n.query):n.query,t&&(i+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(i+=n.hash),i}var l=n(355),c=n(354),d=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,f=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,h=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],_={hash:1,query:1};o.prototype={set:s,toString:u},o.extractProtocol=i,o.location=r,o.qs=c,e.exports=o}).call(t,n(92))},function(e,t,n){function r(e,t,n){var r=t&&n||0,i=t||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:u,d=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:c+1,h=d-l+(f-c)/1e4;if(h<0&&void 0===e.clockseq&&(o=o+1&16383),(h<0||d>l)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");l=d,c=f,u=o,d+=122192928e5;var _=(1e4*(268435455&d)+f)%4294967296;i[r++]=_>>>24&255,i[r++]=_>>>16&255,i[r++]=_>>>8&255,i[r++]=255&_;var p=d/4294967296*1e4&268435455;i[r++]=p>>>8&255,i[r++]=255&p,i[r++]=p>>>24&15|16,i[r++]=p>>>16&255,i[r++]=o>>>8|128,i[r++]=255&o;for(var v=e.node||s,E=0;E<6;++E)i[r+E]=v[E];return t||a(i)}var i=n(141),a=n(140),o=i(),s=[1|o[0],o[1],o[2],o[3],o[4],o[5]],u=16383&(o[6]<<8|o[7]),l=0,c=0;e.exports=r},function(e,t,n){function r(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var o=e.random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[r+s]=o[s];return t||a(o)}var i=n(141),a=n(140);e.exports=r},function(e,t){(function(t){e.exports=t}).call(t,{})}])})},function(e,t,n){"use strict";function r(){var e=window||e;e.XMLHttpRequest=o}var i=n(5),a=n(3),o=n(19);e.exports={BaseXHR:i,XMLHttpRequest:o,useGlobal:r,objectMirrors:a}},function(e,t){var n=function(){var e=1/0,t=0,r=0,i=0;Object.defineProperty(this,"maxBandwidth",{get:function(){return Math.min(e,n.maxBandwidth)},set:function(t){e=t}}),Object.defineProperty(this,"minLatency",{get:function(){return Math.max(t,n.minLatency)},set:function(e){t=e}}),Object.defineProperty(this,"minProgressEvents",{get:function(){return Math.max(r,n.minProgressEvents)},set:function(e){r=e}}),Object.defineProperty(this,"randomness",{get:function(){return Math.max(i,n.randomness)},set:function(e){i=e}})};n.maxBandwidth=1/0,n.minLatency=0,n.minProgressEvents=0,n.randomness=0,e.exports=n},function(e,t,n){var r=n(5),i=n(18),a=n(3),o=window.XMLHttpRequest,s=function(){var e,t,n,s,u,l,c,d,f,h,_,p=new o,v=new i,E=0,m=[],S=!1;p.onloadend=function(e){_=e,n&&4===p.readyState&&n(e)},p.onreadystatechange=function(r){function i(t){e&&e(t)}switch(p.readyState){case 0:i(r);break;case 1:s=Date.now(),i(r);break;case 2:u=Date.now(),i(r);break;case 3:l=Date.now(),i(r);break;case 4:var a=0,o=0;c=Date.now();var g=c-s;if(g<v.minLatency&&(a=v.minLatency-g),f>v.maxBandwidth&&(o=f/v.maxBandwidth*g-g),a||o){setTimeout(function(){E!==d||S||(clearTimeout(h),t(m[m.length-1])),i(r),_&&n&&n(_)},Math.max(a,o));break}i(r)}},p.onprogress=function(e){function n(e){E===d&&(S=!0),t&&t(e)}var r,i=Date.now(),a=i-s;return E=e.loaded,d=e.total,f=8*E/a,f>v.maxBandwidth?(r=f/v.maxBandwidth*a-a,m.push(e),void(h=setTimeout(function(){n(e)},r))):void n(e)};var g=new r(p);return a.mirrorRwProp(g,p,"onreadystatechange",function(t){return e=t,{override:!0}}),a.mirrorRwProp(g,p,"onprogress",function(e){return t=e,{override:!0}}),a.mirrorRwProp(g,p,"onloadend",function(e){return n=e,{override:!0}}),g.shaper=v,g};s.Shaper=i,e.exports=s}])});